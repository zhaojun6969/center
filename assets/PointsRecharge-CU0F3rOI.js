import{ax as e,aA as a,r as s,c,f as l,z as i,A as r,B as o,L as n,P as t,u,R as d,Q as v,a5 as p,E as h,W as m}from"./vendor-p2oL7ibe.js";import{r as g,i as y,_ as k,L as R,a as f,g as b,W as _}from"./index-C1ozWA1l.js";import{P as C}from"./payserver-CCDcgcmO.js";import"./elementPlus-MWeHapXo.js";let A=class extends C{constructor(){super()}async getRechargePackageList(){let e=await g.common(y.RECHARGE_PACKAGES);if(0==e.code){return e.data}throw new Error(e.msg)}async confirmPay(e){this.createPayorOrder(e,2)}};const P={class:"points-recharge-page"},w={class:"top-bar"},S={class:"language-switcher"},x={class:"page-header"},D={class:"page-title"},O={class:"page-subtitle"},E={class:"plans-container"},$=["onClick"],j={class:"plan-header"},L={class:"plan-name"},F={key:0,class:"plan-badge"},U={class:"plan-price"},W={class:"price-amount"},B={class:"price-period"},G={class:"plan-points"},N={class:"plan-validity"},z={class:"plan-features"},H=["onClick"],I={class:"points-rules"},J={class:"rules-title"},K={class:"rules-list"},M={class:"rule-item"},Q={class:"rule-item"},V={class:"rule-item"},Y={class:"voucher-modal-header"},q={class:"voucher-modal-title"},T={class:"voucher-modal-content"},X={class:"selected-package-info"},Z={class:"package-name"},ee={class:"package-price"},ae={class:"original-price"},se={key:0,class:"discount-price"},ce={class:"voucher-section"},le={key:0,class:"loading-vouchers"},ie={key:1,class:"no-vouchers"},re={key:2,class:"voucher-list"},oe=["onClick"],ne={class:"voucher-left"},te={class:"voucher-amount"},ue={class:"voucher-code"},de={class:"voucher-right"},ve={class:"voucher-desc"},pe={class:"voucher-min"},he={class:"voucher-expire"},me={class:"voucher-check"},ge={key:0,class:"check-icon"},ye={class:"voucher-modal-footer"},ke=["disabled"],Re={key:0},fe={key:1},be=k({__name:"PointsRecharge",setup(k){const C=new A,{t:be}=e(),_e=a(),Ce=s(null),Ae=s([]),Pe=s([]),we=s(null),Se=s(!1),xe=s(0),De=s(!1),Oe=s(null),Ee=s(!1),$e=c(()=>[...Ae.value].sort((e,a)=>e.sort_order-a.sort_order)),je=()=>{_e.options.history.state.back||_e.replace("/user-center"),_e.back()},Le=e=>{we.value?.id===e.id?we.value=null:we.value=e,(()=>{if(!Oe.value)return;Ee.value=!0;let e={currency:Oe.value.currency,amount:Oe.value.amount};we.value?e.coupon_ids=[we.value.id]:e.coupon_ids=[],g.common(y.calculateUnitAmount,e).then(e=>{const a=e.data;xe.value=a.discount_amount||0}).catch(e=>{}).finally(()=>{Ee.value=!1})})()},Fe=e=>{if(!e)return"";const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`},Ue=()=>{if(!Oe.value)return;let e={package_id:Oe.value.id};if(we.value?e.coupon_ids=[we.value.id]:e.coupon_ids=[],f()){const a=b()||"";return void _.BusWechartForNavigate("/pages/pay/payPoint",{method:"pay",payData:JSON.stringify({package_id:Oe.value.id,credits:Oe.value.credits,amount:Oe.value.amount,token:a,coupon_ids:e.coupon_ids})},"1")}C.confirmPay(e),De.value=!1},We=()=>{De.value=!1,we.value=null,xe.value=0,Oe.value=null},Be=async()=>{const e=(await C.getRechargePackageList()).items||[];Ae.value=e,await(async()=>{Se.value=!0;try{const e=await g.common(y.getAvailableCoupon);0===e.code&&(Pe.value=e.data||[])}catch(e){Pe.value=[]}finally{Se.value=!1}})()};return l(()=>{Be()}),(e,a)=>(r(),i("div",P,[o("div",w,[o("button",{class:"back-button",onClick:je}," ← "+t(u(be)("common.back")),1),o("div",S,[d(R)])]),o("div",x,[o("h1",D,t(u(be)("pointsRecharge.title")),1),o("p",O,t(u(be)("pointsRecharge.subtitle")),1)]),o("div",E,[(r(!0),i(v,null,p($e.value,e=>(r(),i("div",{key:e.id,class:h(["plan-card",{premium:1===e.is_recommended}]),onClick:a=>{return s=e.id,void(Ce.value=s);var s}},[o("div",j,[o("h3",L,t(e.package_name),1),1===e.is_recommended?(r(),i("div",F,t(u(be)("pointsRecharge.plans.premium.badge")),1)):n("",!0)]),o("div",U,[o("span",W,t(e.currency)+" "+t(e.amount),1),o("span",B,"/ "+t(u(be)("pointsRecharge.period")),1)]),o("div",G,t(e.credits)+" "+t(u(be)("pointsRecharge.points")),1),o("div",N,t(u(be)("pointsRecharge.validity"))+": "+t(e.validity_days)+" "+t(u(be)("pointsRecharge.period")),1),o("div",z,[o("ul",null,[o("li",null,t(u(be)("pointsRecharge.features.unlimitedAccess")),1),o("li",null,t(u(be)("pointsRecharge.features.prioritySupport")),1),o("li",null,t(u(be)("pointsRecharge.features.securePayment")),1)])]),o("button",{class:h(["purchase-button",{"premium-button":1===e.is_recommended}]),onClick:m(a=>(e=>{Oe.value=e,De.value=!0})(e),["stop"])},t(u(be)("pointsRecharge.purchase")),11,H)],10,$))),128))]),o("div",I,[o("h2",J,t(u(be)("pointsRecharge.rules.title")),1),o("ul",K,[o("li",M,t(u(be)("pointsRecharge.rules.rule1")),1),o("li",Q,t(u(be)("pointsRecharge.rules.rule2")),1),o("li",V,t(u(be)("pointsRecharge.rules.rule3")),1)])]),De.value?(r(),i("div",{key:0,class:"voucher-modal-overlay",onClick:We},[o("div",{class:"voucher-modal",onClick:a[0]||(a[0]=m(()=>{},["stop"]))},[o("div",Y,[o("h3",q,t(u(be)("pointsRecharge.voucher.title")),1),o("button",{class:"voucher-modal-close",onClick:We},"×")]),o("div",T,[o("div",X,[o("div",Z,t(Oe.value?.package_name),1),o("div",ee,[o("span",ae,t(Oe.value?.currency)+" "+t(Oe.value?.amount),1),xe.value>0?(r(),i("span",se,t(Oe.value?.currency)+" "+t((Oe.value?.amount-xe.value).toFixed(2)),1)):n("",!0)])]),o("div",ce,[Se.value?(r(),i("div",le,[a[1]||(a[1]=o("div",{class:"loading-spinner"},null,-1)),o("span",null,t(u(be)("pointsRecharge.voucher.loading")),1)])):0===Pe.value.length?(r(),i("div",ie,[o("span",null,t(u(be)("pointsRecharge.voucher.noVouchers")),1)])):(r(),i("div",re,[(r(!0),i(v,null,p(Pe.value,e=>(r(),i("div",{key:e.id,class:h(["voucher-item",{selected:we.value?.id===e.id,disabled:Oe.value?.amount<e.minOrderAmount}]),onClick:a=>Oe.value?.amount>=e.minOrderAmount&&Le(e)},[o("div",ne,[o("div",te,t("USD"===e.currency?"$":e.currency)+t(e.amount),1),o("div",ue,t(e.couponCode),1)]),o("div",de,[o("div",ve,t(e.sourceDesc),1),o("div",pe,t(u(be)("pointsRecharge.voucher.minOrder"))+": "+t("USD"===e.currency?"$":e.currency)+t(e.minOrderAmount),1),o("div",he,t(u(be)("pointsRecharge.voucher.expireAt"))+": "+t(Fe(e.expireAt)),1)]),o("div",me,[we.value?.id===e.id?(r(),i("div",ge,"✓")):n("",!0)])],10,oe))),128))]))])]),o("div",ye,[o("button",{class:"voucher-modal-btn cancel",onClick:We},t(u(be)("pointsRecharge.voucher.cancel")),1),o("button",{class:"voucher-modal-btn confirm",disabled:Ee.value,onClick:Ue},[Ee.value?(r(),i("span",Re,t(u(be)("pointsRecharge.voucher.loading")),1)):(r(),i("span",fe,t(u(be)("pointsRecharge.voucher.confirm")),1))],8,ke)])])])):n("",!0)]))}},[["__scopeId","data-v-dac2cc12"]]);export{be as default};
