import{_ as e,t as a,q as l,r as s,d as o,i as t,W as u,e as n}from"./index-B4iIxVom.js";/* empty css                     *//* empty css                    *//* empty css                 */import{az as i,r,c,w as d,j as m,aB as v,z as p,B as h,P as C,u as N,Q as y,a5 as g,R as b,J as f,L as w,aA as k,A as S,E as $,I as _,O as V}from"./vendor-ClluBQmh.js";import{af as H,a8 as x,b as A,a as j,H as J,E as U,l as D,ad as I}from"./elementPlus-5sGCOaHt.js";import{C as q,S as B}from"./state-BZyqW-14.js";import{S as G}from"./index-7vXv9XNO.js";import{P as M}from"./payserver-N-sfDqkd.js";import"./utils-D5ZNaMwG.js";const L={class:"buy-container"},O={class:"breadcrumb"},X={class:"breadcrumb-item"},P={class:"buy-layout"},F={class:"left-section"},R={class:"section-card"},Z={class:"section-title"},T={class:"product-item"},Q={class:"product-image"},z=["src","alt"],W={class:"product-details"},E={class:"product-name"},Y={class:"product-desc"},K={class:"product-price"},ee={class:"quantity-section"},ae={class:"quantity-selector"},le={class:"qty-value"},se={class:"section-card"},oe={class:"section-title"},te={key:0,class:"no-coupon"},ue={key:1,class:"coupon-list"},ne=["onClick"],ie={class:"coupon-left"},re={class:"coupon-amount"},ce={class:"coupon-condition"},de={class:"coupon-right"},me={class:"coupon-name"},ve={class:"coupon-expiry"},pe={key:0,class:"coupon-check"},he={class:"section-card"},Ce={class:"section-title"},Ne={class:"form-row"},ye={class:"form-row"},ge={class:"form-row"},be={class:"form-row"},fe={class:"form-row"},we={class:"form-row"},ke={class:"form-row"},Se={class:"right-section"},$e={class:"order-summary"},_e={class:"summary-title"},Ve={class:"summary-row"},He={class:"summary-label"},xe={class:"summary-value"},Ae={class:"summary-row"},je={class:"summary-label"},Je={class:"summary-value"},Ue={key:0,class:"summary-row"},De={class:"summary-label"},Ie={class:"summary-value discount"},qe={class:"summary-row"},Be={class:"summary-label"},Ge={class:"summary-value"},Me={class:"summary-row total"},Le={class:"summary-label"},Oe={class:"summary-value"},Xe=["disabled"],Pe=e({__name:"index",setup(e){const Pe=new M,Fe=k(),Re=v(),{t:Ze,locale:Te}=i(),Qe=new G,ze=r(1),We=r(null),Ee=r("US"),Ye=r({country:Ee.value,firstName:"",lastName:"",postalCode:"",state:"",city:"",address1:"",address2:"",phone:"",saveInfo:!1}),Ke=r([]),ea=r([]),aa=r({id:null,name:"",description:"",image:"",price:0}),la=r([]),sa=r(0),oa=r({}),ta=(e,a)=>{try{return new Intl.DisplayNames([Te.value],{type:"region"}).of(e)||a}catch(l){return a}},ua=()=>{const e=(q.getAllCountries()||[]).map(e=>({label:ta(e.isoCode,e.name),value:e.isoCode})),a=e.find(e=>"CN"===e.value);Ke.value=a?[a,...e.filter(e=>"CN"!==e.value)]:e},na=()=>{const e=B.getStatesOfCountry(Ye.value.country)||[];ea.value=e.map(e=>{let a=e.name;if("CN"===Ye.value.country){const l=e.isoCode?.startsWith("CN-")?e.isoCode:`CN-${e.isoCode}`;a=("zh"===Te.value?{"CN-BJ":"北京市","CN-SH":"上海市","CN-TJ":"天津市","CN-CQ":"重庆市","CN-HE":"河北省","CN-SX":"山西省","CN-NM":"内蒙古自治区","CN-LN":"辽宁省","CN-JL":"吉林省","CN-HL":"黑龙江省","CN-JS":"江苏省","CN-ZJ":"浙江省","CN-AH":"安徽省","CN-FJ":"福建省","CN-JX":"江西省","CN-SD":"山东省","CN-HA":"河南省","CN-HB":"湖北省","CN-HN":"湖南省","CN-GD":"广东省","CN-GX":"广西壮族自治区","CN-HI":"海南省","CN-SC":"四川省","CN-GZ":"贵州省","CN-YN":"云南省","CN-XZ":"西藏自治区","CN-SN":"陕西省","CN-GS":"甘肃省","CN-QH":"青海省","CN-NX":"宁夏回族自治区","CN-XJ":"新疆维吾尔自治区","CN-TW":"台湾省","CN-HK":"香港特别行政区","CN-MO":"澳门特别行政区"}:{"CN-BJ":"Beijing","CN-SH":"Shanghai","CN-TJ":"Tianjin","CN-CQ":"Chongqing","CN-HE":"Hebei","CN-SX":"Shanxi","CN-NM":"Inner Mongolia","CN-LN":"Liaoning","CN-JL":"Jilin","CN-HL":"Heilongjiang","CN-JS":"Jiangsu","CN-ZJ":"Zhejiang","CN-AH":"Anhui","CN-FJ":"Fujian","CN-JX":"Jiangxi","CN-SD":"Shandong","CN-HA":"Henan","CN-HB":"Hubei","CN-HN":"Hunan","CN-GD":"Guangdong","CN-GX":"Guangxi Zhuang Autonomous Region","CN-HI":"Hainan","CN-SC":"Sichuan","CN-GZ":"Guizhou","CN-YN":"Yunnan","CN-XZ":"Tibet Autonomous Region","CN-SN":"Shaanxi","CN-GS":"Gansu","CN-QH":"Qinghai","CN-NX":"Ningxia Hui Autonomous Region","CN-XJ":"Xinjiang Uygur Autonomous Region","CN-TW":"Taiwan","CN-HK":"Hong Kong SAR","CN-MO":"Macau SAR"})[l]||e.name}return{label:a,value:e.isoCode}})},ia=c(()=>`${a()?"¥":"$"}${(aa.value.price*ze.value).toLocaleString()}`),ra=c(()=>`${a()?"¥":"$"}${sa.value}`),ca=c(()=>`${a()?"¥":"$"}0`),da=c(()=>{const e=aa.value.price*ze.value,l=Math.max(0,e-sa.value);return`${a()?"¥":"$"}${l.toLocaleString()}`}),ma=c(()=>!!(Ye.value.firstName?.trim()&&Ye.value.lastName?.trim()&&Ye.value.address1?.trim()&&Ye.value.city?.trim()&&Ye.value.phone?.trim())),va=()=>{ze.value<99&&(ze.value++,Ca())},pa=()=>{ze.value>1&&(ze.value--,Ca())},ha=r("USD"),Ca=()=>{let e={currency:ha.value,amount:aa.value.price*ze.value};We.value?e.coupon_ids=[We.value]:e.coupon_ids=[],s.common(o.calculateUnitAmount,e).then(e=>{const a=e.data;sa.value=a.discount_amount||0})},Na=()=>{Fe.push("/shop")},ya=()=>{if(!(Ye.value.firstName&&Ye.value.lastName&&Ye.value.address1&&Ye.value.city&&Ye.value.phone))return;(()=>{try{Ye.value.saveInfo&&localStorage.setItem("shop_shipping",JSON.stringify(Ye.value))}catch(e){}})();let e={goods_id:String(aa.value.id),quantity:String(ze.value),success_url:`${window.location.origin}/#/order-management`,cancel_url:`${window.location.origin}/#/order-management`,coupon_ids:We.value?[We.value]:[],order_info:{logistics:{country:Ye.value.country,countryLabel:Ke.value.find(e=>e.value===Ye.value.country)?.label||Ye.value.country,firstName:Ye.value.firstName,lastName:Ye.value.lastName,postalCode:Ye.value.postalCode,state:Ye.value.state,stateLabel:ea.value.find(e=>e.value===Ye.value.state)?.label||Ye.value.state,city:Ye.value.city,address1:Ye.value.address1,address2:Ye.value.address2,phone:Ye.value.phone},goods_info:{...oa.value,quantity:String(ze.value),price:(aa.value.price*ze.value).toFixed(2)}}};if(t())return delete e.success_url,delete e.cancel_url,void u.BusWechartForNavigate("/pages/pay/payCommon",{requestUrl:o.createPurchasePay.url,method:o.createPurchasePay.method,needPay:!0,callBackUrl:"/order-management",errorUrl:"/order-management",requestData:JSON.stringify(e),callBackMessage:"支付成功",errorMessage:"支付失败"});Pe.createPayorOrder(e,3)};return d(()=>Ye.value.country,()=>{na()}),d(()=>Te.value,()=>{ua(),na()}),m(()=>{const e=Re.params.id;e&&(console.log("Product ID:",e),(async e=>{try{const a=await Qe.getGoodsDetail({id:e});if(console.log("Goods Detail Response:",a),a&&a.success&&a.data){const e=a.data;oa.value=e,aa.value={id:e.id,name:e.goodsName,description:e.shortDesc||"",image:e.mainImage||e.images?.[0]||"",price:e.price||0}}}catch(a){console.error("Failed to fetch goods detail:",a)}})(e)),(async()=>{try{const e=await s.common(o.getAvailableCoupon);console.log("Coupon List Response:",e),e&&0===e.code&&(la.value=(e.data||[]).map(e=>({id:e.id,name:e.sourceDesc||e.couponCode,amount:e.amount,minAmount:e.minOrderAmount,expiry:e.expireAt,applicable:!0,currency:e.currency||"USD"})))}catch(e){console.error("Failed to fetch coupon list:",e),la.value=[]}})();try{if(l().isDomestic){Ee.value="CN";localStorage.getItem("shop_shipping")||(Ye.value.country="CN")}const e=localStorage.getItem("shop_shipping");e&&Object.assign(Ye.value,JSON.parse(e)),ua(),na()}catch(a){}}),(e,a)=>{const l=j,s=A,o=x,t=J,u=I,i=H;return S(),p("div",L,[h("div",O,[h("span",{class:"breadcrumb-item",onClick:Na},C(N(Ze)("shop.title")),1),a[10]||(a[10]=h("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor"},[h("path",{"stroke-linecap":"square","stroke-linejoin":"miter",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})],-1)),h("span",X,C(N(Ze)("shop.buy.title")),1)]),h("div",P,[h("div",F,[h("div",R,[h("h2",Z,C(N(Ze)("shop.buy.productInfo")),1),h("div",T,[h("div",Q,[h("img",{src:aa.value.image,alt:aa.value.name},null,8,z)]),h("div",W,[h("h3",E,C(aa.value.name),1),h("p",Y,C(aa.value.description),1),h("div",K,C(N(n).isDomesticDomain()?"¥":"$")+C(aa.value.price?.toFixed(2)||"0"),1)])]),h("div",ee,[h("label",null,C(N(Ze)("shop.buy.quantity")),1),h("div",ae,[h("button",{class:"qty-btn",onClick:pa},[...a[11]||(a[11]=[h("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor"},[h("path",{"stroke-linecap":"square","stroke-linejoin":"miter",d:"M19.5 12h-15"})],-1)])]),h("span",le,C(ze.value),1),h("button",{class:"qty-btn",onClick:va},[...a[12]||(a[12]=[h("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor"},[h("path",{"stroke-linecap":"square","stroke-linejoin":"miter",d:"M12 4.5v15m7.5-7.5h-15"})],-1)])])])])]),h("div",se,[h("h2",oe,C(N(Ze)("shop.buy.selectCoupon")),1),0===la.value.length?(S(),p("div",te,[a[13]||(a[13]=h("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[h("path",{"stroke-linecap":"square","stroke-linejoin":"miter",d:"M16.5 8.25V6a2.25 2.25 0 00-2.25-2.25H6A2.25 2.25 0 003.75 6v8.25A2.25 2.25 0 006 16.5h2.25m8.25-8.25H18a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25h-2.25m-7.5-10.5H6.375a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v3.375c0 .621-.504 1.125-1.125 1.125z"})],-1)),h("p",null,C(N(Ze)("shop.buy.noCoupon")),1)])):(S(),p("div",ue,[(S(!0),p(y,null,g(la.value,e=>(S(),p("div",{key:e.id,class:$(["coupon-item",{selected:We.value===e.id,disabled:!e.applicable}]),onClick:a=>(e=>{ha.value=e.currency,e.applicable&&(We.value=e.id===We.value?null:e.id,Ca())})(e)},[h("div",ie,[h("div",re,C("USD"===e.currency?"$":e.currency)+C(e.amount),1),h("div",ce,C(N(Ze)("shop.buy.minOrder"))+": "+C("USD"===e.currency?"$":e.currency)+C(e.minAmount),1)]),h("div",de,[h("div",me,C(e.name),1),h("div",ve,C(N(Ze)("shop.buy.expireAt"))+": "+C(e.expiry),1)]),We.value===e.id?(S(),p("div",pe,[...a[14]||(a[14]=[h("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"3",stroke:"currentColor"},[h("path",{"stroke-linecap":"square","stroke-linejoin":"miter",d:"M4.5 12.75l6 6 9-13.5"})],-1)])])):w("",!0)],10,ne))),128))]))]),h("div",he,[h("h2",Ce,C(N(Ze)("shop.buy.shippingAddress")),1),b(i,{model:Ye.value,"label-width":"auto",class:"shipping-form"},{default:f(()=>[h("div",Ne,[b(o,{label:e.$t("checkout.country")},{default:f(()=>[b(s,{modelValue:Ye.value.country,"onUpdate:modelValue":a[0]||(a[0]=e=>Ye.value.country=e),placeholder:e.$t("checkout.chooseCountry"),filterable:""},{default:f(()=>[(S(!0),p(y,null,g(Ke.value,e=>(S(),_(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),h("div",ye,[b(o,{label:e.$t("checkout.lastName")},{default:f(()=>[b(t,{modelValue:Ye.value.lastName,"onUpdate:modelValue":a[1]||(a[1]=e=>Ye.value.lastName=e),placeholder:e.$t("checkout.lastName")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),b(o,{label:e.$t("checkout.firstName")},{default:f(()=>[b(t,{modelValue:Ye.value.firstName,"onUpdate:modelValue":a[2]||(a[2]=e=>Ye.value.firstName=e),placeholder:e.$t("checkout.firstName")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),h("div",ge,[b(o,{label:e.$t("checkout.postalCode")},{default:f(()=>[b(t,{modelValue:Ye.value.postalCode,"onUpdate:modelValue":a[3]||(a[3]=e=>Ye.value.postalCode=e),placeholder:`${e.$t("checkout.postalCode")} (${e.$t("common.optional")})`},{suffix:f(()=>[b(N(U),null,{default:f(()=>[b(N(D))]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),b(o,{label:e.$t("checkout.state")},{default:f(()=>[b(s,{modelValue:Ye.value.state,"onUpdate:modelValue":a[4]||(a[4]=e=>Ye.value.state=e),placeholder:e.$t("checkout.chooseState")},{default:f(()=>[(S(!0),p(y,null,g(ea.value,e=>(S(),_(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),h("div",be,[b(o,{label:e.$t("checkout.city"),class:"full-width"},{default:f(()=>[b(t,{modelValue:Ye.value.city,"onUpdate:modelValue":a[5]||(a[5]=e=>Ye.value.city=e),placeholder:e.$t("checkout.city")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),h("div",fe,[b(o,{label:e.$t("checkout.address1"),class:"full-width"},{default:f(()=>[b(t,{modelValue:Ye.value.address1,"onUpdate:modelValue":a[6]||(a[6]=e=>Ye.value.address1=e),placeholder:e.$t("checkout.address1")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),h("div",we,[b(o,{label:e.$t("checkout.address2"),class:"full-width"},{default:f(()=>[b(t,{modelValue:Ye.value.address2,"onUpdate:modelValue":a[7]||(a[7]=e=>Ye.value.address2=e),placeholder:e.$t("checkout.address2")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),h("div",ke,[b(o,{label:e.$t("checkout.phone"),class:"full-width"},{default:f(()=>[b(t,{modelValue:Ye.value.phone,"onUpdate:modelValue":a[8]||(a[8]=e=>Ye.value.phone=e),placeholder:e.$t("checkout.phone")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),b(o,null,{default:f(()=>[b(u,{modelValue:Ye.value.saveInfo,"onUpdate:modelValue":a[9]||(a[9]=e=>Ye.value.saveInfo=e)},{default:f(()=>[V(C(e.$t("checkout.saveInfo")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),h("div",Se,[h("div",$e,[h("h2",_e,C(N(Ze)("shop.buy.confirmOrder")),1),h("div",Ve,[h("span",He,C(N(Ze)("shop.buy.productInfo")),1),h("span",xe,C(aa.value.name)+" x "+C(ze.value),1)]),h("div",Ae,[h("span",je,C(N(Ze)("shop.buy.subtotal")),1),h("span",Je,C(ia.value),1)]),We.value?(S(),p("div",Ue,[h("span",De,C(N(Ze)("shop.buy.discount")),1),h("span",Ie,"-"+C(ra.value),1)])):w("",!0),h("div",qe,[h("span",Be,C(N(Ze)("shop.buy.shippingFee")),1),h("span",Ge,C(ca.value),1)]),a[15]||(a[15]=h("div",{class:"summary-divider"},null,-1)),h("div",Me,[h("span",Le,C(N(Ze)("shop.buy.total")),1),h("span",Oe,C(da.value),1)]),h("button",{class:"submit-btn",disabled:!ma.value,onClick:ya},C(N(Ze)("shop.buy.submitOrder")),9,Xe)])])])])}}},[["__scopeId","data-v-4d01a4ed"]]);export{Pe as default};
