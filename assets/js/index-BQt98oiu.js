import{F as e,r as t,d as a}from"./index-BrLNRVYc.js";class r{fileServer=new e;static timer=null;duration_seconds=0;constructor(){this.updateTimer=null,this.latestUpdateParams=null}async createProject(e="project"){return new Promise(async(r,s)=>{let n={thumbnail:"",title:e,description:"init",details:{node_card:[],prompt:"",thumbnail:""},tags:["doll"],duration_seconds:0},i=await t.common(a.PROJECT_CREATE,n);0!==i.code?s(i):r(i.data)})}async updateProject(e,r){return new Promise(async(s,n)=>{const i={id:e,...r};this.latestUpdateParams=i,this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(async()=>{try{const e=await t.common(a.PROJECT_UPDATE,this.latestUpdateParams);0!==e.code?n(e):s(e.data)}catch(e){n(e)}finally{this.updateTimer=null}},1e3)})}async deleteProject(e){return new Promise(async(r,s)=>{let n={id:e},i=await t.common(a.PROJECT_DELETE,n);0!==i.code?s(i):r(i.data)})}async getProject(e){return new Promise(async(r,s)=>{let n={id:e},i=await t.common(a.PROJECT_GET,n);0!==i.code?s(i):r(i.data)})}async getProjectList(e){return new Promise(async(r,s)=>{let n=await t.common(a.PROJECT_LIST,e);0!==n.code||r(n.data)})}addProjectDuration=e=>{this.duration_seconds=e,r.timer&&clearInterval(r.timer),r.timer=setInterval(()=>{this.duration_seconds+=1},1e3)};async getCombinedPrompt(e,r={}){try{return new Promise(async(s,n)=>{const i=await t.common(a.combined);if(0===i.code){let t=i.data;!1===r.isHook&&(t=t.filter(e=>!e.title.includes("头部挂钩"))),"E1"===e||"A1"===e?t=t.filter(e=>!e.title.includes("动物坐姿")&&!e.title.includes("人物姿势")&&"D1"!=e.type):"D1"===e&&(t=t.filter(e=>"E1"!==e.type&&"A1"!==e.type));const a={person:{content:"",imgs:[]},animal:{content:"",imgs:[]}};t.sort((e,t)=>e.sortOrder-t.sortOrder);t.filter(e=>"person"===e.type||"general"===e.type||"E1"===e.type||"A1"===e.type).forEach(e=>{if(a.person.content+=e.content,e.imageUrls)try{const t=JSON.parse(e.imageUrls);Array.isArray(t)&&a.person.imgs.push(...t)}catch(t){console.error("解析imageUrls失败:",t)}});t.filter(e=>"animal"===e.type||"general"===e.type||"E1"===e.type||"A1"===e.type).forEach(e=>{if(a.animal.content+=e.content,e.imageUrls)try{const t=JSON.parse(e.imageUrls);Array.isArray(t)&&a.animal.imgs.push(...t)}catch(t){console.error("解析imageUrls失败:",t)}}),s(a)}else n(i.msg)})}catch(s){reject(s)}}async getCommunicationId(){let e=await this.fileServer.getUploadS3Data();console.log(e,"resresres")}}export{r as P};
