import{_ as e,e as a}from"./index-7lN_iYAB.js";/* empty css                 */import{az as n,aA as l,r as t,f as s,I as i,A as o,J as c,B as d,z as r,L as u,R as g,ah as v,u as m,O as p,P as f,Q as h,a5 as y}from"./vendor-zwaLhAD5.js";import{I as _,n as M,F as k,E as C,Q as A,ac as V,C as b,R as w,d as x}from"./elementPlus-CAPqDV7g.js";import{X as z}from"./xiaozhiserve-D6XYZNXy.js";import"./utils-D5HVl94d.js";const D={class:"agent-management"},j={class:"page-header"},P={class:"header-content"},I={class:"header-actions"},U={class:"search-container"},R={class:"agents-section"},B={class:"agents-grid"},E={class:"agent-card-header"},K={class:"agent-name"},Q={class:"agent-actions"},S={class:"agent-card-body"},T={class:"agent-info-item"},$={class:"label"},F={class:"value"},G={class:"agent-info-item"},J={class:"label"},L={class:"value"},O={key:0,class:"agent-info-item"},W={class:"label"},X=["onClick"],q={key:1,class:"loading-container"},H={class:"loading-text"},N={key:2,class:"empty-container"},Y={class:"empty-content"},Z={class:"empty-text"},ee={class:"bind-dialog-content"},ae={class:"dialog-footer"},ne={class:"delete-dialog-content"},le={class:"delete-warning"},te={class:"dialog-footer"},se={key:0,style:{height:"60px"}},ie=e({__name:"AgentManagement",setup(e){const{t:ie}=n(),oe=l(),ce=new z,de=t(!1),re=t(!1),ue=t(""),ge=t(""),ve=t(""),me=t(""),pe=t([]),fe=t(!1),he=t(1),ye=t(10),_e=t(!0),Me=async()=>{if(_e.value)try{fe.value=!0;const e={user_id:"",agent_name:me.value,sync_status:"",page:he.value,page_size:ye.value},a=await ce.listAgent(e);if(0===a.code&&a.data){const e=a.data.items||[];1===he.value?pe.value=e:pe.value=[...pe.value,...e];const n=a.data.total||0;_e.value=pe.value.length<n,he.value++,await ke()}else x.error(a.msg||"获取智能体列表失败")}catch(e){console.error("获取智能体列表出错:",e),x.error("获取智能体列表失败")}finally{fe.value=!1}},ke=async()=>{if(!pe.value.some(e=>"杜小甫"===e.agent_name))try{0===(await ce.createDefaultAgent()).code&&we()}catch(e){console.error("创建默认智能体出错:",e)}},Ce=()=>{Me()},Ae=e=>{ue.value=e.replace(/[^0-9]/g,"").slice(0,6)},Ve=()=>{de.value=!1,ue.value="",ge.value="",ve.value=""},be=async()=>{if(6===ue.value.length){try{fe.value=!0;const e={agent_id:ve.value,verification_code:ue.value},a=await ce.addDeviceAgent(e);console.log("addDeviceAgent响应结果:",a),0===a.code?(x.success("设备绑定成功！"),we()):x.error(a.msg||"设备绑定失败")}catch(e){console.error("设备绑定出错:",e),x.error("设备绑定失败")}finally{fe.value=!1}Ve()}},we=()=>{pe.value=[],he.value=1,_e.value=!0,fe.value=!1,Me()},xe=()=>{re.value=!1,ge.value="",ve.value=""},ze=async()=>{try{fe.value=!0;const e={id:ve.value};0===(await ce.deleteAgent(e)).code?x.success("success"):x.error("err"),we()}catch(e){console.error("删除智能体出错:",e),x.error("智能体删除失败")}finally{fe.value=!1}xe()},De=()=>{oe.push("/add-agent")},je=e=>{we()};return s(()=>{we()}),(e,n)=>{const l=_,t=C,s=k,x=b,z=w;return o(),i(z,{height:"100%",onEndReached:Ce},{default:c(()=>[d("div",D,[d("div",j,[d("div",P,[n[4]||(n[4]=d("h1",{class:"page-title"},null,-1)),d("div",I,[d("div",U,[g(l,{modelValue:me.value,"onUpdate:modelValue":n[0]||(n[0]=e=>me.value=e),placeholder:m(ie)("agentManagement.searchPlaceholder"),"prefix-icon":m(M),clearable:"",onKeyup:v(je,["enter"]),size:"default"},null,8,["modelValue","placeholder","prefix-icon"])]),g(s,{type:"primary",onClick:De},{default:c(()=>[g(t,null,{default:c(()=>[g(m(A))]),_:1}),p(" "+f(m(ie)("agentManagement.addAgent")),1)]),_:1})])])]),d("div",R,[d("div",B,[pe.value.length>0?(o(!0),r(h,{key:0},y(pe.value,e=>(o(),r("div",{class:"agent-card",key:e.id},[d("div",E,[d("h3",K,f(e.agent_name||m(ie)("agentManagement.unnamedAgent")),1),d("div",Q,[g(s,{size:"small",onClick:a=>{return n=e.id,console.log("编辑智能体:",n),void oe.push(`/add-agent?id=${n}`);var n}},{default:c(()=>[p(f(m(ie)("agentManagement.editAgent")),1)]),_:1},8,["onClick"]),g(s,{type:"primary",size:"small",onClick:a=>{return n=e.id,l=e.agent_name,ge.value=l,ve.value=n,de.value=!0,void(ue.value="");var n,l}},{default:c(()=>[p(f(e.sync_status?m(ie)("agentManagement.rebindDevice"):m(ie)("agentManagement.bindDevice")),1)]),_:2},1032,["onClick"]),g(s,{type:"danger",size:"small",onClick:a=>{return n=e.id,l=e.agent_name,ge.value=l,ve.value=n,void(re.value=!0);var n,l}},{default:c(()=>[p(f(m(ie)("agentManagement.deleteAgent")),1)]),_:1},8,["onClick"])])]),d("div",S,[d("div",T,[d("span",$,f(m(ie)("agentManagement.character"))+"：",1),d("span",F,f(e.character||m(ie)("agentManagement.notSet")),1)]),d("div",G,[d("span",J,f(m(ie)("agentManagement.llmModel"))+"：",1),d("span",L,f(e.llm_model||m(ie)("agentManagement.notSet")),1)]),e.device_count>0?(o(),r("div",O,[d("span",W,f(m(ie)("agentManagement.deviceCount"))+"：",1),d("span",{class:"value device-count-link",onClick:a=>{return n=e.id,console.log("查看设备列表:",n),void oe.push(`/device-list/${n}`);var n}},f(e.device_count)+" "+f(m(ie)("agentManagement.devices")),9,X)])):u("",!0)])]))),128)):u("",!0),fe.value&&0===pe.value.length?(o(),r("div",q,[d("div",H,f(m(ie)("agentManagement.loading")),1)])):u("",!0),fe.value||0!==pe.value.length?u("",!0):(o(),r("div",N,[d("div",Y,[g(t,{size:"64"},{default:c(()=>[g(m(V))]),_:1}),d("p",Z,f(m(ie)("agentManagement.noAgents")),1)])]))]),g(x,{modelValue:de.value,"onUpdate:modelValue":n[2]||(n[2]=e=>de.value=e),title:m(ie)("agentManagement.bindDeviceTitle"),width:"400px",center:""},{footer:c(()=>[d("span",ae,[g(s,{onClick:Ve},{default:c(()=>[p(f(m(ie)("common.cancel")),1)]),_:1}),g(s,{type:"primary",onClick:be,disabled:6!==ue.value.length},{default:c(()=>[p(f(m(ie)("agentManagement.confirmBind")),1)]),_:1},8,["disabled"])])]),default:c(()=>[d("div",ee,[d("p",null,f(m(ie)("agentManagement.enterVerificationCode")),1),g(l,{modelValue:ue.value,"onUpdate:modelValue":n[1]||(n[1]=e=>ue.value=e),key:"verification_code",placeholder:m(ie)("agentManagement.verificationCodePlaceholder"),maxlength:"6","show-word-limit":"",onInput:Ae,onKeyup:v(be,["enter"])},null,8,["modelValue","placeholder"])])]),_:1},8,["modelValue","title"]),g(x,{modelValue:re.value,"onUpdate:modelValue":n[3]||(n[3]=e=>re.value=e),title:m(ie)("agentManagement.deleteConfirmTitle"),width:"400px",center:""},{footer:c(()=>[d("span",te,[g(s,{onClick:xe},{default:c(()=>[p(f(m(ie)("common.cancel")),1)]),_:1}),g(s,{type:"danger",onClick:ze},{default:c(()=>[p(f(m(ie)("common.delete")),1)]),_:1})])]),default:c(()=>[d("div",ne,[d("p",null,f(m(ie)("agentManagement.deleteConfirmContent")),1),d("p",le,f(m(ie)("agentManagement.deleteWarning")),1)])]),_:1},8,["modelValue","title"])])]),m(a).isPortraitDevice()?(o(),r("div",se)):u("",!0)]),_:1})}}},[["__scopeId","data-v-444fe26c"]]);export{ie as default};
