import{_ as e}from"./index-B4iIxVom.js";import{D as a,E as s,ag as i,W as l,B as t,d}from"./elementPlus-5sGCOaHt.js";import{aA as n,az as c,aB as v,r as o,c as u,j as r,z as m,A as g,B as p,R as f,J as L,O as y,P as h,u as _,L as b,Q as k,a5 as A}from"./vendor-ClluBQmh.js";import{d as D}from"./date-CgH6eVIF.js";import{X as x}from"./xiaozhiserve-CvnNKifO.js";import"./utils-D5ZNaMwG.js";const C={class:"device-list"},j={class:"page-header"},z={class:"header-content"},w={class:"devices-section"},S={class:"devices-grid"},I={class:"device-card-body"},T={class:"device-info-item"},B={class:"label"},P={class:"value"},V={class:"device-info-item"},E={class:"label"},F={class:"value"},M={class:"device-info-item"},R={class:"label"},U={class:"value"},W={class:"device-actions"},J={key:1,class:"loading-container"},O={class:"loading-text"},Q={key:2,class:"loading-more-container"},X={class:"loading-more-text"},q={key:3,class:"no-more-container"},G={class:"no-more-text"},H={key:4,class:"empty-container"},K={class:"empty-content"},N={class:"empty-text"},Y={class:"unbind-dialog-content"},Z={class:"dialog-footer"},$=e({__name:"DeviceList",setup(e){const $=n(),{t:ee}=c(),ae=v(),se=new x,ie=o([]),le=o(!1),te=o(!0),de=u(()=>ae.params.agentId),ne=o(1),ce=o(10),ve=o(0),oe=o(!1),ue=o(""),re=async()=>{if(te.value&&!le.value)try{le.value=!0,console.log("调用deviceListAgent，agentId:",de.value,"currentPage:",ne.value,"pageSize:",ce.value);const e=await se.deviceListAgent({agent_id:de.value,page:ne.value,page_size:ce.value});console.log("deviceListAgent响应结果:",e);let a=[];0===e.code&&e.data&&(a=e.data.items||[],ve.value=e.data.total||0),1===ne.value?ie.value=a:ie.value=[...ie.value,...a],te.value=ie.value.length<ve.value,ne.value++}catch(e){console.error("获取设备列表出错:",e)}finally{le.value=!1}},me=()=>{re()},ge=()=>{oe.value=!1,ue.value=""},pe=async()=>{try{le.value=!0,console.log("调用unbindDeviceAgent，deviceId:",ue.value);const e=await se.unbindDeviceAgent({device_id:ue.value});console.log("unbindDeviceAgent响应结果:",e),0===e.code?(d.success(ee("deviceList.unbindSuccess")),fe()):d.error(e.msg||ee("deviceList.unbindFailed"))}catch(e){console.error("解除绑定设备出错:",e),d.error(ee("deviceList.unbindFailed"))}finally{le.value=!1,oe.value=!1,ue.value=""}},fe=()=>{ne.value=1,le.value=!1,te.value=!0,ie.value=[],ve.value=0,re()},Le=()=>{$.back()};return r(()=>{fe()}),(e,d)=>{const n=a,c=s,v=l,o=t;return g(),m("div",C,[p("div",j,[p("div",z,[f(n,{type:"default",plain:"",onClick:Le},{default:L(()=>[y(h(_(ee)("common.back")),1)]),_:1})])]),d[1]||(d[1]=p("div",{style:{height:"10px",width:"100%"}},null,-1)),f(v,{height:"83vh",onEndReached:me},{default:L(()=>[p("div",w,[p("div",S,[ie.value.length>0?(g(!0),m(k,{key:0},A(ie.value,e=>(g(),m("div",{class:"device-card",key:e.id},[p("div",I,[p("div",T,[p("span",B,h(_(ee)("deviceList.macAddress"))+"：",1),p("span",P,h(e.mac_address||_(ee)("deviceList.notSet")),1)]),p("div",V,[p("span",E,h(_(ee)("deviceList.createdAt"))+"：",1),p("span",F,h(_(D).formatDateTime(e.created_at)||_(ee)("deviceList.notSet")),1)]),p("div",M,[p("span",R,h(_(ee)("deviceList.updatedAt"))+"：",1),p("span",U,h(_(D).formatDateTime(e.updated_at)||_(ee)("deviceList.notSet")),1)]),p("div",W,[f(n,{type:"danger",size:"small",onClick:a=>{return s=e.id,ue.value=s,void(oe.value=!0);var s}},{default:L(()=>[y(h(_(ee)("deviceList.unbindDevice")),1)]),_:1},8,["onClick"])])])]))),128)):b("",!0),le.value&&0===ie.value.length?(g(),m("div",J,[p("div",O,h(_(ee)("deviceList.loading")),1)])):b("",!0),le.value&&ie.value.length>0?(g(),m("div",Q,[p("div",X,h(_(ee)("deviceList.loadingMore")),1)])):b("",!0),!le.value&&!te.value.value&&ie.value.length>0?(g(),m("div",q,[p("div",G,h(_(ee)("deviceList.noMoreDevices")),1)])):b("",!0),le.value||0!==ie.value.length?b("",!0):(g(),m("div",H,[p("div",K,[f(c,{size:"64"},{default:L(()=>[f(_(i))]),_:1}),p("p",N,h(_(ee)("deviceList.noDevices")),1)])]))])])]),_:1}),f(o,{modelValue:oe.value,"onUpdate:modelValue":d[0]||(d[0]=e=>oe.value=e),title:_(ee)("deviceList.unbindConfirmTitle"),width:"400px",center:""},{footer:L(()=>[p("span",Z,[f(n,{onClick:ge},{default:L(()=>[y(h(_(ee)("common.cancel")),1)]),_:1}),f(n,{type:"danger",onClick:pe},{default:L(()=>[y(h(_(ee)("deviceList.confirmUnbind")),1)]),_:1})])]),default:L(()=>[p("div",Y,[p("p",null,h(_(ee)("deviceList.unbindConfirmContent")),1)])]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-6f12146d"]]);export{$ as default};
