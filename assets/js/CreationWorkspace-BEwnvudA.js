import{_ as e,e as a}from"./index-7lN_iYAB.js";import{az as t,aA as l,r as s,f as o,z as r,A as c,B as n,R as i,L as d,J as v,Q as u,a5 as p,W as m,u as g,P as f}from"./vendor-zwaLhAD5.js";import{q as j,y as D,Q as h,R as k,S as y}from"./elementPlus-CAPqDV7g.js";import{S as w}from"./SeriesSelector-J57EWwo-.js";import{P as b}from"./index-CzS7cRl4.js";import{d as C}from"./date-CgH6eVIF.js";import"./utils-D5HVl94d.js";const _={class:"creation-workspace"},x={class:"projects-grid"},W=["onDragstart","onDrop","onDragenter"],$={class:"project-thumbnail"},L=["src"],P={key:1,class:"project-thumbnail-default"},Y={class:"project-icon"},I={class:"project-file-name"},T={class:"project-info"},E={class:"project-title"},H={class:"project-desc"},M={class:"project-tags"},S={class:"project-meta"},z={class:"project-date"},A=["onClick"],R={class:"overlay-content"},q={class:"view-center-btn"},B={class:"new-project-icon"},Q={class:"new-project-text"},F={key:0,style:{height:"60px"}},J={class:"trash-content"},N={class:"trash-icon"},O={class:"modal-header"},G={class:"modal-title"},K={class:"modal-body"},U={class:"delete-confirm-content"},V={class:"delete-confirm-icon"},X={class:"delete-confirm-text"},Z={class:"delete-confirm-project-name"},ee={class:"delete-confirm-actions"},ae=e({__name:"CreationWorkspace",setup(e){const{formatDate:ae}=C,te=new b,{t:le}=t(),se=l(),oe=s(!1),re=s(""),ce=s(""),ne=s(""),ie=s(null),de=s(null),ve=s([]),ue=s(1),pe=s(15),me=s(0),ge=s(!1),fe=s(!1),je=s(null),De=s(!1),he=s(null),ke=s(!1),ye=s(null),we=s(!1),be=()=>{Ce()},Ce=async()=>{if(!fe.value){ge.value=!0;try{const e={page:ue.value,page_size:pe.value},a=await te.getProjectList(e);1===ue.value?ve.value=a.items:ve.value=[...ve.value,...a.items],me.value=a.total,fe.value=ve.value.length>=me.value,ue.value++}catch(e){console.error("获取项目列表异常:",e)}finally{ge.value=!1}}},_e=e=>{const a=e.target.files[0];if(a)if(a.type.startsWith("image/"))if(a.size>2097152)console.error("图片文件大小不能超过2MB");else{try{console.log("选择的文件:",a),console.log("缩略图更新成功"),oe.value=!1,re.value="",ce.value="",ne.value="",ie.value=null}catch(t){console.error("上传失败:",t)}e.target.value=""}else console.error("请选择图片文件")},xe=e=>{we.value=!1,(e=>{se.push(`/project/new/${e.product_info.mark}`)})(e)},We=()=>{we.value=!1},$e=e=>{for(;e&&!e.classList.contains("project-card");)e=e.parentElement;return e},Le=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},Pe=(e,a)=>{const t=$e(e.target);if(t&&(t.classList.add("drag-over"),he.value=t,je.value&&a&&je.value.id!==a.id)){const e=ve.value.findIndex(e=>e.id===je.value.id),t=ve.value.findIndex(e=>e.id===a.id);if(-1!==e&&-1!==t){const[a]=ve.value.splice(e,1);ve.value.splice(t,0,a)}}},Ye=e=>{const a=$e(e.target);a&&(a.classList.remove("drag-over"),a===he.value&&(he.value=null))},Ie=()=>{je.value&&(ye.value=je.value,ke.value=!0),De.value=!1},Te=()=>{ye.value&&((async e=>{const a=ve.value.findIndex(a=>a.id===e.id);-1!==a&&(ve.value.splice(a,1),await te.deleteProject(e.id))})(ye.value),ye.value=null,ke.value=!1)},Ee=()=>{ye.value=null,ke.value=!1};return o(()=>{Ce()}),(e,t)=>{const l=k;return c(),r("div",_,[n("input",{ref_key:"fileInput",ref:de,type:"file",accept:"image/*",style:{display:"none"},onChange:_e},null,544),i(l,{height:"100%",onEndReached:be},{default:v(()=>[n("div",x,[(c(!0),r(u,null,p(ve.value,e=>(c(),r("div",{key:e.id,class:"project-card",draggable:"true",onDragstart:a=>((e,a)=>{je.value=a,De.value=!0,e.target.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",a.id),e.dataTransfer.setDragImage(new Image,0,0)})(a,e),onDragover:t[0]||(t[0]=m(e=>Le(e),["prevent"])),onDrop:e=>(e=>{e.preventDefault();const a=$e(e.target);a&&a.classList.remove("drag-over"),je.value=null})(e),onDragenter:a=>Pe(a,e),onDragleave:t[1]||(t[1]=e=>Ye(e)),onDragend:t[2]||(t[2]=e=>{return a=e,De.value=!1,he.value=null,a.target.classList.remove("dragging"),void document.querySelectorAll(".project-card").forEach(e=>{e.classList.remove("drag-over")});var a})},[n("div",$,[e.thumbnail?(c(),r("img",{key:0,src:e.thumbnail,alt:"{{ project.title }}",class:"project-thumbnail-image"},null,8,L)):(c(),r("div",P,[n("div",Y,[i(g(j))]),n("span",I,f(e.title),1)]))]),n("div",T,[n("h3",E,f(e.title),1),n("p",H,f(g(ae)(e.created_at,"YYYY-MM-DD HH:mm:ss")),1),n("div",M,[(c(!0),r(u,null,p(e.tags,e=>(c(),r("span",{key:e,class:"project-tag"},f(e),1))),128))]),n("div",S,[t[8]||(t[8]=n("span",{class:"project-date"},null,-1)),n("span",z,f(g(ae)(e.updated_at,"YYYY-MM-DD HH:mm:ss")),1)])]),n("div",{class:"project-overlay combined-overlay",onClick:m(a=>(e=>{let a=e.tags[0];switch(a){case"Oone":a="E1";break;case"Done":a="D1"}se.push(`/project/${e.id}/${a}`)})(e),["stop"])},[n("div",R,[n("div",q,[i(g(D),{class:"btn-icon"})])])],8,A)],40,W))),128)),n("div",{class:"new-project-card",onClick:t[3]||(t[3]=e=>we.value=!0)},[n("div",B,[i(g(h))]),n("span",Q,f(e.$t("creationWorkspace.createNewProject")),1)])]),g(a).isPortraitDevice()?(c(),r("div",F)):d("",!0)]),_:1}),De.value?(c(),r("div",{key:0,class:"trash-drawer",onDragover:t[4]||(t[4]=m(e=>Le(e),["prevent"])),onDrop:Ie,onDragenter:t[5]||(t[5]=e=>Pe(e)),onDragleave:t[6]||(t[6]=e=>Ye(e))},[n("div",J,[n("h3",null,f(e.$t("creationWorkspace.dropToDelete")),1),n("div",N,[i(g(y),{class:"trash-main-icon"})]),n("p",null,f(e.$t("creationWorkspace.dropToDeleteHint")),1)])],32)):d("",!0),ke.value?(c(),r("div",{key:1,class:"modal-overlay",onClick:Ee},[n("div",{class:"modal-content",onClick:t[7]||(t[7]=m(()=>{},["stop"]))},[n("div",O,[n("h2",G,f(e.$t("creationWorkspace.deleteProject")),1)]),n("div",K,[n("div",U,[n("div",V,[i(g(y),{class:"delete-main-icon"})]),n("p",X,f(e.$t("creationWorkspace.dropToDeleteHint")),1),n("p",Z,f(ye.value?.title),1),n("div",ee,[n("button",{class:"modal-action-btn cancel",onClick:Ee},f(e.$t("creationWorkspace.cancel")),1),n("button",{class:"modal-action-btn delete",onClick:Te},f(e.$t("creationWorkspace.confirmDelete")),1)])])])])])):d("",!0),i(w,{show:we.value,onConfirm:xe,onCancel:We},null,8,["show"])])}}},[["__scopeId","data-v-1c07c0fe"]]);export{ae as default};
