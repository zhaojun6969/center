import{_ as e,u as t}from"./index-7lN_iYAB.js";/* empty css                     *//* empty css                 *//* empty css                 *//* empty css                    *//* empty css                         */import{U as a}from"./index-B5bLabF4.js";import{az as l,r as s,c as n,f as i,z as r,A as o,B as u,I as m,R as c,J as d,O as p,u as v,P as g,Q as y,a5 as C,L as h}from"./vendor-zwaLhAD5.js";import{E as S,O as k,F as $,aO as b,a9 as z,aa as f,aP as _,ak as w,ad as R,aQ as P,I as T,a0 as U,aR as A,C as V,d as D}from"./elementPlus-CAPqDV7g.js";import"./utils-D5HVl94d.js";const Y={class:"invite-records-container"},j={class:"page-header"},x={class:"tab-content"},I={key:0,class:"loading-container"},E={key:1,class:"empty-container"},M={key:2,class:"table-container"},L={class:"details-table"},O={class:"pagination-container"},N={class:"tab-content"},Q={class:"filter-form"},B={key:0,class:"loading-container"},F={key:1,class:"table-container"},J={class:"details-table"},q={key:0},G={colspan:"5",class:"empty-table-cell"},K={class:"pagination-container"},H={class:"tab-content"},W={class:"settlement-header"},X={class:"settlement-statistics"},Z={class:"stat-item"},ee={class:"stat-label"},te={class:"stat-value"},ae={class:"stat-item"},le={class:"stat-label"},se={class:"stat-value"},ne={class:"stat-item"},ie={class:"stat-label"},re={class:"stat-value"},oe={class:"stat-item"},ue={class:"stat-label"},me={class:"stat-value"},ce={class:"stat-item"},de={class:"stat-label"},pe={class:"stat-value"},ve={class:"stat-item"},ge={class:"stat-label"},ye={class:"stat-value"},Ce={class:"stat-item"},he={class:"stat-label"},Se={class:"stat-value"},ke={key:0,class:"loading-container"},$e={key:1,class:"table-container"},be={class:"details-table"},ze={key:0},fe={colspan:"8",class:"empty-table-cell"},_e={class:"pagination-container"},we={key:1,class:"single-tab-content"},Re={key:0,class:"loading-container"},Pe={key:1,class:"empty-container"},Te={key:2,class:"table-container"},Ue={class:"details-table"},Ae={class:"pagination-container"},Ve={class:"dialog-footer"},De=e({__name:"invite-records",setup(e){const{t:De}=l(),Ye=t(),je=new a,xe=()=>{window.history.back()},Ie=s({role:"2"==Ye.user?.userRole?"creator":"free"}),Ee=s("points"),Me=s([]),Le=s([]),Oe=s([]),Ne=s({pendingSettlement:0,unsettled:0,settled:0,pendingCommission:0,unsettledCommission:0,settledCommission:0,commissionRate:0}),Qe=s(0),Be=s(0),Fe=s({points:!1,commission:!1,settlement:!1,statistics:!1}),Je=s({startTime:"",endTime:"",email:""}),qe=s({points:{currentPage:1,pageSize:10},commission:{currentPage:1,pageSize:10},settlement:{currentPage:1,pageSize:10}}),Ge=s(!1),Ke=s({applyRemark:""}),He=s(!1),We=n(()=>{const e=(qe.value.points.currentPage-1)*qe.value.points.pageSize,t=e+qe.value.points.pageSize;return Me.value.slice(e,t)}),Xe=n(()=>{const e=(qe.value.commission.currentPage-1)*qe.value.commission.pageSize,t=e+qe.value.commission.pageSize;return Le.value.slice(e,t)}),Ze=n(()=>{const e=(qe.value.settlement.currentPage-1)*qe.value.settlement.pageSize,t=e+qe.value.settlement.pageSize;return Oe.value.slice(e,t)}),et=async()=>{if("creator"===Ie.value.role)try{Fe.value.commission=!0;const e={pageSize:qe.value.commission.pageSize,pageNum:qe.value.commission.currentPage,orderByColumn:"orderTime",isAsc:"desc"};Je.value.startTime&&(e.startTime=new Date(Je.value.startTime).toISOString().slice(0,19)+"+08:00"),Je.value.endTime&&(e.endTime=new Date(Je.value.endTime).toISOString().slice(0,19)+"+08:00"),Je.value.email&&(e.email=Je.value.email);const t=await je.getInviteCommissionRecords(e);200!==t.code&&0!==t.code||(Le.value=t.rows.map(e=>({maskedEmail:e.maskedEmail,actualAmount:e.actualAmount,commissionRate:e.commissionRate,commissionAmount:e.commissionAmount,orderTime:new Date(e.orderTime).toLocaleString()})),Qe.value=t.total||0)}catch(e){console.error("获取佣金记录失败:",e)}finally{Fe.value.commission=!1}},tt=e=>{qe.value.points.currentPage=e},at=e=>{qe.value.points.pageSize=e,qe.value.points.currentPage=1},lt=e=>{qe.value.commission.currentPage=e},st=e=>{qe.value.commission.pageSize=e,qe.value.commission.currentPage=1},nt=e=>{"points"===e?(async()=>{try{Fe.value.points=!0;const e=await je.getInviteRecords();e.success&&(Me.value=e.data.map(e=>({invitedUser:e.invitedUserNickname,points:e.rewards.reduce((e,t)=>e+t.rewardScore,0),date:new Date(e.invitedAt).toLocaleDateString()})))}catch(e){console.error("获取积分记录失败:",e)}finally{Fe.value.points=!1}})():"commission"===e?et():"settlement"===e&&(rt(),ot())},it=()=>{qe.value.commission.currentPage=1,et()},rt=async()=>{if("creator"===Ie.value.role)try{Fe.value.settlement=!0;const e={pageSize:qe.value.settlement.pageSize,pageNum:qe.value.settlement.currentPage},t=await je.getSettlementList(e);(0===t.code||t.success)&&(Oe.value=t.data.list.map(e=>({id:e.id,settlementAmount:e.apply_amount,commissionAmount:e.commission_amount,status:e.status,applyRemark:e.apply_remark,reviewRemark:e.review_remark,applyTime:new Date(e.created_at).toLocaleString(),processTime:e.review_time?new Date(e.review_time).toLocaleString():""})),Be.value=t.data.total||0)}catch(e){console.error("获取结算记录失败:",e)}finally{Fe.value.settlement=!1}},ot=async()=>{if("creator"===Ie.value.role)try{Fe.value.statistics=!0;const e=await je.getSettlementStatistics();(0===e.code||e.success)&&(console.log("Settlement Statistics Response:",e),e.data&&(Ne.value={pendingSettlement:e.data.pending_amount||0,unsettled:e.data.unsettled_amount||0,settled:e.data.settled_amount||0,pendingCommission:e.data.pending_commission||0,unsettledCommission:e.data.unsettled_commission||0,settledCommission:e.data.settled_commission||0,commissionRate:e.data.commission_rate||0}))}catch(e){console.error("获取佣金结算统计信息失败:",e)}finally{Fe.value.statistics=!1}},ut=()=>{Ge.value=!0},mt=async()=>{try{He.value=!0;const e=await je.applySettlement({apply_remark:Ke.value.applyRemark});(0===e.code||e.success)&&(Ge.value=!1,Ke.value.applyRemark="",rt(),D.success($t("userCenter.creator.applySettlementSuccess")))}catch(e){console.error("申请结算失败:",e),D.error($t("userCenter.creator.applySettlementFailed"))}finally{He.value=!1}},ct=()=>{Ge.value=!1,Ke.value.applyRemark=""},dt=e=>{qe.value.settlement.currentPage=e,rt()},pt=e=>{qe.value.settlement.pageSize=e,qe.value.settlement.currentPage=1,rt()},vt=()=>{Je.value.startTime="",Je.value.endTime="",Je.value.email="",qe.value.commission.currentPage=1,et()};return i(()=>{nt(Ee.value)}),(e,t)=>{const a=S,l=$,s=z,n=f,i=_,D=b,De=P,Ye=R,je=T,et=w,rt=U,ot=A,gt=V;return o(),r("div",Y,[u("div",j,[c(l,{onClick:xe,class:"back-button"},{default:d(()=>[c(a,null,{default:d(()=>[c(v(k))]),_:1}),p(" "+g(e.$t("common.back")),1)]),_:1})]),"creator"===Ie.value.role?(o(),m(ot,{key:0,modelValue:Ee.value,"onUpdate:modelValue":t[9]||(t[9]=e=>Ee.value=e),class:"invite-tabs",onTabChange:nt},{default:d(()=>[c(D,{label:e.$t("userCenter.invitation.invitePointsDetails"),name:"points"},{default:d(()=>[u("div",x,[Fe.value.points?(o(),r("div",I,[c(s,{rows:3,animated:""})])):0===Me.value.length?(o(),r("div",E,[c(n,{description:e.$t("userCenter.invitation.noInviteRecords")},null,8,["description"])])):(o(),r("div",M,[u("table",L,[u("thead",null,[u("tr",null,[u("th",null,g(e.$t("userCenter.invitation.invitedUser")),1),u("th",null,g(e.$t("userCenter.invitation.pointsEarned")),1),u("th",null,g(e.$t("userCenter.invitation.date")),1)])]),u("tbody",null,[(o(!0),r(y,null,C(We.value,(e,t)=>(o(),r("tr",{key:t},[u("td",null,g(e.invitedUser),1),u("td",null,g(e.points),1),u("td",null,g(e.date),1)]))),128))])]),u("div",O,[c(i,{"current-page":qe.value.points.currentPage,"onUpdate:currentPage":t[0]||(t[0]=e=>qe.value.points.currentPage=e),"page-size":qe.value.points.pageSize,"onUpdate:pageSize":t[1]||(t[1]=e=>qe.value.points.pageSize=e),"page-sizes":[5,10,20,50],layout:"total, sizes, prev, pager, next, jumper",total:Me.value.length,onSizeChange:at,onCurrentChange:tt},null,8,["current-page","page-size","total"])])]))])]),_:1},8,["label"]),c(D,{label:e.$t("userCenter.creator.commissionRecords"),name:"commission"},{default:d(()=>[u("div",N,[u("div",Q,[c(et,{inline:!0,class:"demo-form-inline",size:"small"},{default:d(()=>[c(Ye,{label:e.$t("userCenter.creator.startTime")},{default:d(()=>[c(De,{modelValue:Je.value.startTime,"onUpdate:modelValue":t[2]||(t[2]=e=>Je.value.startTime=e),type:"date",placeholder:e.$t("common.selectStartTime"),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),c(Ye,{label:e.$t("userCenter.creator.endTime")},{default:d(()=>[c(De,{modelValue:Je.value.endTime,"onUpdate:modelValue":t[3]||(t[3]=e=>Je.value.endTime=e),type:"date",placeholder:e.$t("common.selectEndTime"),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),c(Ye,{label:e.$t("userCenter.creator.email")},{default:d(()=>[c(je,{modelValue:Je.value.email,"onUpdate:modelValue":t[4]||(t[4]=e=>Je.value.email=e),placeholder:e.$t("common.inputEmail"),clearable:"",style:{width:"200px"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),c(Ye,null,{default:d(()=>[c(l,{type:"primary",onClick:it,loading:Fe.value.commission},{default:d(()=>[p(g(e.$t("common.search")),1)]),_:1},8,["loading"]),c(l,{onClick:vt},{default:d(()=>[p(g(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),Fe.value.commission?(o(),r("div",B,[c(s,{rows:3,animated:""})])):(o(),r("div",F,[u("table",J,[u("thead",null,[u("tr",null,[u("th",null,g(e.$t("userCenter.creator.invitedUserEmail")),1),u("th",null,g(e.$t("userCenter.creator.actualAmount")),1),u("th",null,g(e.$t("userCenter.creator.commissionRate")),1),u("th",null,g(e.$t("userCenter.creator.commissionAmount")),1),u("th",null,g(e.$t("userCenter.creator.orderTime")),1)])]),u("tbody",null,[0===Le.value.length?(o(),r("tr",q,[u("td",G,[c(n,{description:e.$t("userCenter.creator.noCommissionRecords")},null,8,["description"])])])):h("",!0),(o(!0),r(y,null,C(Xe.value,(e,t)=>(o(),r("tr",{key:t},[u("td",null,g(e.maskedEmail),1),u("td",null,g(e.actualAmount),1),u("td",null,g(e.commissionRate)+"%",1),u("td",null,g(e.commissionAmount),1),u("td",null,g(e.orderTime),1)]))),128))])]),u("div",K,[c(i,{"current-page":qe.value.commission.currentPage,"onUpdate:currentPage":t[5]||(t[5]=e=>qe.value.commission.currentPage=e),"page-size":qe.value.commission.pageSize,"onUpdate:pageSize":t[6]||(t[6]=e=>qe.value.commission.pageSize=e),"page-sizes":[5,10,20,50],layout:"total, sizes, prev, pager, next, jumper",total:Qe.value,onSizeChange:st,onCurrentChange:lt},null,8,["current-page","page-size","total"])])]))])]),_:1},8,["label"]),c(D,{label:e.$t("userCenter.creator.commissionSettlement"),name:"settlement"},{default:d(()=>[u("div",H,[u("div",W,[u("div",X,[u("div",Z,[u("div",ee,g(e.$t("userCenter.creator.pendingSettlement")),1),u("div",te,g(Ne.value.pendingSettlement),1)]),u("div",ae,[u("div",le,g(e.$t("userCenter.creator.unsettled")),1),u("div",se,g(Ne.value.unsettled),1)]),u("div",ne,[u("div",ie,g(e.$t("userCenter.creator.settled")),1),u("div",re,g(Ne.value.settled),1)]),u("div",oe,[u("div",ue,g(e.$t("userCenter.creator.pendingCommission")),1),u("div",me,g(Ne.value.pendingCommission),1)]),u("div",ce,[u("div",de,g(e.$t("userCenter.creator.unsettledCommission")),1),u("div",pe,g(Ne.value.unsettledCommission),1)]),u("div",ve,[u("div",ge,g(e.$t("userCenter.creator.settledCommission")),1),u("div",ye,g(Ne.value.settledCommission),1)]),u("div",Ce,[u("div",he,g(e.$t("userCenter.creator.currentCommissionRate")),1),u("div",Se,g(Ne.value.commissionRate)+"%",1)])]),c(l,{type:"primary",onClick:ut},{default:d(()=>[p(g(e.$t("userCenter.creator.applySettlement")),1)]),_:1})]),Fe.value.settlement?(o(),r("div",ke,[c(s,{rows:3,animated:""})])):(o(),r("div",$e,[u("table",be,[u("thead",null,[u("tr",null,[t[14]||(t[14]=u("th",null,"ID",-1)),u("th",null,g(e.$t("userCenter.creator.settlementAmount")),1),u("th",null,g(e.$t("userCenter.creator.commissionAmount")),1),u("th",null,g(e.$t("userCenter.creator.settlementStatus")),1),u("th",null,g(e.$t("userCenter.creator.applyRemark")),1),u("th",null,g(e.$t("userCenter.creator.reviewRemark")),1),u("th",null,g(e.$t("userCenter.creator.applyTime")),1),u("th",null,g(e.$t("userCenter.creator.processTime")),1)])]),u("tbody",null,[0===Oe.value.length?(o(),r("tr",ze,[u("td",fe,[c(n,{description:e.$t("userCenter.creator.noSettlementRecords")},null,8,["description"])])])):h("",!0),(o(!0),r(y,null,C(Ze.value,(t,a)=>(o(),r("tr",{key:t.id},[u("td",null,g(t.id),1),u("td",null,g(t.settlementAmount),1),u("td",null,g(t.commissionAmount),1),u("td",null,[c(rt,{type:0===t.status?"warning":1===t.status?"success":"danger"},{default:d(()=>[p(g(0===t.status?e.$t("userCenter.creator.pending"):1===t.status?e.$t("userCenter.creator.approved"):e.$t("userCenter.creator.rejected")),1)]),_:2},1032,["type"])]),u("td",null,g(t.applyRemark||"-"),1),u("td",null,g(t.reviewRemark||"-"),1),u("td",null,g(t.applyTime),1),u("td",null,g(t.processTime||"-"),1)]))),128))])]),u("div",_e,[c(i,{"current-page":qe.value.settlement.currentPage,"onUpdate:currentPage":t[7]||(t[7]=e=>qe.value.settlement.currentPage=e),"page-size":qe.value.settlement.pageSize,"onUpdate:pageSize":t[8]||(t[8]=e=>qe.value.settlement.pageSize=e),"page-sizes":[5,10,20,50],layout:"total, sizes, prev, pager, next, jumper",total:Be.value,onSizeChange:pt,onCurrentChange:dt},null,8,["current-page","page-size","total"])])]))])]),_:1},8,["label"])]),_:1},8,["modelValue"])):(o(),r("div",we,[Fe.value.points?(o(),r("div",Re,[c(s,{rows:3,animated:""})])):0===Me.value.length?(o(),r("div",Pe,[c(n,{description:e.$t("userCenter.invitation.noInviteRecords")},null,8,["description"])])):(o(),r("div",Te,[u("table",Ue,[u("thead",null,[u("tr",null,[u("th",null,g(e.$t("userCenter.invitation.invitedUser")),1),u("th",null,g(e.$t("userCenter.invitation.pointsEarned")),1),u("th",null,g(e.$t("userCenter.invitation.date")),1)])]),u("tbody",null,[(o(!0),r(y,null,C(We.value,(e,t)=>(o(),r("tr",{key:t},[u("td",null,g(e.invitedUser),1),u("td",null,g(e.points),1),u("td",null,g(e.date),1)]))),128))])]),u("div",Ae,[c(i,{"current-page":qe.value.points.currentPage,"onUpdate:currentPage":t[10]||(t[10]=e=>qe.value.points.currentPage=e),"page-size":qe.value.points.pageSize,"onUpdate:pageSize":t[11]||(t[11]=e=>qe.value.points.pageSize=e),"page-sizes":[5,10,20,50],layout:"total, sizes, prev, pager, next, jumper",total:Me.value.length,onSizeChange:at,onCurrentChange:tt},null,8,["current-page","page-size","total"])])]))])),c(gt,{modelValue:Ge.value,"onUpdate:modelValue":t[13]||(t[13]=e=>Ge.value=e),title:e.$t("userCenter.creator.applySettlement"),width:"500px","close-on-click-modal":!1},{footer:d(()=>[u("span",Ve,[c(l,{onClick:ct},{default:d(()=>[p(g(e.$t("common.cancel")),1)]),_:1}),c(l,{type:"primary",onClick:mt,loading:He.value},{default:d(()=>[p(g(e.$t("common.confirm")),1)]),_:1},8,["loading"])])]),default:d(()=>[c(et,{model:Ke.value,"label-width":"100px"},{default:d(()=>[c(Ye,{label:e.$t("userCenter.creator.applyRemark"),required:""},{default:d(()=>[c(je,{modelValue:Ke.value.applyRemark,"onUpdate:modelValue":t[12]||(t[12]=e=>Ke.value.applyRemark=e),type:"textarea",rows:4,placeholder:e.$t("userCenter.creator.enterApplyRemark"),maxlength:"200","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-5160400a"]]);export{De as default};
