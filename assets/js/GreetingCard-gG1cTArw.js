import{_ as e,e as a,F as t}from"./index-BrLNRVYc.js";/* empty css                     *//* empty css                 *//* empty css                 */import{D as l,E as s,Q as r,F as i,ar as d,y as n,S as c,aa as g,al as o,ae as u,as as m,at as p,I as v,e as f,au as C,C as y,d as h}from"./elementPlus-C3N3Ediy.js";import{r as w}from"./utils-D5HVl94d.js";import{az as b,r as $,f as _,l as M,c as U,al as k,z as x,A as V,B as F,L as T,R as B,P as L,I as j,J as D,O as G,u as P,Q as R,a5 as q}from"./vendor-zwaLhAD5.js";import{G as z}from"./index-DcnNDhno.js";const I=l(w()),S={class:"greeting-card-page"},E={class:"page-header"},Y={class:"header-content"},A={class:"page-title"},W={class:"a1-series-tip"},H={class:"tip-card"},Q={class:"tip-header"},J={class:"tip-title-section"},N={class:"tip-title"},O={class:"tip-subtitle"},K={class:"tip-features"},X={class:"tip-feature"},Z={class:"feature-content"},ee={class:"tip-feature"},ae={class:"feature-content"},te={class:"tip-feature"},le={class:"feature-content"},se={class:"main-content"},re={class:"action-bar"},ie={key:0,class:"card-grid"},de={class:"card-image-wrapper"},ne=["src"],ce={class:"card-overlay"},ge={class:"card-date"},oe={class:"card-body"},ue={class:"card-message"},me={class:"card-actions"},pe={key:0,style:{height:"60px"}},ve=["src"],fe={key:1,class:"upload-placeholder"},Ce={class:"upload-text"},ye={class:"form-item-label"},he={class:"form-item-label"},we={class:"dialog-footer"},be={class:"delete-confirm-content"},$e={class:"delete-message"},_e={class:"dialog-footer"},Me=e({__name:"GreetingCard",setup(e){const l=new t,w=new z,{t:Me,locale:Ue}=b(),ke=$([]),xe=async()=>{try{const e=await w.getMyGreetingCardList();ke.value=e.rows.map(e=>({id:e.id,imageUrl:e.extraInfo.image.replace(/`/g,"").trim(),message:e.content,createTime:e.createdAt,cardMessage:e.extraInfo.cardMessage}))}catch(e){h.error(e.message||Me("greetingCard.loadError"))}};_(()=>{xe()});const Ve=$(!1),Fe=$(!1),Te=$(!1),Be=$(!1),Le=$(!1),je=$(null),De=M({imageUrl:"",message:"",id:null,cardMessage:""}),Ge=$(null),Pe=M({id:null,imageUrl:"",message:"",cardMessage:""}),Re=U(()=>({imageUrl:[{required:!0,message:Me("greetingCard.imageRequired"),trigger:"change"}],message:[{required:!0,message:Me("greetingCard.messageRequired"),trigger:"blur"}],cardMessage:[{required:!0,message:Me("greetingCard.cardMessageRequired"),trigger:"blur"}]})),qe=U(()=>"undefined"==typeof window?"500px":window.innerWidth<768?"90%":"500px"),ze=U(()=>"undefined"==typeof window?"400px":window.innerWidth<768?"90%":"400px"),Ie=U(()=>"zh"===Ue.value?150:200),Se=U(()=>(Ue.value,30)),Ee=()=>{Fe.value=!1,Pe.id=null,Pe.imageUrl="",Pe.message="",Pe.cardMessage="",Ve.value=!0},Ye=async()=>{if(je.value)try{await w.deleteGreetingCard({id:je.value}),ke.value=ke.value.filter(e=>e.id!==je.value),h.success(Me("greetingCard.deleteSuccess")),Le.value=!1,je.value=null}catch(e){h.error(e.message||Me("greetingCard.deleteError"))}},Ae=e=>{const a=e.raw;if(!a)return;if(!a.type.startsWith("image/"))return void h.error("è¯·ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶");const t=new FileReader;t.onload=async e=>{const a=await l.uploadFile(e.target.result);Pe.imageUrl=a,Ge.value&&Ge.value.validateField("imageUrl")},t.readAsDataURL(a)},We=async()=>{Ge.value&&await Ge.value.validate(async e=>{if(e){Te.value=!0;try{Fe.value?(await w.updateGreetingCard({id:Pe.id,content:Pe.message,image:Pe.imageUrl,cardMessage:Pe.cardMessage}),h.success(Me("greetingCard.updateSuccess"))):(await w.createGreetingCard({content:Pe.message,image:Pe.imageUrl,cardMessage:Pe.cardMessage}),h.success(Me("greetingCard.createSuccess"))),await xe(),Te.value=!1,Ve.value=!1}catch(a){Te.value=!1,h.error(a.message||Me("greetingCard.saveError"))}}})};return(e,t)=>{const l=s,h=i,w=g,b=m,$=u,_=f,M=v,U=o,z=y,Me=k("DtCardPreview");return V(),x("div",S,[F("div",E,[F("div",Y,[F("h1",A,L(e.$t("greetingCard.pageTitle")),1),F("div",W,L(e.$t("greetingCard.a1SeriesTip")),1),F("div",H,[F("div",Q,[F("div",J,[F("h3",N,L(e.$t("greetingCard.tipTitle")),1),F("p",O,L(e.$t("greetingCard.tipSubtitle")),1)])]),F("div",K,[F("div",X,[t[7]||(t[7]=F("div",{class:"feature-icon"},"ðŸŽ",-1)),F("div",Z,[F("h4",null,L(e.$t("greetingCard.tipFeatures.feature1.title")),1),F("p",null,L(e.$t("greetingCard.tipFeatures.feature1.description")),1)])]),F("div",ee,[t[8]||(t[8]=F("div",{class:"feature-icon"},"ðŸ“±",-1)),F("div",ae,[F("h4",null,L(e.$t("greetingCard.tipFeatures.feature2.title")),1),F("p",null,L(e.$t("greetingCard.tipFeatures.feature2.description")),1)])]),F("div",te,[t[9]||(t[9]=F("div",{class:"feature-icon"},"ðŸ’",-1)),F("div",le,[F("h4",null,L(e.$t("greetingCard.tipFeatures.feature3.title")),1),F("p",null,L(e.$t("greetingCard.tipFeatures.feature3.description")),1)])])])])])]),F("div",se,[F("div",re,[B(h,{type:"primary",size:"large",class:"add-btn",onClick:Ee},{default:D(()=>[B(l,null,{default:D(()=>[B(P(r))]),_:1}),G("Â  "+L(e.$t("greetingCard.createButton")),1)]),_:1})]),ke.value.length>0?(V(),x("div",ie,[(V(!0),x(R,null,q(ke.value,a=>{return V(),x("div",{key:a.id,class:"greeting-card-item"},[F("div",de,[F("img",{src:a.imageUrl,alt:"Greeting Card Image",class:"card-image"},null,8,ne),F("div",ce,[F("span",ge,L((t=a.createTime,I(t).format("YYYY-MM-DD HH:mm"))),1)])]),F("div",oe,[F("p",ue,L(a.message),1),F("div",me,[B(h,{type:"primary",class:"edit-btn",onClick:e=>(e=>{Fe.value=!0,Pe.id=e.id,Pe.imageUrl=e.imageUrl,Pe.message=e.message,Pe.cardMessage=e.cardMessage||"",Ve.value=!0})(a)},{default:D(()=>[B(l,null,{default:D(()=>[B(P(d))]),_:1}),G(" "+L(e.$t("greetingCard.editButton")),1)]),_:1},8,["onClick"]),B(h,{type:"primary",class:"preview-btn",onClick:e=>(e=>{De.imageUrl=e.imageUrl,De.message=e.message,De.id=e.id,De.cardMessage=e.cardMessage,Be.value=!0})(a)},{default:D(()=>[B(l,null,{default:D(()=>[B(P(n))]),_:1}),G(" "+L(e.$t("greetingCard.previewButton")),1)]),_:1},8,["onClick"]),B(h,{type:"danger",link:"",class:"action-btn",onClick:e=>(e=>{je.value=e.id,Le.value=!0})(a)},{default:D(()=>[B(l,null,{default:D(()=>[B(P(c))]),_:1}),G(" "+L(e.$t("greetingCard.deleteButton")),1)]),_:1},8,["onClick"])])])]);var t}),128))])):(V(),j(w,{key:1,description:e.$t("greetingCard.emptyTitle")+" "+e.$t("greetingCard.emptyDescription"),"image-size":200},null,8,["description"]))]),P(a).isPortraitDevice()?(V(),x("div",pe)):T("",!0),B(z,{modelValue:Ve.value,"onUpdate:modelValue":t[3]||(t[3]=e=>Ve.value=e),title:Fe.value?e.$t("greetingCard.dialogEditTitle"):e.$t("greetingCard.dialogCreateTitle"),width:qe.value,"custom-class":"custom-dialog","destroy-on-close":"","close-on-click-modal":!1,"close-on-press-escape":!0,"append-to-body":""},{footer:D(()=>[F("span",we,[B(h,{onClick:t[2]||(t[2]=e=>Ve.value=!1)},{default:D(()=>[G(L(e.$t("greetingCard.cancelButton")),1)]),_:1}),B(h,{type:"primary",class:"save-btn",onClick:We,loading:Te.value},{default:D(()=>[G(L(e.$t("greetingCard.saveButton")),1)]),_:1},8,["loading"])])]),default:D(()=>[B(U,{model:Pe,"label-position":"top",rules:Re.value,ref_key:"formRef",ref:Ge},{default:D(()=>[B($,{label:e.$t("greetingCard.imageUploadLabel"),prop:"imageUrl"},{default:D(()=>[B(b,{class:"image-uploader",action:"#","auto-upload":!1,"show-file-list":!1,"on-change":Ae,accept:"image/*",drag:""},{default:D(()=>[Pe.imageUrl?(V(),x("img",{key:0,src:Pe.imageUrl.replace("draft-user.s3.us-east-2.amazonaws.com","dcts99982ui0s.cloudfront.net"),class:"uploaded-image"},null,8,ve)):(V(),x("div",fe,[B(l,{class:"upload-icon"},{default:D(()=>[B(P(p))]),_:1}),F("div",Ce,L(e.$t("greetingCard.imageUploadPlaceholder")),1)]))]),_:1})]),_:1},8,["label"]),B($,{label:e.$t("greetingCard.cardMessageLabel"),prop:"cardMessage"},{label:D(()=>[F("span",ye,[G(L(e.$t("greetingCard.cardMessageLabel"))+" ",1),B(_,{content:e.$t("greetingCard.cardMessageTooltip"),placement:"top"},{default:D(()=>[B(l,{class:"label-tooltip-icon"},{default:D(()=>[B(P(C))]),_:1})]),_:1},8,["content"])])]),default:D(()=>[B(M,{modelValue:Pe.cardMessage,"onUpdate:modelValue":t[0]||(t[0]=e=>Pe.cardMessage=e),type:"textarea",rows:4,placeholder:e.$t("greetingCard.cardMessagePlaceholder"),maxlength:Se.value,"show-word-limit":""},null,8,["modelValue","placeholder","maxlength"])]),_:1},8,["label"]),B($,{label:e.$t("greetingCard.messageLabel"),prop:"message"},{label:D(()=>[F("span",he,[G(L(e.$t("greetingCard.messageLabel"))+" ",1),B(_,{content:e.$t("greetingCard.messageTooltip"),placement:"top"},{default:D(()=>[B(l,{class:"label-tooltip-icon"},{default:D(()=>[B(P(C))]),_:1})]),_:1},8,["content"])])]),default:D(()=>[B(M,{modelValue:Pe.message,"onUpdate:modelValue":t[1]||(t[1]=e=>Pe.message=e),type:"textarea",rows:4,placeholder:e.$t("greetingCard.messagePlaceholder"),maxlength:Ie.value,"show-word-limit":""},null,8,["modelValue","placeholder","maxlength"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","width"]),B(z,{modelValue:Le.value,"onUpdate:modelValue":t[5]||(t[5]=e=>Le.value=e),width:ze.value,"custom-class":"delete-confirm-dialog","destroy-on-close":"","close-on-click-modal":!1,"close-on-press-escape":!0,"append-to-body":"",center:""},{footer:D(()=>[F("span",_e,[B(h,{onClick:t[4]||(t[4]=e=>Le.value=!1),class:"cancel-delete-btn"},{default:D(()=>[G(L(e.$t("greetingCard.cancelButton")),1)]),_:1}),B(h,{type:"danger",class:"confirm-delete-btn",onClick:Ye},{default:D(()=>[G(L(e.$t("greetingCard.deleteButton")),1)]),_:1})])]),default:D(()=>[F("div",be,[F("p",$e,L(e.$t("greetingCard.deleteConfirm")),1)])]),_:1},8,["modelValue","width"]),B(Me,{"card-message":De.cardMessage,id:De.id,modelValue:Be.value,"onUpdate:modelValue":t[6]||(t[6]=e=>Be.value=e),"image-url":De.imageUrl,message:De.message},null,8,["card-message","id","modelValue","image-url","message"])])}}},[["__scopeId","data-v-c1676c17"]]);export{Me as default};
