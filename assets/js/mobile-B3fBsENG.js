import{_ as e}from"./index-B4iIxVom.js";import{az as a,aA as t,r as s,j as l,z as o,A as c,B as n,R as i,L as r,J as d,Q as u,a5 as p,u as v,P as m,W as j}from"./vendor-ClluBQmh.js";import{p as h,ap as f,aA as k,W as y}from"./elementPlus-5sGCOaHt.js";import{S as g}from"./SeriesSelector-Qa-lLOfH.js";import{P as b}from"./index-BSJf0RiR.js";import{d as w}from"./date-CgH6eVIF.js";import"./utils-D5ZNaMwG.js";const C={class:"creation-workspace-mobile"},$={class:"projects-container"},_={class:"projects-grid"},D=["onClick","onTouchstart"],P={class:"project-thumbnail"},W=["src"],x={key:1,class:"project-thumbnail-default"},T={class:"project-icon"},Y={class:"project-file-name"},M={class:"project-info"},z={class:"project-title"},A={class:"project-tags"},H={class:"project-date"},I=["onClick"],S={class:"new-project-icon"},B={class:"new-project-text"},E={key:0,class:"loading-more"},L={key:1,class:"empty-projects"},R={class:"empty-icon"},X={class:"empty-title"},J={class:"empty-description"},N={class:"modal-header"},O={class:"modal-title"},Q={class:"modal-body"},q={class:"delete-confirm-content"},F={class:"delete-confirm-icon"},G={class:"delete-confirm-text"},K={class:"delete-confirm-project-name"},U={class:"delete-confirm-actions"},V=e({__name:"mobile",setup(e){const{formatDate:V}=w,Z=new b,{t:ee}=a(),ae=t(),te=s(null),se=s([]),le=s(1),oe=s(10),ce=s(0),ne=s(!1),ie=s(!1),re=s(!1),de=s(null),ue=s(!1);let pe=0,ve=0,me=0,je=null,he=!1;const fe=()=>{ke()},ke=async()=>{if(!ie.value){ne.value=!0;try{const e={page:le.value,page_size:oe.value},a=await Z.getProjectList(e);1===le.value?se.value=a.items:se.value=[...se.value,...a.items],ce.value=a.total,ie.value=se.value.length>=ce.value,le.value++}catch(e){console.error("获取项目列表异常:",e)}finally{ne.value=!1}}},ye=e=>{const a=e.target.files[0];a&&(a.type.startsWith("image/")?a.size>2097152?console.error("图片文件大小不能超过2MB"):e.target.value="":console.error("请选择图片文件"))},ge=e=>{const a=e.touches[0],t=Math.abs(a.clientX-pe),s=Math.abs(a.clientY-ve);(t>10||s>10)&&(he=!1)},be=e=>{Date.now()-me>500&&!he&&(he=!0,je&&we(je))},we=e=>{de.value=e,re.value=!0},Ce=()=>{de.value&&((async e=>{const a=se.value.findIndex(a=>a.id===e.id);-1!==a&&(se.value.splice(a,1),await Z.deleteProject(e.id))})(de.value),de.value=null,re.value=!1)},$e=()=>{de.value=null,re.value=!1},_e=e=>{ue.value=!1;let a=e.product_info.mark;ae.push(`/project/new/${a}`)},De=()=>{ue.value=!1};return l(()=>{ke()}),(e,a)=>{const t=y;return c(),o("div",C,[n("input",{ref_key:"fileInput",ref:te,type:"file",accept:"image/*",style:{display:"none"},onChange:ye},null,544),i(t,{height:"100%",onEndReached:fe},{default:d(()=>[n("div",$,[n("div",_,[(c(!0),o(u,null,p(se.value,e=>(c(),o("div",{key:e.id,class:"project-card",onClick:a=>(e=>{if(he)return void(he=!1);let a=e.tags[0];switch(a){case"Oone":a="E1";break;case"Done":a="D1"}ae.push(`/project/${e.id}/${a}`)})(e),onTouchstart:a=>((e,a)=>{pe=e.touches[0].clientX,ve=e.touches[0].clientY,me=Date.now(),je=a,he=!1})(a,e),onTouchmove:ge,onTouchend:be},[n("div",P,[e.thumbnail?(c(),o("img",{key:0,src:e.thumbnail,alt:"",class:"project-thumbnail-image"},null,8,W)):(c(),o("div",x,[n("div",T,[i(v(h))]),n("span",Y,m(e.title),1)]))]),n("div",M,[n("h3",z,m(e.title),1),n("div",A,[(c(!0),o(u,null,p(e.tags,e=>(c(),o("span",{key:e,class:"project-tag"},m(e),1))),128))]),n("p",H,m(v(V)(e.updated_at,"YYYY-MM-DD HH:mm:ss")),1)]),n("div",{class:"delete-btn",onClick:j(a=>we(e),["stop"])},[i(v(f))],8,I)],40,D))),128)),n("div",{class:"new-project-card",onClick:a[0]||(a[0]=e=>ue.value=!0)},[n("div",S,[i(v(k))]),n("span",B,m(e.$t("creationWorkspace.createNewProject")),1)])])]),ne.value?(c(),o("div",E,m(e.$t("loading")),1)):r("",!0),0!==se.value.length||ne.value?r("",!0):(c(),o("div",L,[n("div",R,[i(v(h))]),n("h3",X,m(e.$t("emptyProjects.title")),1),n("p",J,m(e.$t("emptyProjects.description")),1)])),a[2]||(a[2]=n("div",{style:{height:"80px"}},null,-1))]),_:1}),re.value?(c(),o("div",{key:0,class:"modal-overlay",onClick:$e},[n("div",{class:"modal-content",onClick:a[1]||(a[1]=j(()=>{},["stop"]))},[n("div",N,[n("h2",O,m(e.$t("creationWorkspace.deleteProject")),1)]),n("div",Q,[n("div",q,[n("div",F,[i(v(f),{class:"delete-main-icon"})]),n("p",G,m(e.$t("creationWorkspace.dropToDeleteHint")),1),n("p",K,m(de.value?.title),1),n("div",U,[n("button",{class:"modal-action-btn cancel",onClick:$e},m(e.$t("creationWorkspace.cancel")),1),n("button",{class:"modal-action-btn delete",onClick:Ce},m(e.$t("creationWorkspace.confirmDelete")),1)])])])])])):r("",!0),i(g,{show:ue.value,onConfirm:_e,onCancel:De},null,8,["show"])])}}},[["__scopeId","data-v-52fd1a94"]]);export{V as default};
