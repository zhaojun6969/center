import{_ as e,n as a,o as l,i as o,W as s,p as n,u as t,L as u,T as r,a as i}from"./index-B4iIxVom.js";import{az as d,r as v,c as p,w as c,z as g,A as h,B as _,L as w,E as b,P as m,u as y,K as k,ai as f,R as x,J as C,aF as L,I as P,ad as R,O as B,W as F,aA as S,l as j,j as I}from"./vendor-ClluBQmh.js";import{w as $,E as z,x as M,y as U,aL as V}from"./elementPlus-5sGCOaHt.js";import"./utils-D5ZNaMwG.js";const q={class:"login-mode-toggle"},W={class:"form-group"},A={class:"form-label",for:"phone"},E=["placeholder","disabled"],J={key:0,class:"input-error-icon"},K={key:0,class:"error-message"},N={key:0,class:"login-method-toggle"},O={key:1,class:"form-group"},T={class:"form-label",for:"code"},D=["placeholder","disabled"],G=["disabled"],H={key:0},Q={key:1},X={key:0,class:"input-error-icon"},Y={key:0,class:"error-message"},Z={key:2,class:"form-group"},ee={class:"form-label",for:"password"},ae=["type","placeholder","disabled","autocomplete"],le=["disabled"],oe={key:0,class:"input-error-icon"},se={key:0,class:"error-message"},ne={key:3,class:"agreement-checkbox"},te={class:"checkbox-label"},ue={class:"checkbox-text"},re=["disabled"],ie={class:"button-text"},de=["disabled"],ve={class:"button-text"},pe={key:0},ce={key:1},ge={key:0,class:"loading-spinner"},he=e({__name:"PhoneLoginForm",props:{loading:{type:Boolean,default:!1}},emits:["login","codeLogin","register","resetPassword","resetSuccess","sendCode","wechatLogin"],setup(e,{expose:t,emit:u}){const{t:r}=d(),i=S(),j=u,I=v("password"),V=v("code"),he=v({phone:"",code:"",password:""}),_e=v(!1),we=v(!1),be=v(!1),me=v(!1),ye=v(""),ke=v(""),fe=v(""),xe=v(0),Ce=v(!0),Le=v(!1),Pe={phone:{required:n},code:{required:p(()=>"password"!==I.value),minLength:p(()=>"password"!==I.value&&a(4))},password:{required:p(()=>"register"===I.value||"password"===I.value||"reset"===I.value),minLength:a(6)}},Re=l(Pe,he),Be=p(()=>/^1[3-9]\d{9}$/.test(he.value.phone)),Fe=p(()=>"password"===I.value&&"code"===V.value?!!he.value.phone&&!!he.value.code&&!ye.value&&!ke.value&&Le.value:"password"===I.value&&"password"===V.value?!!he.value.phone&&!!he.value.password&&!ye.value&&!fe.value&&Le.value:!!(he.value.phone&&he.value.code&&he.value.password)&&(!ye.value&&!ke.value&&!fe.value&&Le.value)),Se=()=>{he.value.phone?/^1[3-9]\d{9}$/.test(he.value.phone)?ye.value="":ye.value=r("login.phone_invalid_error"):ye.value=r("login.phone_empty_error")},je=()=>{"password"===I.value||he.value.code?"password"!==I.value&&he.value.code.length<4?ke.value=r("login.code_invalid_error"):ke.value="":ke.value=r("login.code_empty_error")},Ie=()=>{if("register"===I.value||"password"===I.value||"reset"===I.value){if("password"===I.value&&"code"===V.value)return void(fe.value="");he.value.password?he.value.password.length<6?fe.value=r("login.password_min_error"):fe.value="":fe.value=r("login.password_empty_error")}else fe.value=""};c(()=>he.value.phone,Se),c(()=>he.value.code,je),c(()=>he.value.password,Ie),c(()=>I.value,Ie),c(()=>V.value,Ie);const $e=async()=>{if(Be.value&&!(xe.value>0))try{Ce.value=!1,xe.value=60,j("sendCode",{phone:he.value.phone,purpose:"reset"===I.value?"reset-password":"password"===I.value?"login":"register"});const e=setInterval(()=>{xe.value--,xe.value<=0&&(clearInterval(e),Ce.value=!0)},1e3)}catch(e){console.error("发送验证码失败:",e),Ce.value=!0,xe.value=0}},ze=async()=>{if("password"===I.value){if(Se(),Ie(),ye.value||fe.value)return}else if(await Re.value.$validate(),Re.value.$invalid)return Se(),je(),void Ie();"password"===I.value?"code"===V.value?j("codeLogin",he.value):j("login",he.value):"register"===I.value?j("register",he.value):"reset"===I.value&&j("resetPassword",he.value,()=>{I.value="password",he.value={phone:"",code:"",password:""},ye.value="",ke.value="",fe.value=""})},Me=()=>{s.BusWechartForNavigate("/pages/login/index",{},"2")},Ue=e=>{i.push(`/agreement/${e}`)};return t({toggleLoginMode:(e,a="password")=>{I.value=e,V.value=a,ye.value="",ke.value="",fe.value="",Le.value=!1}}),(a,l)=>{const s=z;return h(),g("form",{class:"phone-login-form",onSubmit:F(ze,["prevent"])},[_("div",q,[_("button",{type:"button",class:b(["mode-button",{active:"password"===I.value}]),onClick:l[0]||(l[0]=e=>I.value="password")},m(y(r)("login.phone_password_login_mode")),3),_("button",{type:"button",class:b(["mode-button",{active:"register"===I.value}]),onClick:l[1]||(l[1]=e=>I.value="register")},m(y(r)("login.phone_register_mode")),3),_("button",{type:"button",class:b(["mode-button",{active:"reset"===I.value}]),onClick:l[2]||(l[2]=e=>I.value="reset")},m(y(r)("login.phone_reset_password_mode")),3)]),_("div",W,[_("label",A,m(y(r)("login.phone_label")),1),_("div",{class:b(["input-wrapper",{focused:_e.value}])},[k(_("input",{id:"phone","onUpdate:modelValue":l[3]||(l[3]=e=>he.value.phone=e),type:"tel",class:b(["form-input",{error:ye.value}]),placeholder:y(r)("login.phone_placeholder"),onFocus:l[4]||(l[4]=e=>_e.value=!0),onBlur:l[5]||(l[5]=e=>_e.value=!1),disabled:e.loading,autocomplete:"tel"},null,42,E),[[f,he.value.phone]]),ye.value?(h(),g("div",J,[x(s,null,{default:C(()=>[x(y($))]),_:1})])):w("",!0)],2),ye.value?(h(),g("div",K,m(ye.value),1)):w("",!0)]),"password"===I.value?(h(),g("div",N,[_("button",{type:"button",class:b(["method-button",{active:"code"===V.value}]),onClick:l[6]||(l[6]=e=>V.value="code")},m(y(r)("login.phone_code_login_method")),3),_("button",{type:"button",class:b(["method-button",{active:"password"===V.value}]),onClick:l[7]||(l[7]=e=>V.value="password")},m(y(r)("login.phone_password_login_method")),3)])):w("",!0),"password"===I.value&&"code"===V.value||"register"===I.value||"reset"===I.value?(h(),g("div",O,[_("label",T,m(y(r)("login.code_label")),1),_("div",{class:b(["input-wrapper verification-code-wrapper",{focused:we.value}])},[k(_("input",{id:"code","onUpdate:modelValue":l[8]||(l[8]=e=>he.value.code=e),type:"text",class:b(["form-input verification-code-input",{error:ke.value}]),placeholder:y(r)("login.code_placeholder"),onFocus:l[9]||(l[9]=e=>we.value=!0),onBlur:l[10]||(l[10]=e=>we.value=!1),disabled:e.loading,autocomplete:"one-time-code"},null,42,D),[[f,he.value.code]]),_("button",{type:"button",class:"send-code-button",disabled:e.loading||!Ce.value||!Be.value,onClick:$e},[xe.value?(h(),g("span",Q,m(y(r)("login.resend_code_after",{seconds:xe.value})),1)):(h(),g("span",H,m(y(r)("login.send_code")),1))],8,G),ke.value?(h(),g("div",X,[x(s,null,{default:C(()=>[x(y($))]),_:1})])):w("",!0)],2),ke.value?(h(),g("div",Y,m(ke.value),1)):w("",!0)])):w("",!0),"register"!==I.value&&"password"!==I.value&&"reset"!==I.value||"password"===I.value&&"code"===V.value?w("",!0):(h(),g("div",Z,[_("label",ee,m("reset"===I.value?y(r)("login.new_password_label"):y(r)("login.password_label")),1),_("div",{class:b(["input-wrapper",{focused:be.value}])},[k(_("input",{id:"password","onUpdate:modelValue":l[11]||(l[11]=e=>he.value.password=e),type:me.value?"text":"password",class:b(["form-input",{error:fe.value}]),placeholder:"reset"===I.value?y(r)("login.new_password_placeholder"):y(r)("login.password_placeholder"),onFocus:l[12]||(l[12]=e=>be.value=!0),onBlur:l[13]||(l[13]=e=>be.value=!1),disabled:e.loading,autocomplete:"password"===I.value?"current-password":"new-password"},null,42,ae),[[L,he.value.password]]),_("button",{type:"button",class:"password-toggle",onClick:l[14]||(l[14]=e=>me.value=!me.value),disabled:e.loading},[me.value?(h(),P(s,{key:0},{default:C(()=>[x(y(M))]),_:1})):(h(),P(s,{key:1},{default:C(()=>[x(y(U))]),_:1}))],8,le),fe.value?(h(),g("div",oe,[x(s,null,{default:C(()=>[x(y($))]),_:1})])):w("",!0)],2),fe.value?(h(),g("div",se,m(fe.value),1)):w("",!0)])),"reset"!==I.value?(h(),g("div",ne,[_("label",te,[k(_("input",{type:"checkbox","onUpdate:modelValue":l[15]||(l[15]=e=>Le.value=e),class:"checkbox-input"},null,512),[[R,Le.value]]),_("span",ue,[B(m(y(r)("login.agreement_prefix"))+" ",1),_("a",{class:"agreement-link",onClick:l[16]||(l[16]=e=>Ue("user_agreement"))},m(y(r)("login.user_agreement")),1),B(" "+m(y(r)("login.agreement_and"))+" ",1),_("a",{class:"agreement-link",onClick:l[17]||(l[17]=e=>Ue("privacy_policy"))},m(y(r)("login.privacy_policy")),1)])])])):w("",!0),y(o)()?(h(),g("button",{key:4,type:"button",class:"wechat-login-button",disabled:e.loading,onClick:Me},[l[18]||(l[18]=_("svg",{class:"wechat-icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[_("path",{fill:"#07C160",d:"M666.24 495.36c-8.96 0-17.92 0.96-26.88 2.88 27.52-47.36 43.52-102.4 43.52-161.28 0-170.24-158.72-308.48-354.56-308.48-195.84 0-354.56 138.24-354.56 308.48 0 88.32 43.52 168.96 115.2 225.28-6.4 19.84-16.96 52.48-19.84 60.8-4.48 13.44 6.4 26.88 20.48 21.76 9.6-3.84 52.48-20.48 77.44-30.08 52.48 23.04 112 36.48 175.36 36.48 8.96 0 17.92-0.96 26.88-1.92-4.48-20.48-6.4-41.6-6.4-63.36 0-154.24 140.8-279.68 313.6-279.68 8.96 0 17.92 0 26.88 0.96 0-3.84 0-7.68 0-11.52z"}),_("path",{fill:"#07C160",d:"M958.72 643.84c0-134.4-128-243.2-285.44-243.2-157.44 0-285.44 108.8-285.44 243.2 0 134.4 128 243.2 285.44 243.2 32 0 63.36-4.48 92.8-12.16 20.48 8.32 57.6 22.4 65.28 25.28 11.52 4.48 20.48-6.4 16.96-17.92-2.88-6.4-11.52-33.28-16.96-49.92 51.2-44.8 82.56-105.6 82.56-172.8z"})],-1)),_("span",ie,m(y(r)("login.wechat_login_button")),1)],8,re)):w("",!0),_("button",{type:"submit",class:"login-submit-button",disabled:e.loading||!Fe.value},[_("span",ve,[e.loading?(h(),g("span",ce,m("code"===I.value||"password"===I.value?y(r)("login.phone_logging"):"register"===I.value?y(r)("login.phone_registering"):y(r)("login.phone_resetting")),1)):(h(),g("span",pe,m("code"===I.value&&"code"===V.value?y(r)("login.phone_code_login_button"):"code"===I.value&&"password"===V.value||"password"===I.value?y(r)("login.phone_password_login_button"):"register"===I.value?y(r)("login.phone_register_button"):y(r)("login.phone_reset_password_button")),1))]),e.loading?(h(),g("div",ge)):w("",!0)],8,de)],32)}}},[["__scopeId","data-v-4d853aac"]]),_e={class:"login-page"},we={class:"top-right-controls"},be={class:"controls-container"},me={class:"login-container"},ye={class:"login-card"},ke={class:"login-title"},fe={class:"login-subtitle"},xe={class:"phone-login-section"},Ce={key:0,class:"error-message"},Le={key:1,class:"auth-links"},Pe={class:"auth-links-row"},Re=e({__name:"PhoneLogin",setup(e){const a=S(),l=t(),{t:s}=d(),n=j(new u),p=v(null),c=async e=>{n.phoneLogin(e)},b=async e=>{n.phoneLoginCode(e)},k=async e=>{n.phoneRegister(e)},f=async e=>{n.phoneResetPassword(e,()=>{p.value.toggleLoginMode("password","password")})},L=async e=>{n.sendPhoneCode(e)},P=()=>{a.push("/login")};return I(()=>{}),(e,a)=>{const n=z;return h(),g("div",_e,[a[0]||(a[0]=_("div",{class:"login-background"},null,-1)),_("div",we,[_("div",be,[x(r,{position:"top-right","tooltip-text":y(s)("login.theme_toggle_tooltip")},null,8,["tooltip-text"]),x(i,{position:"top-right","tooltip-text":y(s)("login.language_toggle_tooltip")},null,8,["tooltip-text"])])]),_("div",me,[_("div",ye,[_("div",ke,[_("h2",null,m(y(s)("login.phone_login_title")),1),_("p",fe,m(y(s)("login.phone_login_subtitle")),1)]),_("div",xe,[x(he,{ref_key:"PhoneLoginFormRef",ref:p,onLogin:c,onCodeLogin:b,onRegister:k,onResetPassword:f,onResetSuccess:e.handleResetSuccess,onSendCode:L},null,8,["onResetSuccess"])]),y(l).error?(h(),g("div",Ce,[x(n,{class:"error-icon"},{default:C(()=>[x(y($))]),_:1}),_("span",null,m(y(l).error),1)])):w("",!0),y(o)()?w("",!0):(h(),g("div",Le,[_("div",Pe,[_("button",{type:"button",class:"auth-link email-login-link",onClick:P},[x(n,{class:"link-icon"},{default:C(()=>[x(y(V))]),_:1}),_("span",null,m(y(s)("login.email_login_link")),1)])])]))])])])}}},[["__scopeId","data-v-3818dfa4"]]);export{Re as default};
