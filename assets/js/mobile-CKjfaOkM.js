import{az as e,r as a,c as l,w as s,j as o,aB as t,z as u,B as n,P as i,u as r,L as c,K as d,E as p,S as v,Q as m,a5 as h,aM as C,ai as N,ad as g,aA as y,A as k}from"./vendor-ClluBQmh.js";import{C as b,S as w}from"./state-BZyqW-14.js";import{_ as f,t as x,q as S,r as $,d as H,i as j,W as A,e as J}from"./index-B4iIxVom.js";import{S as U}from"./index-7vXv9XNO.js";import{P as _}from"./payserver-N-sfDqkd.js";import"./elementPlus-5sGCOaHt.js";import"./utils-D5ZNaMwG.js";const M={class:"mobile-buy-container"},q={class:"mobile-header"},B={class:"page-title"},D={class:"content-scroll"},I={class:"product-card"},G={class:"product-image"},L=["src","alt"],X={class:"product-info"},O={class:"product-name"},V={class:"product-desc"},P={class:"product-price-row"},F={class:"product-price"},Z={class:"quantity-selector"},T={class:"qty-value"},Q={key:0,class:"coupon-section"},R={class:"section-title"},W={class:"coupon-list"},z=["onClick"],K={class:"coupon-left"},Y={class:"coupon-amount"},E={class:"coupon-condition"},ee={class:"coupon-right"},ae={class:"coupon-name"},le={class:"coupon-expiry"},se={key:0,class:"coupon-check"},oe={class:"shipping-section"},te={class:"section-title"},ue={class:"shipping-form"},ne={class:"form-group"},ie={class:"select-wrapper"},re=["value"],ce={class:"form-row"},de={class:"form-group"},pe=["placeholder"],ve={class:"form-group"},me=["placeholder"],he={class:"form-row"},Ce={class:"form-group"},Ne=["placeholder"],ge={class:"form-group"},ye={class:"select-wrapper"},ke=["value"],be={class:"form-group"},we=["placeholder"],fe={class:"form-group"},xe=["placeholder"],Se={class:"form-group"},$e=["placeholder"],He={class:"form-group"},je=["placeholder"],Ae={class:"form-group checkbox-group"},Je={class:"checkbox-label"},Ue={class:"bottom-bar"},_e={class:"order-summary"},Me={class:"summary-item"},qe={class:"summary-label"},Be={class:"summary-value"},De={key:0,class:"summary-item"},Ie={class:"summary-label"},Ge={class:"summary-value discount"},Le={class:"summary-item total"},Xe={class:"summary-label"},Oe={class:"summary-value"},Ve=["disabled"],Pe=f({__name:"mobile",setup(f){const Pe=new _,Fe=y(),Ze=t(),{t:Te,locale:Qe}=e(),Re=new U,We=a(1),ze=a(null),Ke=a(!1),Ye=a("US"),Ee=a({country:Ye.value,firstName:"",lastName:"",postalCode:"",state:"",city:"",address1:"",address2:"",phone:"",saveInfo:!1}),ea=a([]),aa=a([]),la=a({id:null,name:"",description:"",image:"",price:0}),sa=a([]),oa=a(0),ta=a({}),ua=(e,a)=>{try{return new Intl.DisplayNames([Qe.value],{type:"region"}).of(e)||a}catch(l){return a}},na=()=>{const e=(b.getAllCountries()||[]).map(e=>({label:ua(e.isoCode,e.name),value:e.isoCode})),a=e.find(e=>"CN"===e.value);ea.value=a?[a,...e.filter(e=>"CN"!==e.value)]:e},ia=()=>{const e=w.getStatesOfCountry(Ee.value.country)||[];aa.value=e.map(e=>{let a=e.name;if("CN"===Ee.value.country){const l=e.isoCode?.startsWith("CN-")?e.isoCode:`CN-${e.isoCode}`;a=("zh"===Qe.value?{"CN-BJ":"北京市","CN-SH":"上海市","CN-TJ":"天津市","CN-CQ":"重庆市","CN-HE":"河北省","CN-SX":"山西省","CN-NM":"内蒙古自治区","CN-LN":"辽宁省","CN-JL":"吉林省","CN-HL":"黑龙江省","CN-JS":"江苏省","CN-ZJ":"浙江省","CN-AH":"安徽省","CN-FJ":"福建省","CN-JX":"江西省","CN-SD":"山东省","CN-HA":"河南省","CN-HB":"湖北省","CN-HN":"湖南省","CN-GD":"广东省","CN-GX":"广西壮族自治区","CN-HI":"海南省","CN-SC":"四川省","CN-GZ":"贵州省","CN-YN":"云南省","CN-XZ":"西藏自治区","CN-SN":"陕西省","CN-GS":"甘肃省","CN-QH":"青海省","CN-NX":"宁夏回族自治区","CN-XJ":"新疆维吾尔自治区","CN-TW":"台湾省","CN-HK":"香港特别行政区","CN-MO":"澳门特别行政区"}:{"CN-BJ":"Beijing","CN-SH":"Shanghai","CN-TJ":"Tianjin","CN-CQ":"Chongqing","CN-HE":"Hebei","CN-SX":"Shanxi","CN-NM":"Inner Mongolia","CN-LN":"Liaoning","CN-JL":"Jilin","CN-HL":"Heilongjiang","CN-JS":"Jiangsu","CN-ZJ":"Zhejiang","CN-AH":"Anhui","CN-FJ":"Fujian","CN-JX":"Jiangxi","CN-SD":"Shandong","CN-HA":"Henan","CN-HB":"Hubei","CN-HN":"Hunan","CN-GD":"Guangdong","CN-GX":"Guangxi Zhuang Autonomous Region","CN-HI":"Hainan","CN-SC":"Sichuan","CN-GZ":"Guizhou","CN-YN":"Yunnan","CN-XZ":"Tibet Autonomous Region","CN-SN":"Shaanxi","CN-GS":"Gansu","CN-QH":"Qinghai","CN-NX":"Ningxia Hui Autonomous Region","CN-XJ":"Xinjiang Uygur Autonomous Region","CN-TW":"Taiwan","CN-HK":"Hong Kong SAR","CN-MO":"Macau SAR"})[l]||e.name}return{label:a,value:e.isoCode}})},ra=l(()=>`${x()?"¥":"$"}${(la.value.price*We.value).toLocaleString()}`),ca=l(()=>`${x()?"¥":"$"}${oa.value}`),da=l(()=>{const e=la.value.price*We.value,a=Math.max(0,e-oa.value);return`${x()?"¥":"$"}${a.toLocaleString()}`}),pa=l(()=>!!(Ee.value.firstName?.trim()&&Ee.value.lastName?.trim()&&Ee.value.address1?.trim()&&Ee.value.city?.trim()&&Ee.value.phone?.trim())),va=()=>{We.value<99&&(We.value++,Na())},ma=()=>{We.value>1&&(We.value--,Na())},ha=a("USD"),Ca=()=>{Ke.value=!Ke.value},Na=()=>{let e={currency:ha.value,amount:la.value.price*We.value};ze.value?e.coupon_ids=[ze.value]:e.coupon_ids=[],$.common(H.calculateUnitAmount,e).then(e=>{const a=e.data;oa.value=a.discount_amount||0})},ga=()=>{Fe.push("/shop")},ya=()=>{if(!(Ee.value.firstName&&Ee.value.lastName&&Ee.value.address1&&Ee.value.city&&Ee.value.phone))return;(()=>{try{Ee.value.saveInfo&&localStorage.setItem("shop_shipping",JSON.stringify(Ee.value))}catch(e){}})();let e={goods_id:String(la.value.id),quantity:String(We.value),success_url:`${window.location.origin}/#/order-management`,cancel_url:`${window.location.origin}/#/order-management`,coupon_ids:ze.value?[ze.value]:[],order_info:{logistics:{country:Ee.value.country,countryLabel:ea.value.find(e=>e.value===Ee.value.country)?.label||Ee.value.country,firstName:Ee.value.firstName,lastName:Ee.value.lastName,postalCode:Ee.value.postalCode,state:Ee.value.state,stateLabel:aa.value.find(e=>e.value===Ee.value.state)?.label||Ee.value.state,city:Ee.value.city,address1:Ee.value.address1,address2:Ee.value.address2,phone:Ee.value.phone},goods_info:{...ta.value,quantity:String(We.value),price:(la.value.price*We.value).toFixed(2)}}};if(j())return delete e.success_url,delete e.cancel_url,void A.BusWechartForNavigate("/pages/pay/payCommon",{requestUrl:H.createPurchasePay.url,method:H.createPurchasePay.method,needPay:!0,callBackUrl:"/order-management",errorUrl:"/order-management",requestData:JSON.stringify(e),callBackMessage:"支付成功",errorMessage:"支付失败"});Pe.createPayorOrder(e,3)};return s(()=>Ee.value.country,()=>{ia()}),s(()=>Qe.value,()=>{na(),ia()}),o(()=>{const e=Ze.params.id;e&&(async e=>{try{const a=await Re.getGoodsDetail({id:e});if(a&&a.success&&a.data){const e=a.data;ta.value=e,la.value={id:e.id,name:e.goodsName,description:e.shortDesc||"",image:e.mainImage||e.images?.[0]||"",price:e.price||0}}}catch(a){console.error("Failed to fetch goods detail:",a)}})(e),(async()=>{try{const e=await $.common(H.getAvailableCoupon);e&&0===e.code&&(sa.value=(e.data||[]).map(e=>({id:e.id,name:e.sourceDesc||e.couponCode,amount:e.amount,minAmount:e.minOrderAmount,expiry:e.expireAt,applicable:!0,currency:e.currency||"USD"})))}catch(e){console.error("Failed to fetch coupon list:",e),sa.value=[]}})();try{if(S().isDomestic){Ye.value="CN";localStorage.getItem("shop_shipping")||(Ee.value.country="CN")}const e=localStorage.getItem("shop_shipping");e&&Object.assign(Ee.value,JSON.parse(e)),na(),ia()}catch(a){}}),(e,a)=>(k(),u("div",M,[n("div",q,[n("button",{class:"back-btn",onClick:ga},[...a[10]||(a[10]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2.5",stroke:"currentColor"},[n("path",{"stroke-linecap":"square","stroke-linejoin":"miter",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})],-1)])]),n("h1",B,i(r(Te)("shop.buy.title")),1)]),n("div",D,[n("div",I,[n("div",G,[n("img",{src:la.value.image,alt:la.value.name},null,8,L)]),n("div",X,[n("h2",O,i(la.value.name),1),n("p",V,i(la.value.description),1),n("div",P,[n("span",F,i(r(J).isDomesticDomain()?"¥":"$")+i(la.value.price?.toFixed(2)||"0"),1),n("div",Z,[n("button",{class:"qty-btn",onClick:ma},[...a[11]||(a[11]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2.5",stroke:"currentColor"},[n("path",{"stroke-linecap":"square","stroke-linejoin":"miter",d:"M19.5 12h-15"})],-1)])]),n("span",T,i(We.value),1),n("button",{class:"qty-btn",onClick:va},[...a[12]||(a[12]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2.5",stroke:"currentColor"},[n("path",{"stroke-linecap":"square","stroke-linejoin":"miter",d:"M12 4.5v15m7.5-7.5h-15"})],-1)])])])])])]),sa.value.length>0?(k(),u("div",Q,[n("div",{class:"section-header",onClick:Ca},[n("h3",R,i(r(Te)("shop.buy.selectCoupon")),1),(k(),u("svg",{class:p(["expand-icon",{expanded:Ke.value}]),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2.5",stroke:"currentColor"},[...a[13]||(a[13]=[n("path",{"stroke-linecap":"square","stroke-linejoin":"miter",d:"M19.5 8.25l-7.5 7.5-7.5-7.5"},null,-1)])],2))]),d(n("div",W,[(k(!0),u(m,null,h(sa.value,e=>(k(),u("div",{key:e.id,class:p(["coupon-item",{selected:ze.value===e.id}]),onClick:a=>(e=>{ha.value=e.currency,e.applicable&&(ze.value=e.id===ze.value?null:e.id,Na())})(e)},[n("div",K,[n("div",Y,i("USD"===e.currency?"$":e.currency)+i(e.amount),1),n("div",E,i(r(Te)("shop.buy.minOrder"))+": "+i("USD"===e.currency?"$":e.currency)+i(e.minAmount),1)]),n("div",ee,[n("div",ae,i(e.name),1),n("div",le,i(r(Te)("shop.buy.expireAt"))+": "+i(e.expiry),1)]),ze.value===e.id?(k(),u("div",se,[...a[14]||(a[14]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"3",stroke:"currentColor"},[n("path",{"stroke-linecap":"square","stroke-linejoin":"miter",d:"M4.5 12.75l6 6 9-13.5"})],-1)])])):c("",!0)],10,z))),128))],512),[[v,Ke.value]])])):c("",!0),n("div",oe,[n("h3",te,i(r(Te)("shop.buy.shippingAddress")),1),n("div",ue,[n("div",ne,[n("label",null,i(e.$t("checkout.country")),1),n("div",ie,[d(n("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>Ee.value.country=e),onChange:ia},[(k(!0),u(m,null,h(ea.value,e=>(k(),u("option",{key:e.value,value:e.value},i(e.label),9,re))),128))],544),[[C,Ee.value.country]]),a[15]||(a[15]=n("svg",{class:"select-arrow",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2.5",stroke:"currentColor"},[n("path",{"stroke-linecap":"square","stroke-linejoin":"miter",d:"M19.5 8.25l-7.5 7.5-7.5-7.5"})],-1))])]),n("div",ce,[n("div",de,[n("label",null,i(e.$t("checkout.lastName")),1),d(n("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=e=>Ee.value.lastName=e),placeholder:e.$t("checkout.lastName")},null,8,pe),[[N,Ee.value.lastName]])]),n("div",ve,[n("label",null,i(e.$t("checkout.firstName")),1),d(n("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=e=>Ee.value.firstName=e),placeholder:e.$t("checkout.firstName")},null,8,me),[[N,Ee.value.firstName]])])]),n("div",he,[n("div",Ce,[n("label",null,i(e.$t("checkout.postalCode")),1),d(n("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=e=>Ee.value.postalCode=e),placeholder:e.$t("checkout.postalCode")},null,8,Ne),[[N,Ee.value.postalCode]])]),n("div",ge,[n("label",null,i(e.$t("checkout.state")),1),n("div",ye,[d(n("select",{"onUpdate:modelValue":a[4]||(a[4]=e=>Ee.value.state=e)},[(k(!0),u(m,null,h(aa.value,e=>(k(),u("option",{key:e.value,value:e.value},i(e.label),9,ke))),128))],512),[[C,Ee.value.state]]),a[16]||(a[16]=n("svg",{class:"select-arrow",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2.5",stroke:"currentColor"},[n("path",{"stroke-linecap":"square","stroke-linejoin":"miter",d:"M19.5 8.25l-7.5 7.5-7.5-7.5"})],-1))])])]),n("div",be,[n("label",null,i(e.$t("checkout.city")),1),d(n("input",{type:"text","onUpdate:modelValue":a[5]||(a[5]=e=>Ee.value.city=e),placeholder:e.$t("checkout.city")},null,8,we),[[N,Ee.value.city]])]),n("div",fe,[n("label",null,i(e.$t("checkout.address1")),1),d(n("input",{type:"text","onUpdate:modelValue":a[6]||(a[6]=e=>Ee.value.address1=e),placeholder:e.$t("checkout.address1")},null,8,xe),[[N,Ee.value.address1]])]),n("div",Se,[n("label",null,i(e.$t("checkout.address2")),1),d(n("input",{type:"text","onUpdate:modelValue":a[7]||(a[7]=e=>Ee.value.address2=e),placeholder:e.$t("checkout.address2")},null,8,$e),[[N,Ee.value.address2]])]),n("div",He,[n("label",null,i(e.$t("checkout.phone")),1),d(n("input",{type:"tel","onUpdate:modelValue":a[8]||(a[8]=e=>Ee.value.phone=e),placeholder:e.$t("checkout.phone")},null,8,je),[[N,Ee.value.phone]])]),n("div",Ae,[n("label",Je,[d(n("input",{type:"checkbox","onUpdate:modelValue":a[9]||(a[9]=e=>Ee.value.saveInfo=e)},null,512),[[g,Ee.value.saveInfo]]),a[17]||(a[17]=n("span",{class:"checkbox-custom"},null,-1)),n("span",null,i(e.$t("checkout.saveInfo")),1)])])])])]),n("div",Ue,[n("div",_e,[n("div",Me,[n("span",qe,i(r(Te)("shop.buy.subtotal")),1),n("span",Be,i(ra.value),1)]),ze.value?(k(),u("div",De,[n("span",Ie,i(r(Te)("shop.buy.discount")),1),n("span",Ge,"-"+i(ca.value),1)])):c("",!0),n("div",Le,[n("span",Xe,i(r(Te)("shop.buy.total")),1),n("span",Oe,i(da.value),1)])]),n("button",{class:"submit-btn",disabled:!pa.value,onClick:ya},i(r(Te)("shop.buy.submitOrder")),9,Ve)])]))}},[["__scopeId","data-v-ed489221"]]);export{Pe as default};
