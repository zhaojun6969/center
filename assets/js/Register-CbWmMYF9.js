import{_ as e,L as a,u as l,T as s,a as r}from"./index-7JqqWDD-.js";import{az as i,r as o,j as t,z as d,A as u,B as n,L as v,P as c,u as p,E as m,K as g,ai as f,R as _,J as b,X as y,c as C,aF as w,I as k,W as h,f as x,aB as V,aA as I,O as B}from"./vendor-C2S3nqiJ.js";import{x as j,E as F,y as q,z as S,d as U,O as A}from"./elementPlus-Dhv4F-aG.js";/* empty css                   */import"./utils-uaInoSqn.js";const E={class:"invite-code-section"},R={class:"form-group"},z={class:"label-wrapper"},L={class:"form-label",for:"inviteCode"},O={class:"optional-text"},P=["placeholder","disabled"],$={key:0,class:"input-error-icon"},H={key:0,class:"error-message"},J=e({__name:"InviteCodeInput",props:{modelValue:{type:String,default:""},error:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","validate"],setup(e,{emit:a}){const l=e,s=a,{t:r}=i(),y=o(!1),C=o(l.modelValue);return t(()=>l.modelValue,e=>{C.value=e}),t(C,e=>{s("update:modelValue",e),s("validate",e)}),(a,l)=>{const s=F;return u(),d("div",E,[n("div",R,[n("div",z,[n("label",L,c(p(r)("login.invite_code_label")),1),n("span",O,c(p(r)("common.optional")),1)]),n("div",{class:m(["input-wrapper",{focused:y.value}])},[g(n("input",{id:"inviteCode","onUpdate:modelValue":l[0]||(l[0]=e=>C.value=e),type:"text",class:m(["form-input",{error:e.error}]),placeholder:p(r)("login.invite_code_placeholder"),onFocus:l[1]||(l[1]=e=>y.value=!0),onBlur:l[2]||(l[2]=e=>y.value=!1),disabled:e.disabled,autocomplete:"off"},null,42,P),[[f,C.value]]),e.error?(u(),d("div",$,[_(s,null,{default:b(()=>[_(p(j))]),_:1})])):v("",!0)],2),e.error?(u(),d("div",H,c(e.error),1)):v("",!0)])])}}},[["__scopeId","data-v-961ce9f3"]]),K={class:"form-group"},T={class:"form-label",for:"email"},W=["placeholder","disabled"],X={key:0,class:"input-error-icon"},D={key:0,class:"error-message"},G={class:"form-group"},M={class:"form-label",for:"verificationCode"},N={class:"verification-wrapper"},Q=["placeholder","disabled"],Y={key:0,class:"input-error-icon"},Z=["disabled"],ee={key:0},ae={key:1},le={key:2},se={key:0,class:"error-message"},re={class:"form-group"},ie={class:"form-label",for:"password"},oe=["type","placeholder","disabled"],te=["disabled"],de={key:0,class:"error-message"},ue={class:"form-group"},ne={key:0,class:"error-message"},ve=["disabled"],ce={class:"button-text"},pe={key:0},me={key:1},ge={key:0,class:"loading-spinner"},fe=e({__name:"RegisterForm",props:{loading:{type:Boolean,default:!1},inviteCode:{type:String,default:""}},emits:["success","error"],setup(e,{emit:l}){const{t:s}=i(),r=new a,x=l,V=e,I=o({email:"",password:"",verificationCode:"",inviteCode:""}),B=o(!1),A=o(!1),E=o(!1),R=o(!1),z=o(!1),L=o(0);let O=null;y(()=>{O&&(clearInterval(O),O=null)});const P=o(""),$=o(""),H=o(""),fe=o(""),_e=C(()=>I.value.email&&I.value.password&&I.value.verificationCode&&!P.value&&!$.value&&!H.value&&!fe.value),be=C(()=>I.value.email&&!P.value),ye=async()=>{if(be.value&&!z.value){z.value=!0;try{r.sendEmailCode({email:I.value.email,purpose:"register"},()=>{L.value=60,O=setInterval(()=>{L.value>0?L.value--:(clearInterval(O),O=null)},1e3)})}catch(e){U.error(s("register.verification_code_send_failed"))}finally{z.value=!1}}},Ce=()=>{I.value.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(I.value.email)?P.value="":P.value=s("register.email_invalid_error"):P.value=s("register.email_empty_error")},we=()=>{I.value.password?I.value.password.length<6?$.value=s("register.password_min_error"):$.value="":$.value=s("register.password_empty_error")},ke=()=>{I.value.verificationCode?/^\d{6}$/.test(I.value.verificationCode)?H.value="":H.value=s("register.verification_code_invalid_error"):H.value=s("register.verification_code_empty_error")},he=()=>{fe.value=""};t(()=>I.value.email,Ce),t(()=>I.value.password,we),t(()=>I.value.verificationCode,ke),t(()=>I.value.inviteCode,he),t(()=>V.inviteCode,e=>{e&&(I.value.inviteCode=e)},{immediate:!0});const xe=()=>{I.value.email&&I.value.password&&I.value.verificationCode&&r.confirmRegister({email:I.value.email,emailCode:I.value.verificationCode,password:I.value.password,inviteCode:I.value.inviteCode||""},()=>{x("success")})};return(a,l)=>{const r=F;return u(),d("form",{class:"register-form",onSubmit:h(xe,["prevent"])},[n("div",K,[n("label",T,c(p(s)("register.email_label")),1),n("div",{class:m(["input-wrapper",{focused:B.value}])},[g(n("input",{id:"email","onUpdate:modelValue":l[0]||(l[0]=e=>I.value.email=e),type:"email",class:m(["form-input",{error:P.value}]),placeholder:p(s)("register.email_placeholder"),onFocus:l[1]||(l[1]=e=>B.value=!0),onBlur:Ce,disabled:e.loading,autocomplete:"email"},null,42,W),[[f,I.value.email]]),P.value?(u(),d("div",X,[_(r,null,{default:b(()=>[_(p(j))]),_:1})])):v("",!0)],2),P.value?(u(),d("div",D,c(P.value),1)):v("",!0)]),n("div",G,[n("label",M,c(p(s)("register.verification_code_label")),1),n("div",N,[n("div",{class:m(["input-wrapper",{focused:E.value}])},[g(n("input",{id:"verificationCode","onUpdate:modelValue":l[2]||(l[2]=e=>I.value.verificationCode=e),type:"text",class:m(["form-input verification-input",{error:H.value}]),placeholder:p(s)("register.verification_code_placeholder"),onFocus:l[3]||(l[3]=e=>E.value=!0),onBlur:ke,disabled:e.loading,maxlength:"6",autocomplete:"off"},null,42,Q),[[f,I.value.verificationCode]]),H.value?(u(),d("div",Y,[_(r,null,{default:b(()=>[_(p(j))]),_:1})])):v("",!0)],2),n("button",{type:"button",class:m(["send-code-button",{"countdown-active":L.value>0}]),onClick:ye,disabled:z.value||L.value>0},[L.value>0?(u(),d("span",ee,c(L.value)+"s",1)):z.value?(u(),d("span",ae,c(p(s)("register.sending_code")),1)):(u(),d("span",le,c(p(s)("register.send_code")),1))],10,Z)]),H.value?(u(),d("div",se,c(H.value),1)):v("",!0)]),n("div",re,[n("label",ie,c(p(s)("register.password_label")),1),n("div",{class:m(["input-wrapper",{focused:A.value}])},[g(n("input",{id:"password","onUpdate:modelValue":l[4]||(l[4]=e=>I.value.password=e),type:R.value?"text":"password",class:m(["form-input",{error:$.value}]),placeholder:p(s)("register.password_placeholder"),onFocus:l[5]||(l[5]=e=>A.value=!0),onBlur:we,disabled:e.loading,autocomplete:"new-password"},null,42,oe),[[w,I.value.password]]),n("button",{type:"button",class:"password-toggle",onClick:l[6]||(l[6]=e=>R.value=!R.value),disabled:e.loading},[R.value?(u(),k(r,{key:0},{default:b(()=>[_(p(q))]),_:1})):(u(),k(r,{key:1},{default:b(()=>[_(p(S))]),_:1}))],8,te)],2),$.value?(u(),d("div",de,c($.value),1)):v("",!0)]),n("div",ue,[_(J,{modelValue:I.value.inviteCode,"onUpdate:modelValue":l[7]||(l[7]=e=>I.value.inviteCode=e),error:fe.value,disabled:e.loading,onValidate:he},null,8,["modelValue","error","disabled"]),fe.value?(u(),d("div",ne,c(fe.value),1)):v("",!0)]),n("button",{type:"submit",class:"register-submit-button",disabled:e.loading||!_e.value},[n("span",ce,[e.loading?(u(),d("span",me,c(p(s)("register.registering")),1)):(u(),d("span",pe,c(p(s)("register.register_button")),1))]),e.loading?(u(),d("div",ge)):v("",!0)],8,ve)],32)}}},[["__scopeId","data-v-8653c9c3"]]),_e={class:"register-page"},be={class:"top-right-controls"},ye={class:"controls-container"},Ce={class:"register-container"},we={class:"register-card"},ke={class:"back-to-login"},he={class:"register-header"},xe={class:"register-title"},Ve={class:"register-subtitle"},Ie={class:"register-form-section"},Be={class:"login-prompt"},je={class:"prompt-text"},Fe={key:0,class:"error-message"},qe=e({__name:"Register",setup(e){const a=I(),t=V(),m=l(),{t:g}=i(),f=o("");x(()=>{const e=t.query.inviteCode;e&&(f.value=e)});const y=e=>{const l=t.query;a.replace({name:"login",query:l})},C=e=>{console.error("注册失败:",e)},w=()=>{const e=t.query;a.replace({name:"login",query:e})};return x(()=>{m.isAuthenticated&&(m.isCreator?a.push("/creator"):m.isAdmin?a.push("/admin"):a.push("/dashboard"))}),(e,a)=>{const l=F;return u(),d("div",_e,[a[0]||(a[0]=n("div",{class:"register-background"},null,-1)),n("div",be,[n("div",ye,[_(s,{position:"top-right","tooltip-text":p(g)("register.theme_toggle_tooltip")},null,8,["tooltip-text"]),_(r,{position:"top-right","tooltip-text":p(g)("register.language_toggle_tooltip")},null,8,["tooltip-text"])])]),n("div",Ce,[n("div",we,[n("div",ke,[n("button",{onClick:w,class:"back-link"},[_(l,{class:"back-icon"},{default:b(()=>[_(p(A))]),_:1}),B(" "+c(p(g)("register.back_to_login")),1)])]),n("div",he,[n("h1",xe,c(p(g)("register.title")),1),n("p",Ve,c(p(g)("register.subtitle")),1)]),n("div",Ie,[_(fe,{onSuccess:y,onError:C,loading:p(m).loading,inviteCode:f.value},null,8,["loading","inviteCode"])]),n("div",Be,[n("span",je,c(p(g)("register.has_account")),1),n("button",{onClick:w,class:"login-link"},c(p(g)("register.login_now")),1)]),p(m).error?(u(),d("div",Fe,[_(l,{class:"error-icon"},{default:b(()=>[_(p(j))]),_:1}),n("span",null,c(p(m).error),1)])):v("",!0)])])])}}},[["__scopeId","data-v-b492965e"]]);export{qe as default};
