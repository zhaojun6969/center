import{_ as e,e as a,F as t}from"./index-B4iIxVom.js";/* empty css                     *//* empty css                 *//* empty css                 */import{C as l,E as s,aA as r,D as i,au as d,x as n,ap as c,a6 as g,af as o,a8 as u,aR as m,aS as p,H as v,e as f,aD as C,B as y,d as h}from"./elementPlus-5sGCOaHt.js";import{r as w}from"./utils-D5ZNaMwG.js";import{az as b,r as $,j as _,l as U,c as M,al as k,z as x,A as V,B,L as F,R as T,P as j,I as D,J as L,O as P,u as R,Q as G,a5 as q}from"./vendor-ClluBQmh.js";import{G as z}from"./index-CZQvO8jl.js";const S=l(w()),E={class:"greeting-card-page"},I={class:"page-header"},A={class:"header-content"},Y={class:"page-title"},H={class:"a1-series-tip"},W={class:"tip-card"},J={class:"tip-header"},N={class:"tip-title-section"},O={class:"tip-title"},Q={class:"tip-subtitle"},K={class:"tip-features"},X={class:"tip-feature"},Z={class:"feature-content"},ee={class:"tip-feature"},ae={class:"feature-content"},te={class:"tip-feature"},le={class:"feature-content"},se={class:"main-content"},re={class:"action-bar"},ie={key:0,class:"card-grid"},de={class:"card-image-wrapper"},ne=["src"],ce={class:"card-overlay"},ge={class:"card-date"},oe={class:"card-body"},ue={class:"card-message"},me={class:"card-actions"},pe={key:0,style:{height:"60px"}},ve=["src"],fe={key:1,class:"upload-placeholder"},Ce={class:"upload-text"},ye={class:"form-item-label"},he={class:"form-item-label"},we={class:"dialog-footer"},be={class:"delete-confirm-content"},$e={class:"delete-message"},_e={class:"dialog-footer"},Ue=e({__name:"GreetingCard",setup(e){const l=new t,w=new z,{t:Ue,locale:Me}=b(),ke=$([]),xe=async()=>{try{const e=await w.getMyGreetingCardList();ke.value=e.rows.map(e=>({id:e.id,imageUrl:e.extraInfo.image.replace(/`/g,"").trim(),message:e.content,createTime:e.createdAt,cardMessage:e.extraInfo.cardMessage}))}catch(e){h.error(e.message||Ue("greetingCard.loadError"))}};_(()=>{xe()});const Ve=$(!1),Be=$(!1),Fe=$(!1),Te=$(!1),je=$(!1),De=$(null),Le=U({imageUrl:"",message:"",id:null,cardMessage:""}),Pe=$(null),Re=U({id:null,imageUrl:"",message:"",cardMessage:""}),Ge=M(()=>({imageUrl:[{required:!0,message:Ue("greetingCard.imageRequired"),trigger:"change"}],message:[{required:!0,message:Ue("greetingCard.messageRequired"),trigger:"blur"}],cardMessage:[{required:!0,message:Ue("greetingCard.cardMessageRequired"),trigger:"blur"}]})),qe=M(()=>"undefined"==typeof window?"500px":window.innerWidth<768?"90%":"500px"),ze=M(()=>"undefined"==typeof window?"400px":window.innerWidth<768?"90%":"400px"),Se=M(()=>"zh"===Me.value?150:200),Ee=M(()=>(Me.value,30)),Ie=()=>{Be.value=!1,Re.id=null,Re.imageUrl="",Re.message="",Re.cardMessage="",Ve.value=!0},Ae=async()=>{if(De.value)try{await w.deleteGreetingCard({id:De.value}),ke.value=ke.value.filter(e=>e.id!==De.value),h.success(Ue("greetingCard.deleteSuccess")),je.value=!1,De.value=null}catch(e){h.error(e.message||Ue("greetingCard.deleteError"))}},Ye=e=>{const a=e.raw;if(!a)return;if(!a.type.startsWith("image/"))return void h.error("è¯·ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶");const t=new FileReader;t.onload=async e=>{const a=await l.uploadFile(e.target.result);Re.imageUrl=a,Pe.value&&Pe.value.validateField("imageUrl")},t.readAsDataURL(a)},He=async()=>{Pe.value&&await Pe.value.validate(async e=>{if(e){Fe.value=!0;try{Be.value?(await w.updateGreetingCard({id:Re.id,content:Re.message,image:Re.imageUrl,cardMessage:Re.cardMessage}),h.success(Ue("greetingCard.updateSuccess"))):(await w.createGreetingCard({content:Re.message,image:Re.imageUrl,cardMessage:Re.cardMessage}),h.success(Ue("greetingCard.createSuccess"))),await xe(),Fe.value=!1,Ve.value=!1}catch(a){Fe.value=!1,h.error(a.message||Ue("greetingCard.saveError"))}}})};return(e,t)=>{const l=s,h=i,w=g,b=m,$=u,_=f,U=v,M=o,z=y,Ue=k("DtCardPreview");return V(),x("div",E,[B("div",I,[B("div",A,[B("h1",Y,j(e.$t("greetingCard.pageTitle")),1),B("div",H,j(e.$t("greetingCard.a1SeriesTip")),1),B("div",W,[B("div",J,[B("div",N,[B("h3",O,j(e.$t("greetingCard.tipTitle")),1),B("p",Q,j(e.$t("greetingCard.tipSubtitle")),1)])]),B("div",K,[B("div",X,[t[7]||(t[7]=B("div",{class:"feature-icon"},"ðŸŽ",-1)),B("div",Z,[B("h4",null,j(e.$t("greetingCard.tipFeatures.feature1.title")),1),B("p",null,j(e.$t("greetingCard.tipFeatures.feature1.description")),1)])]),B("div",ee,[t[8]||(t[8]=B("div",{class:"feature-icon"},"ðŸ“±",-1)),B("div",ae,[B("h4",null,j(e.$t("greetingCard.tipFeatures.feature2.title")),1),B("p",null,j(e.$t("greetingCard.tipFeatures.feature2.description")),1)])]),B("div",te,[t[9]||(t[9]=B("div",{class:"feature-icon"},"ðŸ’",-1)),B("div",le,[B("h4",null,j(e.$t("greetingCard.tipFeatures.feature3.title")),1),B("p",null,j(e.$t("greetingCard.tipFeatures.feature3.description")),1)])])])])])]),B("div",se,[B("div",re,[T(h,{type:"primary",size:"large",class:"add-btn",onClick:Ie},{default:L(()=>[T(l,null,{default:L(()=>[T(R(r))]),_:1}),P("Â  "+j(e.$t("greetingCard.createButton")),1)]),_:1})]),ke.value.length>0?(V(),x("div",ie,[(V(!0),x(G,null,q(ke.value,a=>{return V(),x("div",{key:a.id,class:"greeting-card-item"},[B("div",de,[B("img",{src:a.imageUrl,alt:"Greeting Card Image",class:"card-image"},null,8,ne),B("div",ce,[B("span",ge,j((t=a.createTime,S(t).format("YYYY-MM-DD HH:mm"))),1)])]),B("div",oe,[B("p",ue,j(a.message),1),B("div",me,[T(h,{type:"primary",class:"edit-btn",onClick:e=>(e=>{Be.value=!0,Re.id=e.id,Re.imageUrl=e.imageUrl,Re.message=e.message,Re.cardMessage=e.cardMessage||"",Ve.value=!0})(a)},{default:L(()=>[T(l,null,{default:L(()=>[T(R(d))]),_:1}),P(" "+j(e.$t("greetingCard.editButton")),1)]),_:1},8,["onClick"]),T(h,{type:"primary",class:"preview-btn",onClick:e=>(e=>{Le.imageUrl=e.imageUrl,Le.message=e.message,Le.id=e.id,Le.cardMessage=e.cardMessage,Te.value=!0})(a)},{default:L(()=>[T(l,null,{default:L(()=>[T(R(n))]),_:1}),P(" "+j(e.$t("greetingCard.previewButton")),1)]),_:1},8,["onClick"]),T(h,{type:"danger",link:"",class:"action-btn",onClick:e=>(e=>{De.value=e.id,je.value=!0})(a)},{default:L(()=>[T(l,null,{default:L(()=>[T(R(c))]),_:1}),P(" "+j(e.$t("greetingCard.deleteButton")),1)]),_:1},8,["onClick"])])])]);var t}),128))])):(V(),D(w,{key:1,description:e.$t("greetingCard.emptyTitle")+" "+e.$t("greetingCard.emptyDescription"),"image-size":200},null,8,["description"]))]),R(a).isPortraitDevice()?(V(),x("div",pe)):F("",!0),T(z,{modelValue:Ve.value,"onUpdate:modelValue":t[3]||(t[3]=e=>Ve.value=e),title:Be.value?e.$t("greetingCard.dialogEditTitle"):e.$t("greetingCard.dialogCreateTitle"),width:qe.value,"custom-class":"custom-dialog","destroy-on-close":"","close-on-click-modal":!1,"close-on-press-escape":!0,"append-to-body":""},{footer:L(()=>[B("span",we,[T(h,{onClick:t[2]||(t[2]=e=>Ve.value=!1)},{default:L(()=>[P(j(e.$t("greetingCard.cancelButton")),1)]),_:1}),T(h,{type:"primary",class:"save-btn",onClick:He,loading:Fe.value},{default:L(()=>[P(j(e.$t("greetingCard.saveButton")),1)]),_:1},8,["loading"])])]),default:L(()=>[T(M,{model:Re,"label-position":"top",rules:Ge.value,ref_key:"formRef",ref:Pe},{default:L(()=>[T($,{label:e.$t("greetingCard.imageUploadLabel"),prop:"imageUrl"},{default:L(()=>[T(b,{class:"image-uploader",action:"#","auto-upload":!1,"show-file-list":!1,"on-change":Ye,accept:"image/*",drag:""},{default:L(()=>[Re.imageUrl?(V(),x("img",{key:0,src:Re.imageUrl.replace("draft-user.s3.us-east-2.amazonaws.com","dcts99982ui0s.cloudfront.net"),class:"uploaded-image"},null,8,ve)):(V(),x("div",fe,[T(l,{class:"upload-icon"},{default:L(()=>[T(R(p))]),_:1}),B("div",Ce,j(e.$t("greetingCard.imageUploadPlaceholder")),1)]))]),_:1})]),_:1},8,["label"]),T($,{label:e.$t("greetingCard.cardMessageLabel"),prop:"cardMessage"},{label:L(()=>[B("span",ye,[P(j(e.$t("greetingCard.cardMessageLabel"))+" ",1),T(_,{content:e.$t("greetingCard.cardMessageTooltip"),placement:"top"},{default:L(()=>[T(l,{class:"label-tooltip-icon"},{default:L(()=>[T(R(C))]),_:1})]),_:1},8,["content"])])]),default:L(()=>[T(U,{modelValue:Re.cardMessage,"onUpdate:modelValue":t[0]||(t[0]=e=>Re.cardMessage=e),type:"textarea",rows:4,placeholder:e.$t("greetingCard.cardMessagePlaceholder"),maxlength:Ee.value,"show-word-limit":""},null,8,["modelValue","placeholder","maxlength"])]),_:1},8,["label"]),T($,{label:e.$t("greetingCard.messageLabel"),prop:"message"},{label:L(()=>[B("span",he,[P(j(e.$t("greetingCard.messageLabel"))+" ",1),T(_,{content:e.$t("greetingCard.messageTooltip"),placement:"top"},{default:L(()=>[T(l,{class:"label-tooltip-icon"},{default:L(()=>[T(R(C))]),_:1})]),_:1},8,["content"])])]),default:L(()=>[T(U,{modelValue:Re.message,"onUpdate:modelValue":t[1]||(t[1]=e=>Re.message=e),type:"textarea",rows:4,placeholder:e.$t("greetingCard.messagePlaceholder"),maxlength:Se.value,"show-word-limit":""},null,8,["modelValue","placeholder","maxlength"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","width"]),T(z,{modelValue:je.value,"onUpdate:modelValue":t[5]||(t[5]=e=>je.value=e),width:ze.value,"custom-class":"delete-confirm-dialog","destroy-on-close":"","close-on-click-modal":!1,"close-on-press-escape":!0,"append-to-body":"",center:""},{footer:L(()=>[B("span",_e,[T(h,{onClick:t[4]||(t[4]=e=>je.value=!1),class:"cancel-delete-btn"},{default:L(()=>[P(j(e.$t("greetingCard.cancelButton")),1)]),_:1}),T(h,{type:"danger",class:"confirm-delete-btn",onClick:Ae},{default:L(()=>[P(j(e.$t("greetingCard.deleteButton")),1)]),_:1})])]),default:L(()=>[B("div",be,[B("p",$e,j(e.$t("greetingCard.deleteConfirm")),1)])]),_:1},8,["modelValue","width"]),T(Ue,{"card-message":Le.cardMessage,id:Le.id,modelValue:Te.value,"onUpdate:modelValue":t[6]||(t[6]=e=>Te.value=e),"image-url":Le.imageUrl,message:Le.message},null,8,["card-message","id","modelValue","image-url","message"])])}}},[["__scopeId","data-v-c1676c17"]]);export{Ue as default};
