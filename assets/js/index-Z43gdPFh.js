import{az as e,r as a,c as s,j as i,aB as o,U as t,z as r,B as c,L as l,P as n,u as d,Q as u,a5 as g,aA as p,A as m}from"./vendor-ClluBQmh.js";import{S as v}from"./index-7vXv9XNO.js";import{_ as h,e as w}from"./index-B4iIxVom.js";import"./elementPlus-5sGCOaHt.js";import"./utils-D5ZNaMwG.js";const y={class:"category-container"},k={class:"breadcrumb"},b={class:"breadcrumb-item active"},f={class:"category-header"},x={class:"category-title"},P={class:"category-description"},C={key:0,class:"empty-state"},j={key:1,class:"products-container"},D=["onClick"],L={class:"product-image"},M=["src","alt"],F={key:0,class:"product-badge"},I={key:1,class:"discount-badge"},B={class:"product-info"},$={class:"product-name"},_={class:"product-desc"},z={class:"product-footer"},N={class:"price-section"},S={class:"current-price"},q={key:0,class:"original-price"},A={key:2,class:"load-more"},E=["disabled"],G={key:0},H={key:1},R=h({__name:"index",setup(h){const R=p(),Q=o(),{t:U}=e(),Y=new v,J=a(1),K=a(12),O=a(0),T=a(!1),V=a(!0),W=a({id:null,name:"",description:"",image:""}),X=a([]),Z=async(e,a=1)=>{if(!T.value){T.value=!0;try{const s=await Y.getGoodsList({categoryId:e,pageSize:K.value,pageNum:a});if(console.log("Goods List Response for category",e,":",s),s&&s.success&&s.data&&s.data.rows){if(1===a)X.value=s.data.rows.map(e=>({id:e.id,name:e.goodsName,description:e.shortDesc||"",image:e.mainImage||e.images?.[0]||"",price:e.price?.toFixed(2)||"0",originalPrice:e.originalPrice?.toFixed(2)||"",discount:e.originalPrice?`-${Math.round(100*(1-e.price/e.originalPrice))}%`:"",badge:e.tags?.[0]||"",inStock:e.stock>0}));else{const e=s.data.rows.map(e=>({id:e.id,name:e.goodsName,description:e.shortDesc||"",image:e.mainImage||e.images?.[0]||"",price:e.price?.toFixed(2)||"0",originalPrice:e.originalPrice?.toFixed(2)||"",discount:e.originalPrice?`-${Math.round(100*(1-e.price/e.originalPrice))}%`:"",badge:e.tags?.[0]||"",inStock:e.stock>0}));X.value=[...X.value,...e]}O.value=s.data.total||0,V.value=X.value.length<O.value}}catch(s){console.error("Failed to fetch goods list:",s)}finally{T.value=!1}}},ee=()=>{V.value&&!T.value&&(J.value++,Z(W.value.id,J.value))},ae=()=>{window.scrollY+window.innerHeight>=document.documentElement.scrollHeight-500&&ee()},se=s(()=>X.value);s(()=>Math.ceil(O.value/K.value));const ie=()=>{R.push("/shop")};return i(()=>{const e=Q.params.category;e&&(console.log("Category ID:",e),(async e=>{try{const a=await Y.getCategoryList();if(console.log("Category List Response:",a),a&&a.success&&a.data){const s=a.data.find(a=>a.id===parseInt(e));s&&(W.value={id:s.id,name:s.categoryName,description:s.description||"",image:s.image||""})}}catch(a){console.error("Failed to fetch category detail:",a)}})(e),Z(e,1),window.addEventListener("scroll",ae))}),t(()=>{window.removeEventListener("scroll",ae)}),(e,a)=>(m(),r("div",y,[c("div",k,[c("span",{class:"breadcrumb-item",onClick:ie},n(d(U)("shop.title")),1),a[0]||(a[0]=c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor"},[c("path",{"stroke-linecap":"square","stroke-linejoin":"miter",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})],-1)),c("span",b,n(W.value.name),1)]),c("div",f,[c("h1",x,n(W.value.name),1),c("p",P,n(W.value.description),1)]),0===se.value.length?(m(),r("div",C,[a[1]||(a[1]=c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[c("path",{"stroke-linecap":"square","stroke-linejoin":"miter",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"})],-1)),c("p",null,n(d(U)("shop.category.noProducts")),1)])):(m(),r("div",j,[(m(!0),r(u,null,g(se.value,e=>(m(),r("div",{key:e.id,class:"product-card",onClick:a=>{return s=e.id,void R.push(`/shop/detail/${s}`);var s}},[c("div",L,[c("img",{src:e.image,alt:e.name},null,8,M),e.badge?(m(),r("div",F,n(e.badge),1)):l("",!0),e.discount?(m(),r("div",I,n(e.discount),1)):l("",!0)]),c("div",B,[c("h3",$,n(e.name),1),c("p",_,n(e.description),1),c("div",z,[c("div",N,[c("span",S,n(d(w).isDomesticDomain()?"¥":"$")+n(e.price),1),e.originalPrice?(m(),r("span",q,n(d(w).isDomesticDomain()?"¥":"$")+n(e.originalPrice),1)):l("",!0)]),a[2]||(a[2]=c("button",{class:"add-cart-btn"},[c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor"},[c("path",{"stroke-linecap":"square","stroke-linejoin":"miter",d:"M12 4.5v15m7.5-7.5h-15"})])],-1))])])],8,D))),128))])),V.value?(m(),r("div",A,[c("button",{class:"load-more-btn",onClick:ee,disabled:T.value},[T.value?(m(),r("span",H,n(d(U)("shop.category.loading")),1)):(m(),r("span",G,n(d(U)("shop.category.loadMore")),1))],8,E)])):l("",!0)]))}},[["__scopeId","data-v-a4872340"]]);export{R as default};
