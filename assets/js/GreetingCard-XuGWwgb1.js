import{_ as e,e as a,F as t}from"./index-7lN_iYAB.js";/* empty css                     *//* empty css                 *//* empty css                 */import{D as s,E as l,Q as r,F as i,ar as d,y as n,S as g,aa as c,ak as o,ad as u,as as m,at as p,I as v,C as f,d as C}from"./elementPlus-CAPqDV7g.js";import{r as y}from"./utils-D5HVl94d.js";import{az as h,r as w,f as $,l as U,c as _,al as b,z as M,A as k,B as x,L as V,R as F,P as B,I as j,J as G,O as T,u as z,Q as D,a5 as I}from"./vendor-zwaLhAD5.js";import{G as P}from"./index-CabE1deY.js";const R=s(y()),q={class:"greeting-card-page"},L={class:"page-header"},S={class:"header-content"},E={class:"page-title"},Y={class:"a1-series-tip"},A={class:"tip-card"},W={class:"tip-header"},H={class:"tip-title-section"},Q={class:"tip-title"},J={class:"tip-subtitle"},N={class:"tip-features"},O={class:"tip-feature"},K={class:"feature-content"},X={class:"tip-feature"},Z={class:"feature-content"},ee={class:"tip-feature"},ae={class:"feature-content"},te={class:"main-content"},se={class:"action-bar"},le={key:0,class:"card-grid"},re={class:"card-image-wrapper"},ie=["src"],de={class:"card-overlay"},ne={class:"card-date"},ge={class:"card-body"},ce={class:"card-message"},oe={class:"card-actions"},ue={key:0,style:{height:"60px"}},me=["src"],pe={key:1,class:"upload-placeholder"},ve={class:"upload-text"},fe={class:"dialog-footer"},Ce={class:"delete-confirm-content"},ye={class:"delete-message"},he={class:"dialog-footer"},we=e({__name:"GreetingCard",setup(e){const s=new t,y=new P,{t:we,locale:$e}=h(),Ue=w([]),_e=async()=>{try{const e=await y.getMyGreetingCardList();Ue.value=e.rows.map(e=>({id:e.id,imageUrl:e.extraInfo.image.replace(/`/g,"").trim(),message:e.content,createTime:e.createdAt,cardMessage:e.extraInfo.cardMessage}))}catch(e){C.error(e.message||we("greetingCard.loadError"))}};$(()=>{_e()});const be=w(!1),Me=w(!1),ke=w(!1),xe=w(!1),Ve=w(!1),Fe=w(null),Be=U({imageUrl:"",message:"",id:null,cardMessage:""}),je=w(null),Ge=U({id:null,imageUrl:"",message:"",cardMessage:""}),Te=_(()=>({imageUrl:[{required:!0,message:we("greetingCard.imageRequired"),trigger:"change"}],message:[{required:!0,message:we("greetingCard.messageRequired"),trigger:"blur"}],cardMessage:[{required:!0,message:we("greetingCard.cardMessageRequired"),trigger:"blur"}]})),ze=_(()=>"undefined"==typeof window?"500px":window.innerWidth<768?"90%":"500px"),De=_(()=>"undefined"==typeof window?"400px":window.innerWidth<768?"90%":"400px"),Ie=_(()=>"zh"===$e.value?150:200),Pe=_(()=>"zh"===$e.value?10:30),Re=()=>{Me.value=!1,Ge.id=null,Ge.imageUrl="",Ge.message="",Ge.cardMessage="",be.value=!0},qe=async()=>{if(Fe.value)try{await y.deleteGreetingCard({id:Fe.value}),Ue.value=Ue.value.filter(e=>e.id!==Fe.value),C.success(we("greetingCard.deleteSuccess")),Ve.value=!1,Fe.value=null}catch(e){C.error(e.message||we("greetingCard.deleteError"))}},Le=e=>{const a=e.raw;if(!a)return;if(!a.type.startsWith("image/"))return void C.error("è¯·ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶");const t=new FileReader;t.onload=async e=>{const a=await s.uploadFile(e.target.result);Ge.imageUrl=a,je.value&&je.value.validateField("imageUrl")},t.readAsDataURL(a)},Se=async()=>{je.value&&await je.value.validate(async e=>{if(e){ke.value=!0;try{Me.value?(await y.updateGreetingCard({id:Ge.id,content:Ge.message,image:Ge.imageUrl,cardMessage:Ge.cardMessage}),C.success(we("greetingCard.updateSuccess"))):(await y.createGreetingCard({content:Ge.message,image:Ge.imageUrl,cardMessage:Ge.cardMessage}),C.success(we("greetingCard.createSuccess"))),await _e(),ke.value=!1,be.value=!1}catch(a){ke.value=!1,C.error(a.message||we("greetingCard.saveError"))}}})};return(e,t)=>{const s=l,C=i,y=c,h=m,w=u,$=v,U=o,_=f,P=b("DtCardPreview");return k(),M("div",q,[x("div",L,[x("div",S,[x("h1",E,B(e.$t("greetingCard.pageTitle")),1),x("div",Y,B(e.$t("greetingCard.a1SeriesTip")),1),x("div",A,[x("div",W,[x("div",H,[x("h3",Q,B(e.$t("greetingCard.tipTitle")),1),x("p",J,B(e.$t("greetingCard.tipSubtitle")),1)])]),x("div",N,[x("div",O,[t[7]||(t[7]=x("div",{class:"feature-icon"},"ðŸŽ",-1)),x("div",K,[x("h4",null,B(e.$t("greetingCard.tipFeatures.feature1.title")),1),x("p",null,B(e.$t("greetingCard.tipFeatures.feature1.description")),1)])]),x("div",X,[t[8]||(t[8]=x("div",{class:"feature-icon"},"ðŸ“±",-1)),x("div",Z,[x("h4",null,B(e.$t("greetingCard.tipFeatures.feature2.title")),1),x("p",null,B(e.$t("greetingCard.tipFeatures.feature2.description")),1)])]),x("div",ee,[t[9]||(t[9]=x("div",{class:"feature-icon"},"ðŸ’",-1)),x("div",ae,[x("h4",null,B(e.$t("greetingCard.tipFeatures.feature3.title")),1),x("p",null,B(e.$t("greetingCard.tipFeatures.feature3.description")),1)])])])])])]),x("div",te,[x("div",se,[F(C,{type:"primary",size:"large",class:"add-btn",onClick:Re},{default:G(()=>[F(s,null,{default:G(()=>[F(z(r))]),_:1}),T("Â  "+B(e.$t("greetingCard.createButton")),1)]),_:1})]),Ue.value.length>0?(k(),M("div",le,[(k(!0),M(D,null,I(Ue.value,a=>{return k(),M("div",{key:a.id,class:"greeting-card-item"},[x("div",re,[x("img",{src:a.imageUrl,alt:"Greeting Card Image",class:"card-image"},null,8,ie),x("div",de,[x("span",ne,B((t=a.createTime,R(t).format("YYYY-MM-DD HH:mm"))),1)])]),x("div",ge,[x("p",ce,B(a.message),1),x("div",oe,[F(C,{type:"primary",class:"edit-btn",onClick:e=>(e=>{Me.value=!0,Ge.id=e.id,Ge.imageUrl=e.imageUrl,Ge.message=e.message,Ge.cardMessage=e.cardMessage||"",be.value=!0})(a)},{default:G(()=>[F(s,null,{default:G(()=>[F(z(d))]),_:1}),T(" "+B(e.$t("greetingCard.editButton")),1)]),_:1},8,["onClick"]),F(C,{type:"primary",class:"preview-btn",onClick:e=>(e=>{Be.imageUrl=e.imageUrl,Be.message=e.message,Be.id=e.id,Be.cardMessage=e.cardMessage,xe.value=!0})(a)},{default:G(()=>[F(s,null,{default:G(()=>[F(z(n))]),_:1}),T(" "+B(e.$t("greetingCard.previewButton")),1)]),_:1},8,["onClick"]),F(C,{type:"danger",link:"",class:"action-btn",onClick:e=>(e=>{Fe.value=e.id,Ve.value=!0})(a)},{default:G(()=>[F(s,null,{default:G(()=>[F(z(g))]),_:1}),T(" "+B(e.$t("greetingCard.deleteButton")),1)]),_:1},8,["onClick"])])])]);var t}),128))])):(k(),j(y,{key:1,description:e.$t("greetingCard.emptyTitle")+" "+e.$t("greetingCard.emptyDescription"),"image-size":200},null,8,["description"]))]),z(a).isPortraitDevice()?(k(),M("div",ue)):V("",!0),F(_,{modelValue:be.value,"onUpdate:modelValue":t[3]||(t[3]=e=>be.value=e),title:Me.value?e.$t("greetingCard.dialogEditTitle"):e.$t("greetingCard.dialogCreateTitle"),width:ze.value,"custom-class":"custom-dialog","destroy-on-close":"","close-on-click-modal":!1,"close-on-press-escape":!0,"append-to-body":""},{footer:G(()=>[x("span",fe,[F(C,{onClick:t[2]||(t[2]=e=>be.value=!1)},{default:G(()=>[T(B(e.$t("greetingCard.cancelButton")),1)]),_:1}),F(C,{type:"primary",class:"save-btn",onClick:Se,loading:ke.value},{default:G(()=>[T(B(e.$t("greetingCard.saveButton")),1)]),_:1},8,["loading"])])]),default:G(()=>[F(U,{model:Ge,"label-position":"top",rules:Te.value,ref_key:"formRef",ref:je},{default:G(()=>[F(w,{label:e.$t("greetingCard.imageUploadLabel"),prop:"imageUrl"},{default:G(()=>[F(h,{class:"image-uploader",action:"#","auto-upload":!1,"show-file-list":!1,"on-change":Le,accept:"image/*",drag:""},{default:G(()=>[Ge.imageUrl?(k(),M("img",{key:0,src:Ge.imageUrl.replace("draft-user.s3.us-east-2.amazonaws.com","dcts99982ui0s.cloudfront.net"),class:"uploaded-image"},null,8,me)):(k(),M("div",pe,[F(s,{class:"upload-icon"},{default:G(()=>[F(z(p))]),_:1}),x("div",ve,B(e.$t("greetingCard.imageUploadPlaceholder")),1)]))]),_:1})]),_:1},8,["label"]),F(w,{label:e.$t("greetingCard.messageLabel"),prop:"message"},{default:G(()=>[F($,{modelValue:Ge.message,"onUpdate:modelValue":t[0]||(t[0]=e=>Ge.message=e),type:"textarea",rows:4,placeholder:e.$t("greetingCard.messagePlaceholder"),maxlength:Ie.value,"show-word-limit":""},null,8,["modelValue","placeholder","maxlength"])]),_:1},8,["label"]),F(w,{label:e.$t("greetingCard.cardMessageLabel"),prop:"cardMessage"},{default:G(()=>[F($,{modelValue:Ge.cardMessage,"onUpdate:modelValue":t[1]||(t[1]=e=>Ge.cardMessage=e),type:"textarea",rows:4,placeholder:e.$t("greetingCard.cardMessagePlaceholder"),maxlength:Pe.value,"show-word-limit":""},null,8,["modelValue","placeholder","maxlength"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","width"]),F(_,{modelValue:Ve.value,"onUpdate:modelValue":t[5]||(t[5]=e=>Ve.value=e),width:De.value,"custom-class":"delete-confirm-dialog","destroy-on-close":"","close-on-click-modal":!1,"close-on-press-escape":!0,"append-to-body":"",center:""},{footer:G(()=>[x("span",he,[F(C,{onClick:t[4]||(t[4]=e=>Ve.value=!1),class:"cancel-delete-btn"},{default:G(()=>[T(B(e.$t("greetingCard.cancelButton")),1)]),_:1}),F(C,{type:"danger",class:"confirm-delete-btn",onClick:qe},{default:G(()=>[T(B(e.$t("greetingCard.deleteButton")),1)]),_:1})])]),default:G(()=>[x("div",Ce,[x("p",ye,B(e.$t("greetingCard.deleteConfirm")),1)])]),_:1},8,["modelValue","width"]),F(P,{"card-message":Be.cardMessage,id:Be.id,modelValue:xe.value,"onUpdate:modelValue":t[6]||(t[6]=e=>xe.value=e),"image-url":Be.imageUrl,message:Be.message},null,8,["card-message","id","modelValue","image-url","message"])])}}},[["__scopeId","data-v-a6aedf0f"]]);export{we as default};
