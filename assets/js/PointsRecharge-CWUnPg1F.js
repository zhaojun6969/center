import{az as e,aA as a,r as s,c,f as l,z as o,A as r,B as i,L as n,P as t,u,R as d,Q as v,a5 as p,E as h,W as m}from"./vendor-zwaLhAD5.js";import{r as g,d as y,_ as k,a as R,i as f,g as b,W as _}from"./index-7lN_iYAB.js";import{P as C}from"./payserver-BYUcn7Ja.js";import"./elementPlus-CAPqDV7g.js";import"./utils-D5HVl94d.js";let A=class extends C{constructor(){super()}async getRechargePackageList(){let e=await g.common(y.RECHARGE_PACKAGES);if(0==e.code){return e.data}throw new Error(e.msg)}async confirmPay(e){this.createPayorOrder(e,2)}};const P={class:"points-recharge-page"},w={class:"top-bar"},S={class:"language-switcher"},x={class:"page-header"},D={class:"page-title"},O={class:"page-subtitle"},j={class:"plans-container"},E=["onClick"],$={class:"plan-header"},F={class:"plan-name"},L={key:0,class:"plan-badge"},U={class:"plan-price"},W={class:"price-amount"},z={class:"price-period"},B={class:"plan-points"},G={class:"plan-validity"},N={class:"plan-features"},H=["onClick"],I={class:"points-rules"},J={class:"rules-title"},K={class:"rules-list"},M={class:"rule-item"},Q={class:"rule-item"},V={class:"rule-item"},Y={class:"voucher-modal-header"},q={class:"voucher-modal-title"},T={class:"voucher-modal-content"},X={class:"selected-package-info"},Z={class:"package-name"},ee={class:"package-price"},ae={class:"original-price"},se={key:0,class:"discount-price"},ce={class:"voucher-section"},le={key:0,class:"loading-vouchers"},oe={key:1,class:"no-vouchers"},re={key:2,class:"voucher-list"},ie=["onClick"],ne={class:"voucher-left"},te={class:"voucher-amount"},ue={class:"voucher-code"},de={class:"voucher-right"},ve={class:"voucher-desc"},pe={class:"voucher-min"},he={class:"voucher-expire"},me={class:"voucher-check"},ge={key:0,class:"check-icon"},ye={class:"voucher-modal-footer"},ke=["disabled"],Re={key:0},fe={key:1},be=k({__name:"PointsRecharge",setup(k){const C=new A,{t:be}=e(),_e=a(),Ce=s(null),Ae=s([]),Pe=s([]),we=s(null),Se=s(!1),xe=s(0),De=s(!1),Oe=s(null),je=s(!1),Ee=c(()=>[...Ae.value].sort((e,a)=>e.sort_order-a.sort_order)),$e=()=>{const e=_e.options.history.state;console.log(e),e.back||_e.replace("/user-center"),_e.back()},Fe=e=>{we.value?.id===e.id?we.value=null:we.value=e,(()=>{if(!Oe.value)return;je.value=!0;let e={currency:Oe.value.currency,amount:Oe.value.amount};we.value?e.coupon_ids=[we.value.id]:e.coupon_ids=[],g.common(y.calculateUnitAmount,e).then(e=>{const a=e.data;xe.value=a.discount_amount||0}).catch(e=>{console.error("更新支付信息失败:",e)}).finally(()=>{je.value=!1})})()},Le=e=>{if(!e)return"";const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`},Ue=()=>{if(!Oe.value)return;let e={package_id:Oe.value.id};if(we.value?e.coupon_ids=[we.value.id]:e.coupon_ids=[],f()){const a=b()||"";return void _.BusWechartForNavigate("/pages/pay/payPoint",{method:"pay",payData:JSON.stringify({package_id:Oe.value.id,credits:Oe.value.credits,amount:Oe.value.amount,token:a,coupon_ids:e.coupon_ids})},"1")}C.confirmPay(e),De.value=!1},We=()=>{De.value=!1,we.value=null,xe.value=0,Oe.value=null},ze=async()=>{const e=(await C.getRechargePackageList()).items||[];Ae.value=e,await(async()=>{Se.value=!0;try{const e=await g.common(y.getAvailableCoupon);0===e.code&&(Pe.value=e.data||[])}catch(e){console.error("获取优惠券列表失败:",e),Pe.value=[]}finally{Se.value=!1}})()};return l(()=>{ze()}),(e,a)=>(r(),o("div",P,[i("div",w,[i("button",{class:"back-button",onClick:$e}," ← "+t(u(be)("common.back")),1),i("div",S,[d(R)])]),i("div",x,[i("h1",D,t(u(be)("pointsRecharge.title")),1),i("p",O,t(u(be)("pointsRecharge.subtitle")),1)]),i("div",j,[(r(!0),o(v,null,p(Ee.value,e=>(r(),o("div",{key:e.id,class:h(["plan-card",{premium:1===e.is_recommended}]),onClick:a=>{return s=e.id,void(Ce.value=s);var s}},[i("div",$,[i("h3",F,t(e.package_name),1),1===e.is_recommended?(r(),o("div",L,t(u(be)("pointsRecharge.plans.premium.badge")),1)):n("",!0)]),i("div",U,[i("span",W,t(e.currency)+" "+t(e.amount),1),i("span",z,"/ "+t(u(be)("pointsRecharge.period")),1)]),i("div",B,t(e.credits)+" "+t(u(be)("pointsRecharge.points")),1),i("div",G,t(u(be)("pointsRecharge.validity"))+": "+t(e.validity_days)+" "+t(u(be)("pointsRecharge.period")),1),i("div",N,[i("ul",null,[i("li",null,t(u(be)("pointsRecharge.features.unlimitedAccess")),1),i("li",null,t(u(be)("pointsRecharge.features.prioritySupport")),1),i("li",null,t(u(be)("pointsRecharge.features.securePayment")),1)])]),i("button",{class:h(["purchase-button",{"premium-button":1===e.is_recommended}]),onClick:m(a=>(e=>{console.log(e,"pkgpkg"),Oe.value=e,De.value=!0})(e),["stop"])},t(u(be)("pointsRecharge.purchase")),11,H)],10,E))),128))]),i("div",I,[i("h2",J,t(u(be)("pointsRecharge.rules.title")),1),i("ul",K,[i("li",M,t(u(be)("pointsRecharge.rules.rule1")),1),i("li",Q,t(u(be)("pointsRecharge.rules.rule2")),1),i("li",V,t(u(be)("pointsRecharge.rules.rule3")),1)])]),De.value?(r(),o("div",{key:0,class:"voucher-modal-overlay",onClick:We},[i("div",{class:"voucher-modal",onClick:a[0]||(a[0]=m(()=>{},["stop"]))},[i("div",Y,[i("h3",q,t(u(be)("pointsRecharge.voucher.title")),1),i("button",{class:"voucher-modal-close",onClick:We},"×")]),i("div",T,[i("div",X,[i("div",Z,t(Oe.value?.package_name),1),i("div",ee,[i("span",ae,t(Oe.value?.currency)+" "+t(Oe.value?.amount),1),xe.value>0?(r(),o("span",se,t(Oe.value?.currency)+" "+t((Oe.value?.amount-xe.value).toFixed(2)),1)):n("",!0)])]),i("div",ce,[Se.value?(r(),o("div",le,[a[1]||(a[1]=i("div",{class:"loading-spinner"},null,-1)),i("span",null,t(u(be)("pointsRecharge.voucher.loading")),1)])):0===Pe.value.length?(r(),o("div",oe,[i("span",null,t(u(be)("pointsRecharge.voucher.noVouchers")),1)])):(r(),o("div",re,[(r(!0),o(v,null,p(Pe.value,e=>(r(),o("div",{key:e.id,class:h(["voucher-item",{selected:we.value?.id===e.id,disabled:Oe.value?.amount<e.minOrderAmount}]),onClick:a=>Oe.value?.amount>=e.minOrderAmount&&Fe(e)},[i("div",ne,[i("div",te,t("USD"===e.currency?"$":e.currency)+t(e.amount),1),i("div",ue,t(e.couponCode),1)]),i("div",de,[i("div",ve,t(e.sourceDesc),1),i("div",pe,t(u(be)("pointsRecharge.voucher.minOrder"))+": "+t("USD"===e.currency?"$":e.currency)+t(e.minOrderAmount),1),i("div",he,t(u(be)("pointsRecharge.voucher.expireAt"))+": "+t(Le(e.expireAt)),1)]),i("div",me,[we.value?.id===e.id?(r(),o("div",ge,"✓")):n("",!0)])],10,ie))),128))]))])]),i("div",ye,[i("button",{class:"voucher-modal-btn cancel",onClick:We},t(u(be)("pointsRecharge.voucher.cancel")),1),i("button",{class:"voucher-modal-btn confirm",disabled:je.value,onClick:Ue},[je.value?(r(),o("span",Re,t(u(be)("pointsRecharge.voucher.loading")),1)):(r(),o("span",fe,t(u(be)("pointsRecharge.voucher.confirm")),1))],8,ke)])])])):n("",!0)]))}},[["__scopeId","data-v-dac2cc12"]]);export{be as default};
