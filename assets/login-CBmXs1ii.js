import{u as e,r as o,i as s}from"./index-C1ozWA1l.js";import{aA as n}from"./vendor-p2oL7ibe.js";import{d as i}from"./elementPlus-MWeHapXo.js";class t{loading=!1;constructor(){this.router=n(),this.authStore=e()}async login(e){this.loading=!0,this.authStore.login(e,e=>{this.loading=!1,this.handleLoginSuccess(e)})}handleLoginSuccess(e){this.router.replace({name:"czhome"})}sendEmailCode(e,n){o.common(s.SEND_EMAIL_CODE,{email:e.email,purpose:e.purpose||"register"}).then(e=>{i.success("验证码发送成功"),n&&n()})}async sendPhoneCode(e){let n={phone:e.phone,purpose:e.purpose};o.common(s.SEND_SMS_CODE,n).then(e=>{i.success("验证码发送成功")})}async phoneLogin(e){let o={phone:e.phone,password:e.password};this.loading=!0,this.authStore.phoneLogin(o,e=>{this.loading=!1,this.handleLoginSuccess(e)})}async phoneLoginCode(e){let o={phone:e.phone,smsCode:e.code};this.loading=!0,this.authStore.phoneLoginCode(o,e=>{this.loading=!1,this.handleLoginSuccess(e)})}async phoneResetPassword(e,n){let t={phone:e.phone,smsCode:e.code,newPassword:e.password};this.loading=!0,await o.common(s.RESET_PASSWORD_PHONE,t).then(e=>{this.loading=!1,i.success("密码重置成功"),n&&n()})}async phoneRegister(e){let n={phone:e.phone,smsCode:e.code,password:e.password,inviteCode:e.inviteCode};this.loading=!0,o.common(s.REGISTER_PHONE,n).then(e=>{this.loading=!1,i.success("注册成功");let o=e.data;this.authStore.loginSuccess(o,()=>{this.handleLoginSuccess(o)})}).catch(e=>{this.loading=!1,i.error("注册失败")})}confirmRegister(e,n){let t={email:e.email,emailCode:e.emailCode,password:e.password,inviteCode:e.inviteCode};o.common(s.REGISTER,t).then(e=>{e.data,i.success("注册成功"),n&&n()})}refreshGoogleRefreshToken(e){o.common(s.REFRESH_TOKEN).then(o=>{i.success("刷新成功"),e&&e()})}logout(){this.authStore.logout(()=>{this.router.replace({name:"login"})})}confirmForgotPassword(e,n){let t={email:e.email,emailCode:e.emailCode,newPassword:e.password};o.common(s.FORGOT_PASSWORD,t).then(e=>{i.success("密码修改成功"),n&&n()})}joinWaitlist(e,o){i.success("已成功加入候补队列，我们将尽快与您联系"),o&&o()}}export{t as L};
