import{_ as e,a,W as l,u as o,T as s,L as n}from"./index-C1ozWA1l.js";import{ax as t,r as u,c as r,j as i,z as d,A as v,B as p,L as c,E as g,P as h,u as _,K as w,ai as m,R as b,J as y,aK as f,I as k,ad as x,O as C,W as L,aA as P,l as R,f as B}from"./vendor-p2oL7ibe.js";import{I as j,E as F,J as I,K as S,aO as $}from"./elementPlus-MWeHapXo.js";import{u as M,m as U,r as V}from"./index-B5FtWS0I.js";import{L as q}from"./login-CBmXs1ii.js";const z={class:"login-mode-toggle"},K={class:"form-group"},W={class:"form-label",for:"phone"},A=["placeholder","disabled"],E={key:0,class:"input-error-icon"},J={key:0,class:"error-message"},O={key:0,class:"login-method-toggle"},N={key:1,class:"form-group"},T={class:"form-label",for:"code"},D=["placeholder","disabled"],G=["disabled"],H={key:0},Q={key:1},X={key:0,class:"input-error-icon"},Y={key:0,class:"error-message"},Z={key:2,class:"form-group"},ee={class:"form-label",for:"password"},ae=["type","placeholder","disabled","autocomplete"],le=["disabled"],oe={key:0,class:"input-error-icon"},se={key:0,class:"error-message"},ne={key:3,class:"agreement-checkbox"},te={class:"checkbox-label"},ue={class:"checkbox-text"},re=["disabled"],ie={class:"button-text"},de=["disabled"],ve={class:"button-text"},pe={key:0},ce={key:1},ge={key:0,class:"loading-spinner"},he=e({__name:"PhoneLoginForm",props:{loading:{type:Boolean,default:!1}},emits:["login","codeLogin","register","resetPassword","resetSuccess","sendCode","wechatLogin"],setup(e,{expose:o,emit:s}){const{t:n}=t(),R=P(),B=s,$=u("password"),q=u("code"),he=u({phone:"",code:"",password:""}),_e=u(!1),we=u(!1),me=u(!1),be=u(!1),ye=u(""),fe=u(""),ke=u(""),xe=u(0),Ce=u(!0),Le=u(!1),Pe={phone:{required:V},code:{required:r(()=>"password"!==$.value),minLength:r(()=>"password"!==$.value&&U(4))},password:{required:r(()=>"register"===$.value||"password"===$.value||"reset"===$.value),minLength:U(6)}},Re=M(Pe,he),Be=r(()=>/^1[3-9]\d{9}$/.test(he.value.phone)),je=r(()=>"password"===$.value&&"code"===q.value?!!he.value.phone&&!!he.value.code&&!ye.value&&!fe.value&&Le.value:"password"===$.value&&"password"===q.value?!!he.value.phone&&!!he.value.password&&!ye.value&&!ke.value&&Le.value:!!(he.value.phone&&he.value.code&&he.value.password)&&(!ye.value&&!fe.value&&!ke.value&&Le.value)),Fe=()=>{he.value.phone?/^1[3-9]\d{9}$/.test(he.value.phone)?ye.value="":ye.value=n("login.phone_invalid_error"):ye.value=n("login.phone_empty_error")},Ie=()=>{"password"===$.value||he.value.code?"password"!==$.value&&he.value.code.length<4?fe.value=n("login.code_invalid_error"):fe.value="":fe.value=n("login.code_empty_error")},Se=()=>{if("register"===$.value||"password"===$.value||"reset"===$.value){if("password"===$.value&&"code"===q.value)return void(ke.value="");he.value.password?he.value.password.length<6?ke.value=n("login.password_min_error"):ke.value="":ke.value=n("login.password_empty_error")}else ke.value=""};i(()=>he.value.phone,Fe),i(()=>he.value.code,Ie),i(()=>he.value.password,Se),i(()=>$.value,Se),i(()=>q.value,Se);const $e=async()=>{if(Be.value&&!(xe.value>0))try{Ce.value=!1,xe.value=60,B("sendCode",{phone:he.value.phone,purpose:"reset"===$.value?"reset-password":"password"===$.value?"login":"register"});const e=setInterval(()=>{xe.value--,xe.value<=0&&(clearInterval(e),Ce.value=!0)},1e3)}catch(e){Ce.value=!0,xe.value=0}},Me=async()=>{if("password"===$.value){if(Fe(),Se(),ye.value||ke.value)return}else if(await Re.value.$validate(),Re.value.$invalid)return Fe(),Ie(),void Se();"password"===$.value?"code"===q.value?B("codeLogin",he.value):B("login",he.value):"register"===$.value?B("register",he.value):"reset"===$.value&&B("resetPassword",he.value,()=>{$.value="password",he.value={phone:"",code:"",password:""},ye.value="",fe.value="",ke.value=""})},Ue=()=>{l.BusWechartForNavigate("/pages/login/index",{},"2")},Ve=e=>{R.push(`/agreement/${e}`)};return o({toggleLoginMode:(e,a="password")=>{$.value=e,q.value=a,ye.value="",fe.value="",ke.value="",Le.value=!1}}),(l,o)=>{const s=F;return v(),d("form",{class:"phone-login-form",onSubmit:L(Me,["prevent"])},[p("div",z,[p("button",{type:"button",class:g(["mode-button",{active:"password"===$.value}]),onClick:o[0]||(o[0]=e=>$.value="password")},h(_(n)("login.phone_password_login_mode")),3),p("button",{type:"button",class:g(["mode-button",{active:"register"===$.value}]),onClick:o[1]||(o[1]=e=>$.value="register")},h(_(n)("login.phone_register_mode")),3),p("button",{type:"button",class:g(["mode-button",{active:"reset"===$.value}]),onClick:o[2]||(o[2]=e=>$.value="reset")},h(_(n)("login.phone_reset_password_mode")),3)]),p("div",K,[p("label",W,h(_(n)("login.phone_label")),1),p("div",{class:g(["input-wrapper",{focused:_e.value}])},[w(p("input",{id:"phone","onUpdate:modelValue":o[3]||(o[3]=e=>he.value.phone=e),type:"tel",class:g(["form-input",{error:ye.value}]),placeholder:_(n)("login.phone_placeholder"),onFocus:o[4]||(o[4]=e=>_e.value=!0),onBlur:o[5]||(o[5]=e=>_e.value=!1),disabled:e.loading,autocomplete:"tel"},null,42,A),[[m,he.value.phone]]),ye.value?(v(),d("div",E,[b(s,null,{default:y(()=>[b(_(j))]),_:1})])):c("",!0)],2),ye.value?(v(),d("div",J,h(ye.value),1)):c("",!0)]),"password"===$.value?(v(),d("div",O,[p("button",{type:"button",class:g(["method-button",{active:"code"===q.value}]),onClick:o[6]||(o[6]=e=>q.value="code")},h(_(n)("login.phone_code_login_method")),3),p("button",{type:"button",class:g(["method-button",{active:"password"===q.value}]),onClick:o[7]||(o[7]=e=>q.value="password")},h(_(n)("login.phone_password_login_method")),3)])):c("",!0),"password"===$.value&&"code"===q.value||"register"===$.value||"reset"===$.value?(v(),d("div",N,[p("label",T,h(_(n)("login.code_label")),1),p("div",{class:g(["input-wrapper verification-code-wrapper",{focused:we.value}])},[w(p("input",{id:"code","onUpdate:modelValue":o[8]||(o[8]=e=>he.value.code=e),type:"text",class:g(["form-input verification-code-input",{error:fe.value}]),placeholder:_(n)("login.code_placeholder"),onFocus:o[9]||(o[9]=e=>we.value=!0),onBlur:o[10]||(o[10]=e=>we.value=!1),disabled:e.loading,autocomplete:"one-time-code"},null,42,D),[[m,he.value.code]]),p("button",{type:"button",class:"send-code-button",disabled:e.loading||!Ce.value||!Be.value,onClick:$e},[xe.value?(v(),d("span",Q,h(_(n)("login.resend_code_after",{seconds:xe.value})),1)):(v(),d("span",H,h(_(n)("login.send_code")),1))],8,G),fe.value?(v(),d("div",X,[b(s,null,{default:y(()=>[b(_(j))]),_:1})])):c("",!0)],2),fe.value?(v(),d("div",Y,h(fe.value),1)):c("",!0)])):c("",!0),"register"!==$.value&&"password"!==$.value&&"reset"!==$.value||"password"===$.value&&"code"===q.value?c("",!0):(v(),d("div",Z,[p("label",ee,h("reset"===$.value?_(n)("login.new_password_label"):_(n)("login.password_label")),1),p("div",{class:g(["input-wrapper",{focused:me.value}])},[w(p("input",{id:"password","onUpdate:modelValue":o[11]||(o[11]=e=>he.value.password=e),type:be.value?"text":"password",class:g(["form-input",{error:ke.value}]),placeholder:"reset"===$.value?_(n)("login.new_password_placeholder"):_(n)("login.password_placeholder"),onFocus:o[12]||(o[12]=e=>me.value=!0),onBlur:o[13]||(o[13]=e=>me.value=!1),disabled:e.loading,autocomplete:"password"===$.value?"current-password":"new-password"},null,42,ae),[[f,he.value.password]]),p("button",{type:"button",class:"password-toggle",onClick:o[14]||(o[14]=e=>be.value=!be.value),disabled:e.loading},[be.value?(v(),k(s,{key:0},{default:y(()=>[b(_(I))]),_:1})):(v(),k(s,{key:1},{default:y(()=>[b(_(S))]),_:1}))],8,le),ke.value?(v(),d("div",oe,[b(s,null,{default:y(()=>[b(_(j))]),_:1})])):c("",!0)],2),ke.value?(v(),d("div",se,h(ke.value),1)):c("",!0)])),"reset"!==$.value?(v(),d("div",ne,[p("label",te,[w(p("input",{type:"checkbox","onUpdate:modelValue":o[15]||(o[15]=e=>Le.value=e),class:"checkbox-input"},null,512),[[x,Le.value]]),p("span",ue,[C(h(_(n)("login.agreement_prefix"))+" ",1),p("a",{class:"agreement-link",onClick:o[16]||(o[16]=e=>Ve("user_agreement"))},h(_(n)("login.user_agreement")),1),C(" "+h(_(n)("login.agreement_and"))+" ",1),p("a",{class:"agreement-link",onClick:o[17]||(o[17]=e=>Ve("privacy_policy"))},h(_(n)("login.privacy_policy")),1)])])])):c("",!0),_(a)()?(v(),d("button",{key:4,type:"button",class:"wechat-login-button",disabled:e.loading,onClick:Ue},[o[18]||(o[18]=p("svg",{class:"wechat-icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[p("path",{fill:"#07C160",d:"M666.24 495.36c-8.96 0-17.92 0.96-26.88 2.88 27.52-47.36 43.52-102.4 43.52-161.28 0-170.24-158.72-308.48-354.56-308.48-195.84 0-354.56 138.24-354.56 308.48 0 88.32 43.52 168.96 115.2 225.28-6.4 19.84-16.96 52.48-19.84 60.8-4.48 13.44 6.4 26.88 20.48 21.76 9.6-3.84 52.48-20.48 77.44-30.08 52.48 23.04 112 36.48 175.36 36.48 8.96 0 17.92-0.96 26.88-1.92-4.48-20.48-6.4-41.6-6.4-63.36 0-154.24 140.8-279.68 313.6-279.68 8.96 0 17.92 0 26.88 0.96 0-3.84 0-7.68 0-11.52z"}),p("path",{fill:"#07C160",d:"M958.72 643.84c0-134.4-128-243.2-285.44-243.2-157.44 0-285.44 108.8-285.44 243.2 0 134.4 128 243.2 285.44 243.2 32 0 63.36-4.48 92.8-12.16 20.48 8.32 57.6 22.4 65.28 25.28 11.52 4.48 20.48-6.4 16.96-17.92-2.88-6.4-11.52-33.28-16.96-49.92 51.2-44.8 82.56-105.6 82.56-172.8z"})],-1)),p("span",ie,h(_(n)("login.wechat_login_button")),1)],8,re)):c("",!0),p("button",{type:"submit",class:"login-submit-button",disabled:e.loading||!je.value},[p("span",ve,[e.loading?(v(),d("span",ce,h("code"===$.value||"password"===$.value?_(n)("login.phone_logging"):"register"===$.value?_(n)("login.phone_registering"):_(n)("login.phone_resetting")),1)):(v(),d("span",pe,h("code"===$.value&&"code"===q.value?_(n)("login.phone_code_login_button"):"code"===$.value&&"password"===q.value||"password"===$.value?_(n)("login.phone_password_login_button"):"register"===$.value?_(n)("login.phone_register_button"):_(n)("login.phone_reset_password_button")),1))]),e.loading?(v(),d("div",ge)):c("",!0)],8,de)],32)}}},[["__scopeId","data-v-4d853aac"]]),_e={class:"login-page"},we={class:"top-right-controls"},me={class:"controls-container"},be={class:"login-container"},ye={class:"login-card"},fe={class:"login-title"},ke={class:"login-subtitle"},xe={class:"phone-login-section"},Ce={key:0,class:"error-message"},Le={key:1,class:"auth-links"},Pe={class:"auth-links-row"},Re=e({__name:"PhoneLogin",setup(e){const l=P(),r=o(),{t:i}=t(),g=R(new q),w=u(null),m=async e=>{g.phoneLogin(e)},f=async e=>{g.phoneLoginCode(e)},k=async e=>{g.phoneRegister(e)},x=async e=>{g.phoneResetPassword(e,()=>{w.value.toggleLoginMode("password","password")})},C=async e=>{g.sendPhoneCode(e)},L=()=>{l.push("/login")};return B(()=>{}),(e,l)=>{const o=F;return v(),d("div",_e,[l[0]||(l[0]=p("div",{class:"login-background"},null,-1)),p("div",we,[p("div",me,[b(s,{position:"top-right","tooltip-text":_(i)("login.theme_toggle_tooltip")},null,8,["tooltip-text"]),b(n,{position:"top-right","tooltip-text":_(i)("login.language_toggle_tooltip")},null,8,["tooltip-text"])])]),p("div",be,[p("div",ye,[p("div",fe,[p("h2",null,h(_(i)("login.phone_login_title")),1),p("p",ke,h(_(i)("login.phone_login_subtitle")),1)]),p("div",xe,[b(he,{ref_key:"PhoneLoginFormRef",ref:w,onLogin:m,onCodeLogin:f,onRegister:k,onResetPassword:x,onResetSuccess:e.handleResetSuccess,onSendCode:C},null,8,["onResetSuccess"])]),_(r).error?(v(),d("div",Ce,[b(o,{class:"error-icon"},{default:y(()=>[b(_(j))]),_:1}),p("span",null,h(_(r).error),1)])):c("",!0),_(a)()?c("",!0):(v(),d("div",Le,[p("div",Pe,[p("button",{type:"button",class:"auth-link email-login-link",onClick:L},[b(o,{class:"link-icon"},{default:y(()=>[b(_($))]),_:1}),p("span",null,h(_(i)("login.email_login_link")),1)])])]))])])])}}},[["__scopeId","data-v-3818dfa4"]]);export{Re as default};
