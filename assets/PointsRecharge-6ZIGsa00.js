import{az as e,aA as a,r as s,c,f as l,z as i,A as o,B as r,L as t,P as n,u,R as d,Q as v,a5 as p,E as h,W as m}from"./vendor-Bn3bPSOS.js";import{r as g,i as y,_ as k,L as R,a as f,W as b}from"./index-BXg9AdUO.js";import{P as _}from"./payserver-O4l35RnD.js";import"./elementPlus-DTQfcfg-.js";let C=class extends _{constructor(){super()}async getRechargePackageList(){let e=await g.common(y.RECHARGE_PACKAGES);if(0==e.code){return e.data}throw new Error(e.msg)}async confirmPay(e){this.createPayorOrder(e,2)}};const A={class:"points-recharge-page"},P={class:"top-bar"},S={class:"language-switcher"},w={class:"page-header"},x={class:"page-title"},D={class:"page-subtitle"},O={class:"plans-container"},E=["onClick"],$={class:"plan-header"},j={class:"plan-name"},L={key:0,class:"plan-badge"},F={class:"plan-price"},U={class:"price-amount"},W={class:"price-period"},z={class:"plan-points"},B={class:"plan-validity"},G={class:"plan-features"},I=["onClick"],N={class:"points-rules"},H={class:"rules-title"},J={class:"rules-list"},K={class:"rule-item"},M={class:"rule-item"},Q={class:"rule-item"},T={class:"voucher-modal-header"},V={class:"voucher-modal-title"},Y={class:"voucher-modal-content"},q={class:"selected-package-info"},X={class:"package-name"},Z={class:"package-price"},ee={class:"original-price"},ae={key:0,class:"discount-price"},se={class:"voucher-section"},ce={key:0,class:"loading-vouchers"},le={key:1,class:"no-vouchers"},ie={key:2,class:"voucher-list"},oe=["onClick"],re={class:"voucher-left"},te={class:"voucher-amount"},ne={class:"voucher-code"},ue={class:"voucher-right"},de={class:"voucher-desc"},ve={class:"voucher-min"},pe={class:"voucher-expire"},he={class:"voucher-check"},me={key:0,class:"check-icon"},ge={class:"voucher-modal-footer"},ye=["disabled"],ke={key:0},Re={key:1},fe=k({__name:"PointsRecharge",setup(k){const _=new C,{t:fe}=e(),be=a(),_e=s(null),Ce=s([]),Ae=s([]),Pe=s(null),Se=s(!1),we=s(0),xe=s(!1),De=s(null),Oe=s(!1),Ee=c(()=>[...Ce.value].sort((e,a)=>e.sort_order-a.sort_order)),$e=()=>{be.options.history.state.back||be.replace("/user-center"),be.back()},je=e=>{Pe.value?.id===e.id?Pe.value=null:Pe.value=e,(()=>{if(!De.value)return;Oe.value=!0;let e={currency:De.value.currency,amount:De.value.amount};Pe.value?e.coupon_ids=[Pe.value.id]:e.coupon_ids=[],g.common(y.calculateUnitAmount,e).then(e=>{const a=e.data;we.value=a.discount_amount||0}).catch(e=>{}).finally(()=>{Oe.value=!1})})()},Le=e=>{if(!e)return"";const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`},Fe=()=>{if(!De.value)return;let e={package_id:De.value.id};if(Pe.value?e.coupon_ids=[Pe.value.id]:e.coupon_ids=[],f()){const a=localStorage.getItem("token")||"";return void b.BusWechartForNavigate("/pages/pay/payPoint",{method:"pay",payData:JSON.stringify({package_id:De.value.id,credits:De.value.credits,amount:De.value.amount,token:a,coupon_ids:e.coupon_ids})},"1")}_.confirmPay(e),xe.value=!1},Ue=()=>{xe.value=!1,Pe.value=null,we.value=0,De.value=null},We=async()=>{const e=(await _.getRechargePackageList()).items||[];Ce.value=e,await(async()=>{Se.value=!0;try{const e=await g.common(y.getAvailableCoupon);0===e.code&&(Ae.value=e.data||[])}catch(e){Ae.value=[]}finally{Se.value=!1}})()};return l(()=>{We()}),(e,a)=>(o(),i("div",A,[r("div",P,[r("button",{class:"back-button",onClick:$e}," ← "+n(u(fe)("common.back")),1),r("div",S,[d(R)])]),r("div",w,[r("h1",x,n(u(fe)("pointsRecharge.title")),1),r("p",D,n(u(fe)("pointsRecharge.subtitle")),1)]),r("div",O,[(o(!0),i(v,null,p(Ee.value,e=>(o(),i("div",{key:e.id,class:h(["plan-card",{premium:1===e.is_recommended}]),onClick:a=>{return s=e.id,void(_e.value=s);var s}},[r("div",$,[r("h3",j,n(e.package_name),1),1===e.is_recommended?(o(),i("div",L,n(u(fe)("pointsRecharge.plans.premium.badge")),1)):t("",!0)]),r("div",F,[r("span",U,n(e.currency)+" "+n(e.amount),1),r("span",W,"/ "+n(u(fe)("pointsRecharge.period")),1)]),r("div",z,n(e.credits)+" "+n(u(fe)("pointsRecharge.points")),1),r("div",B,n(u(fe)("pointsRecharge.validity"))+": "+n(e.validity_days)+" "+n(u(fe)("pointsRecharge.period")),1),r("div",G,[r("ul",null,[r("li",null,n(u(fe)("pointsRecharge.features.unlimitedAccess")),1),r("li",null,n(u(fe)("pointsRecharge.features.prioritySupport")),1),r("li",null,n(u(fe)("pointsRecharge.features.securePayment")),1)])]),r("button",{class:h(["purchase-button",{"premium-button":1===e.is_recommended}]),onClick:m(a=>(e=>{De.value=e,xe.value=!0})(e),["stop"])},n(u(fe)("pointsRecharge.purchase")),11,I)],10,E))),128))]),r("div",N,[r("h2",H,n(u(fe)("pointsRecharge.rules.title")),1),r("ul",J,[r("li",K,n(u(fe)("pointsRecharge.rules.rule1")),1),r("li",M,n(u(fe)("pointsRecharge.rules.rule2")),1),r("li",Q,n(u(fe)("pointsRecharge.rules.rule3")),1)])]),xe.value?(o(),i("div",{key:0,class:"voucher-modal-overlay",onClick:Ue},[r("div",{class:"voucher-modal",onClick:a[0]||(a[0]=m(()=>{},["stop"]))},[r("div",T,[r("h3",V,n(u(fe)("pointsRecharge.voucher.title")),1),r("button",{class:"voucher-modal-close",onClick:Ue},"×")]),r("div",Y,[r("div",q,[r("div",X,n(De.value?.package_name),1),r("div",Z,[r("span",ee,n(De.value?.currency)+" "+n(De.value?.amount),1),we.value>0?(o(),i("span",ae,n(De.value?.currency)+" "+n((De.value?.amount-we.value).toFixed(2)),1)):t("",!0)])]),r("div",se,[Se.value?(o(),i("div",ce,[a[1]||(a[1]=r("div",{class:"loading-spinner"},null,-1)),r("span",null,n(u(fe)("pointsRecharge.voucher.loading")),1)])):0===Ae.value.length?(o(),i("div",le,[r("span",null,n(u(fe)("pointsRecharge.voucher.noVouchers")),1)])):(o(),i("div",ie,[(o(!0),i(v,null,p(Ae.value,e=>(o(),i("div",{key:e.id,class:h(["voucher-item",{selected:Pe.value?.id===e.id,disabled:De.value?.amount<e.minOrderAmount}]),onClick:a=>De.value?.amount>=e.minOrderAmount&&je(e)},[r("div",re,[r("div",te,n("USD"===e.currency?"$":e.currency)+n(e.amount),1),r("div",ne,n(e.couponCode),1)]),r("div",ue,[r("div",de,n(e.sourceDesc),1),r("div",ve,n(u(fe)("pointsRecharge.voucher.minOrder"))+": "+n("USD"===e.currency?"$":e.currency)+n(e.minOrderAmount),1),r("div",pe,n(u(fe)("pointsRecharge.voucher.expireAt"))+": "+n(Le(e.expireAt)),1)]),r("div",he,[Pe.value?.id===e.id?(o(),i("div",me,"✓")):t("",!0)])],10,oe))),128))]))])]),r("div",ge,[r("button",{class:"voucher-modal-btn cancel",onClick:Ue},n(u(fe)("pointsRecharge.voucher.cancel")),1),r("button",{class:"voucher-modal-btn confirm",disabled:Oe.value,onClick:Fe},[Oe.value?(o(),i("span",ke,n(u(fe)("pointsRecharge.voucher.loading")),1)):(o(),i("span",Re,n(u(fe)("pointsRecharge.voucher.confirm")),1))],8,ye)])])])):t("",!0)]))}},[["__scopeId","data-v-cf9d46fb"]]);export{fe as default};
