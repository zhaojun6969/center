import{F as t,r as e,i as a}from"./index-BXg9AdUO.js";class r{fileServer=new t;static timer=null;duration_seconds=0;constructor(){this.updateTimer=null,this.latestUpdateParams=null}async createProject(t="project"){return new Promise(async(r,s)=>{let i={thumbnail:"",title:t,description:"init",details:{node_card:[],prompt:"",thumbnail:""},tags:["doll"],duration_seconds:0},n=await e.common(a.PROJECT_CREATE,i);0!==n.code?s(n):r(n.data)})}async updateProject(t,r){return new Promise(async(s,i)=>{const n={id:t,...r};this.latestUpdateParams=n,this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(async()=>{try{const t=await e.common(a.PROJECT_UPDATE,this.latestUpdateParams);0!==t.code?i(t):s(t.data)}catch(t){i(t)}finally{this.updateTimer=null}},1e3)})}async deleteProject(t){return new Promise(async(r,s)=>{let i={id:t},n=await e.common(a.PROJECT_DELETE,i);0!==n.code?s(n):r(n.data)})}async getProject(t){return new Promise(async(r,s)=>{let i={id:t},n=await e.common(a.PROJECT_GET,i);0!==n.code?s(n):r(n.data)})}async getProjectList(t){return new Promise(async(r,s)=>{let i=await e.common(a.PROJECT_LIST,t);0!==i.code||r(i.data)})}addProjectDuration=t=>{this.duration_seconds=t,r.timer&&clearInterval(r.timer),r.timer=setInterval(()=>{this.duration_seconds+=1},1e3)};async getCombinedPrompt(t,r={}){try{return new Promise(async(s,i)=>{const n=await e.common(a.combined);if(0===n.code){let e=n.data;!1===r.isHook&&(e=e.filter(t=>!t.title.includes("头部挂钩"))),"E1"===t||"A1"===t?e=e.filter(t=>!t.title.includes("动物坐姿")&&!t.title.includes("人物姿势")&&"D1"!=t.type):"D1"===t&&(e=e.filter(t=>"E1"!==t.type&&"A1"!==t.type));const a={person:{content:"",imgs:[]},animal:{content:"",imgs:[]}};e.sort((t,e)=>t.sortOrder-e.sortOrder);e.filter(t=>"person"===t.type||"general"===t.type||"E1"===t.type||"A1"===t.type).forEach(t=>{if(a.person.content+=t.content,t.imageUrls)try{const e=JSON.parse(t.imageUrls);Array.isArray(e)&&a.person.imgs.push(...e)}catch(e){}});e.filter(t=>"animal"===t.type||"general"===t.type||"E1"===t.type||"A1"===t.type).forEach(t=>{if(a.animal.content+=t.content,t.imageUrls)try{const e=JSON.parse(t.imageUrls);Array.isArray(e)&&a.animal.imgs.push(...e)}catch(e){}}),s(a)}else i(n.msg)})}catch(s){reject(s)}}async getCommunicationId(){await this.fileServer.getUploadS3Data()}}export{r as P};
