import{_ as e}from"./index-C1ozWA1l.js";import{ax as a,aA as t,r as l,f as s,z as o,A as r,B as c,R as n,L as i,J as d,Q as v,a5 as u,W as p,u as m,P as g}from"./vendor-p2oL7ibe.js";import{t as f,J as j,R as D,S as h,T as k}from"./elementPlus-MWeHapXo.js";import{S as y}from"./SeriesSelector-BFGR2JmK.js";import{P as w}from"./index-ChzA8cSb.js";import{d as b}from"./date-CgH6eVIF.js";const C={class:"creation-workspace"},_={class:"projects-grid"},x=["onDragstart","onDrop","onDragenter"],W={class:"project-thumbnail"},$=["src"],L={key:1,class:"project-thumbnail-default"},T={class:"project-icon"},Y={class:"project-file-name"},I={class:"project-info"},P={class:"project-title"},E={class:"project-desc"},H={class:"project-tags"},S={class:"project-meta"},A={class:"project-date"},M=["onClick"],z={class:"overlay-content"},R={class:"view-center-btn"},J={class:"new-project-icon"},q={class:"new-project-text"},B={class:"trash-content"},F={class:"trash-icon"},G={class:"modal-header"},N={class:"modal-title"},O={class:"modal-body"},Q={class:"delete-confirm-content"},K={class:"delete-confirm-icon"},U={class:"delete-confirm-text"},V={class:"delete-confirm-project-name"},X={class:"delete-confirm-actions"},Z=e({__name:"CreationWorkspace",setup(e){const{formatDate:Z}=b,ee=new w,{t:ae}=a(),te=t(),le=l(!1),se=l(""),oe=l(""),re=l(""),ce=l(null),ne=l(null),ie=l([]),de=l(1),ve=l(15),ue=l(0),pe=l(!1),me=l(!1),ge=l(null),fe=l(!1),je=l(null),De=l(!1),he=l(null),ke=l(!1),ye=()=>{we()},we=async()=>{if(!pe.value&&!me.value){pe.value=!0;try{const e={page:de.value,page_size:ve.value},a=await ee.getProjectList(e);1===de.value?ie.value=a.items:ie.value=[...ie.value,...a.items],ue.value=a.total,me.value=ie.value.length>=ue.value,de.value++}catch(e){}finally{pe.value=!1}}},be=e=>{const a=e.target.files[0];if(a&&a.type.startsWith("image/")&&!(a.size>2097152)){try{le.value=!1,se.value="",oe.value="",re.value="",ce.value=null}catch(t){}e.target.value=""}},Ce=e=>{ke.value=!1,(e=>{te.push(`/project/new/${e.product_info.mark}`)})(e)},_e=()=>{ke.value=!1},xe=e=>{for(;e&&!e.classList.contains("project-card");)e=e.parentElement;return e},We=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},$e=(e,a)=>{const t=xe(e.target);if(t&&(t.classList.add("drag-over"),je.value=t,ge.value&&a&&ge.value.id!==a.id)){const e=ie.value.findIndex(e=>e.id===ge.value.id),t=ie.value.findIndex(e=>e.id===a.id);if(-1!==e&&-1!==t){const[a]=ie.value.splice(e,1);ie.value.splice(t,0,a)}}},Le=e=>{const a=xe(e.target);a&&(a.classList.remove("drag-over"),a===je.value&&(je.value=null))},Te=()=>{ge.value&&(he.value=ge.value,De.value=!0),fe.value=!1},Ye=()=>{he.value&&((async e=>{const a=ie.value.findIndex(a=>a.id===e.id);-1!==a&&(ie.value.splice(a,1),await ee.deleteProject(e.id))})(he.value),he.value=null,De.value=!1)},Ie=()=>{he.value=null,De.value=!1};return s(()=>{we()}),(e,a)=>{const t=h;return r(),o("div",C,[c("input",{ref_key:"fileInput",ref:ne,type:"file",accept:"image/*",style:{display:"none"},onChange:be},null,544),n(t,{height:"100%",onEndReached:ye},{default:d(()=>[c("div",_,[(r(!0),o(v,null,u(ie.value,e=>(r(),o("div",{key:e.id,class:"project-card",draggable:"true",onDragstart:a=>((e,a)=>{ge.value=a,fe.value=!0,e.target.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",a.id),e.dataTransfer.setDragImage(new Image,0,0)})(a,e),onDragover:a[0]||(a[0]=p(e=>We(e),["prevent"])),onDrop:e=>(e=>{e.preventDefault();const a=xe(e.target);a&&a.classList.remove("drag-over"),ge.value=null})(e),onDragenter:a=>$e(a,e),onDragleave:a[1]||(a[1]=e=>Le(e)),onDragend:a[2]||(a[2]=e=>{return a=e,fe.value=!1,je.value=null,a.target.classList.remove("dragging"),void document.querySelectorAll(".project-card").forEach(e=>{e.classList.remove("drag-over")});var a})},[c("div",W,[e.thumbnail?(r(),o("img",{key:0,src:e.thumbnail,alt:"{{ project.title }}",class:"project-thumbnail-image"},null,8,$)):(r(),o("div",L,[c("div",T,[n(m(f))]),c("span",Y,g(e.title),1)]))]),c("div",I,[c("h3",P,g(e.title),1),c("p",E,g(m(Z)(e.created_at,"YYYY-MM-DD HH:mm:ss")),1),c("div",H,[(r(!0),o(v,null,u(e.tags,e=>(r(),o("span",{key:e,class:"project-tag"},g(e),1))),128))]),c("div",S,[a[8]||(a[8]=c("span",{class:"project-date"},null,-1)),c("span",A,g(m(Z)(e.updated_at,"YYYY-MM-DD HH:mm:ss")),1)])]),c("div",{class:"project-overlay combined-overlay",onClick:p(a=>(e=>{let a=e.tags[0];switch(a){case"Oone":a="E1";break;case"Done":a="D1"}te.push(`/project/${e.id}/${a}`)})(e),["stop"])},[c("div",z,[c("div",R,[n(m(j),{class:"btn-icon"})])])],8,M)],40,x))),128)),c("div",{class:"new-project-card",onClick:a[3]||(a[3]=e=>ke.value=!0)},[c("div",J,[n(m(D))]),c("span",q,g(e.$t("creationWorkspace.createNewProject")),1)])])]),_:1}),fe.value?(r(),o("div",{key:0,class:"trash-drawer",onDragover:a[4]||(a[4]=p(e=>We(e),["prevent"])),onDrop:Te,onDragenter:a[5]||(a[5]=e=>$e(e)),onDragleave:a[6]||(a[6]=e=>Le(e))},[c("div",B,[c("h3",null,g(e.$t("creationWorkspace.dropToDelete")),1),c("div",F,[n(m(k),{class:"trash-main-icon"})]),c("p",null,g(e.$t("creationWorkspace.dropToDeleteHint")),1)])],32)):i("",!0),De.value?(r(),o("div",{key:1,class:"modal-overlay",onClick:Ie},[c("div",{class:"modal-content",onClick:a[7]||(a[7]=p(()=>{},["stop"]))},[c("div",G,[c("h2",N,g(e.$t("creationWorkspace.deleteProject")),1)]),c("div",O,[c("div",Q,[c("div",K,[n(m(k),{class:"delete-main-icon"})]),c("p",U,g(e.$t("creationWorkspace.dropToDeleteHint")),1),c("p",V,g(he.value?.title),1),c("div",X,[c("button",{class:"modal-action-btn cancel",onClick:Ie},g(e.$t("creationWorkspace.cancel")),1),c("button",{class:"modal-action-btn delete",onClick:Ye},g(e.$t("creationWorkspace.confirmDelete")),1)])])])])])):i("",!0),n(y,{show:ke.value,onConfirm:Ce,onCancel:_e},null,8,["show"])])}}},[["__scopeId","data-v-973ca0ad"]]);export{Z as default};
