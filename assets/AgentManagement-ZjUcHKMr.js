import{_ as e}from"./index-DlA8SRM3.js";/* empty css                   *//* empty css                 */import{ax as a,aA as n,r as l,f as t,I as s,A as i,J as d,B as c,R as o,ah as u,u as r,O as v,P as g,z as m,L as p,Q as f,a5 as h}from"./vendor-p2oL7ibe.js";import{B as y,l as _,x as M,E as k,P as C,ab as V,y as b,Q as x,d as A}from"./elementPlus-BlcbFMqO.js";import{X as w}from"./xiaozhiserve-CNYrnHqQ.js";const z={class:"agent-management"},j={class:"page-header"},D={class:"header-content"},P={class:"header-actions"},U={class:"search-container"},B={class:"agents-section"},I={class:"agents-grid"},E={class:"agent-card-header"},K={class:"agent-name"},O={class:"agent-actions"},Q={class:"agent-card-body"},R={class:"agent-info-item"},S={class:"label"},T={class:"value"},$={class:"agent-info-item"},H={class:"label"},J={class:"value"},L={key:0,class:"agent-info-item"},N={class:"label"},W=["onClick"],X={key:1,class:"loading-container"},q={class:"loading-text"},F={key:2,class:"empty-container"},G={class:"empty-content"},Y={class:"empty-text"},Z={class:"bind-dialog-content"},ee={class:"dialog-footer"},ae={class:"delete-dialog-content"},ne={class:"delete-warning"},le={class:"dialog-footer"},te=e({__name:"AgentManagement",setup(e){const{t:te}=a(),se=n(),ie=new w,de=l(!1),ce=l(!1),oe=l(""),ue=l(""),re=l(""),ve=l(""),ge=l([]),me=l(!1),pe=l(1),fe=l(10),he=l(!0),ye=async()=>{if(he.value&&!me.value)try{me.value=!0;const e={user_id:"",agent_name:ve.value,sync_status:"",page:pe.value,page_size:fe.value},a=await ie.listAgent(e);if(0===a.code&&a.data){const e=a.data.items||[];1===pe.value?ge.value=e:ge.value=[...ge.value,...e];const n=a.data.total||0;he.value=ge.value.length<n,pe.value++,await _e()}else A.error(a.msg||"获取智能体列表失败")}catch(e){A.error("获取智能体列表失败")}finally{me.value=!1}},_e=async()=>{if(!ge.value.some(e=>"杜小甫"===e.agent_name))try{0===(await ie.createDefaultAgent()).code&&be()}catch(e){}},Me=()=>{ye()},ke=e=>{oe.value=e.replace(/[^0-9]/g,"").slice(0,6)},Ce=()=>{de.value=!1,oe.value="",ue.value="",re.value=""},Ve=async()=>{if(6===oe.value.length){try{me.value=!0;const e={agent_id:re.value,verification_code:oe.value},a=await ie.addDeviceAgent(e);0===a.code?(A.success("设备绑定成功！"),be()):A.error(a.msg||"设备绑定失败")}catch(e){A.error("设备绑定失败")}finally{me.value=!1}Ce()}},be=()=>{ge.value=[],pe.value=1,he.value=!0,me.value=!1,ye()},xe=()=>{ce.value=!1,ue.value="",re.value=""},Ae=async()=>{try{me.value=!0;const e={id:re.value};0===(await ie.deleteAgent(e)).code?A.success("success"):A.error("err"),be()}catch(e){A.error("智能体删除失败")}finally{me.value=!1}xe()},we=()=>{se.push("/add-agent")},ze=e=>{be()};return t(()=>{be()}),(e,a)=>{const n=y,l=k,t=M,A=b,w=x;return i(),s(w,{height:"100%",onEndReached:Me},{default:d(()=>[c("div",z,[c("div",j,[c("div",D,[a[4]||(a[4]=c("h1",{class:"page-title"},null,-1)),c("div",P,[c("div",U,[o(n,{modelValue:ve.value,"onUpdate:modelValue":a[0]||(a[0]=e=>ve.value=e),placeholder:r(te)("agentManagement.searchPlaceholder"),"prefix-icon":r(_),clearable:"",onKeyup:u(ze,["enter"]),size:"default"},null,8,["modelValue","placeholder","prefix-icon"])]),o(t,{type:"primary",onClick:we},{default:d(()=>[o(l,null,{default:d(()=>[o(r(C))]),_:1}),v(" "+g(r(te)("agentManagement.addAgent")),1)]),_:1})])])]),c("div",B,[c("div",I,[ge.value.length>0?(i(!0),m(f,{key:0},h(ge.value,e=>(i(),m("div",{class:"agent-card",key:e.id},[c("div",E,[c("h3",K,g(e.agent_name||r(te)("agentManagement.unnamedAgent")),1),c("div",O,[o(t,{size:"small",onClick:a=>{return n=e.id,void se.push(`/add-agent?id=${n}`);var n}},{default:d(()=>[v(g(r(te)("agentManagement.editAgent")),1)]),_:1},8,["onClick"]),o(t,{type:"primary",size:"small",onClick:a=>{return n=e.id,l=e.agent_name,ue.value=l,re.value=n,de.value=!0,void(oe.value="");var n,l}},{default:d(()=>[v(g(e.sync_status?r(te)("agentManagement.rebindDevice"):r(te)("agentManagement.bindDevice")),1)]),_:2},1032,["onClick"]),o(t,{type:"danger",size:"small",onClick:a=>{return n=e.id,l=e.agent_name,ue.value=l,re.value=n,void(ce.value=!0);var n,l}},{default:d(()=>[v(g(r(te)("agentManagement.deleteAgent")),1)]),_:1},8,["onClick"])])]),c("div",Q,[c("div",R,[c("span",S,g(r(te)("agentManagement.character"))+"：",1),c("span",T,g(e.character||r(te)("agentManagement.notSet")),1)]),c("div",$,[c("span",H,g(r(te)("agentManagement.llmModel"))+"：",1),c("span",J,g(e.llm_model||r(te)("agentManagement.notSet")),1)]),e.device_count>0?(i(),m("div",L,[c("span",N,g(r(te)("agentManagement.deviceCount"))+"：",1),c("span",{class:"value device-count-link",onClick:a=>{return n=e.id,void se.push(`/device-list/${n}`);var n}},g(e.device_count)+" "+g(r(te)("agentManagement.devices")),9,W)])):p("",!0)])]))),128)):p("",!0),me.value&&0===ge.value.length?(i(),m("div",X,[c("div",q,g(r(te)("agentManagement.loading")),1)])):p("",!0),me.value||0!==ge.value.length?p("",!0):(i(),m("div",F,[c("div",G,[o(l,{size:"64"},{default:d(()=>[o(r(V))]),_:1}),c("p",Y,g(r(te)("agentManagement.noAgents")),1)])]))]),o(A,{modelValue:de.value,"onUpdate:modelValue":a[2]||(a[2]=e=>de.value=e),title:r(te)("agentManagement.bindDeviceTitle"),width:"400px",center:""},{footer:d(()=>[c("span",ee,[o(t,{onClick:Ce},{default:d(()=>[v(g(r(te)("common.cancel")),1)]),_:1}),o(t,{type:"primary",onClick:Ve,disabled:6!==oe.value.length},{default:d(()=>[v(g(r(te)("agentManagement.confirmBind")),1)]),_:1},8,["disabled"])])]),default:d(()=>[c("div",Z,[c("p",null,g(r(te)("agentManagement.enterVerificationCode")),1),o(n,{modelValue:oe.value,"onUpdate:modelValue":a[1]||(a[1]=e=>oe.value=e),key:"verification_code",placeholder:r(te)("agentManagement.verificationCodePlaceholder"),maxlength:"6","show-word-limit":"",onInput:ke,onKeyup:u(Ve,["enter"])},null,8,["modelValue","placeholder"])])]),_:1},8,["modelValue","title"]),o(A,{modelValue:ce.value,"onUpdate:modelValue":a[3]||(a[3]=e=>ce.value=e),title:r(te)("agentManagement.deleteConfirmTitle"),width:"400px",center:""},{footer:d(()=>[c("span",le,[o(t,{onClick:xe},{default:d(()=>[v(g(r(te)("common.cancel")),1)]),_:1}),o(t,{type:"danger",onClick:Ae},{default:d(()=>[v(g(r(te)("common.delete")),1)]),_:1})])]),default:d(()=>[c("div",ae,[c("p",null,g(r(te)("agentManagement.deleteConfirmContent")),1),c("p",ne,g(r(te)("agentManagement.deleteWarning")),1)])]),_:1},8,["modelValue","title"])])])]),_:1})}}},[["__scopeId","data-v-8c6d2478"]]);export{te as default};
